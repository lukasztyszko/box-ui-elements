"use strict";(globalThis.webpackChunkbox_ui_elements=globalThis.webpackChunkbox_ui_elements||[]).push([[31855],{"./src/api/APIFactory.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>api_APIFactory});var Cache=__webpack_require__("./src/utils/Cache.js"),noop=__webpack_require__("./node_modules/lodash/noop.js"),noop_default=__webpack_require__.n(noop),lodash_isNaN=__webpack_require__("./node_modules/lodash/isNaN.js"),isNaN_default=__webpack_require__.n(lodash_isNaN),uploads=__webpack_require__("./src/utils/uploads.js"),utils_function=__webpack_require__("./src/utils/function.js"),sha1=__webpack_require__("./node_modules/js-sha1/src/sha1.js"),sha1_default=__webpack_require__.n(sha1);function getCrypto(){return window.crypto||window.msCrypto}function digest(algorithm,buffer){const cryptoRef=getCrypto();return cryptoRef!==window.msCrypto?cryptoRef.subtle.digest(algorithm,buffer):new Promise(((resolve,reject)=>{if("SHA-1"===algorithm)try{const hashBuffer=sha1_default().arrayBuffer(buffer);resolve(hashBuffer)}catch(e){reject(e)}else{const cryptoOperation=cryptoRef.subtle.digest({name:algorithm},buffer);cryptoOperation.oncomplete=event=>{resolve(event.target.result)},cryptoOperation.onerror=reject}}))}function RushaCore(stdlib,foreign,heap){"use asm";var H=new stdlib.Int32Array(heap);function hash(k,x){k=k|0;x=x|0;var i=0,j=0,y0=0,z0=0,y1=0,z1=0,y2=0,z2=0,y3=0,z3=0,y4=0,z4=0,t0=0,t1=0;y0=H[x+320>>2]|0;y1=H[x+324>>2]|0;y2=H[x+328>>2]|0;y3=H[x+332>>2]|0;y4=H[x+336>>2]|0;for(i=0;(i|0)<(k|0);i=i+64|0){z0=y0;z1=y1;z2=y2;z3=y3;z4=y4;for(j=0;(j|0)<64;j=j+4|0){t1=H[i+j>>2]|0;t0=((y0<<5|y0>>>27)+(y1&y2|~y1&y3)|0)+((t1+y4|0)+1518500249|0)|0;y4=y3;y3=y2;y2=y1<<30|y1>>>2;y1=y0;y0=t0;H[k+j>>2]=t1}for(j=k+64|0;(j|0)<(k+80|0);j=j+4|0){t1=(H[j-12>>2]^H[j-32>>2]^H[j-56>>2]^H[j-64>>2])<<1|(H[j-12>>2]^H[j-32>>2]^H[j-56>>2]^H[j-64>>2])>>>31;t0=((y0<<5|y0>>>27)+(y1&y2|~y1&y3)|0)+((t1+y4|0)+1518500249|0)|0;y4=y3;y3=y2;y2=y1<<30|y1>>>2;y1=y0;y0=t0;H[j>>2]=t1}for(j=k+80|0;(j|0)<(k+160|0);j=j+4|0){t1=(H[j-12>>2]^H[j-32>>2]^H[j-56>>2]^H[j-64>>2])<<1|(H[j-12>>2]^H[j-32>>2]^H[j-56>>2]^H[j-64>>2])>>>31;t0=((y0<<5|y0>>>27)+(y1^y2^y3)|0)+((t1+y4|0)+1859775393|0)|0;y4=y3;y3=y2;y2=y1<<30|y1>>>2;y1=y0;y0=t0;H[j>>2]=t1}for(j=k+160|0;(j|0)<(k+240|0);j=j+4|0){t1=(H[j-12>>2]^H[j-32>>2]^H[j-56>>2]^H[j-64>>2])<<1|(H[j-12>>2]^H[j-32>>2]^H[j-56>>2]^H[j-64>>2])>>>31;t0=((y0<<5|y0>>>27)+(y1&y2|y1&y3|y2&y3)|0)+((t1+y4|0)-1894007588|0)|0;y4=y3;y3=y2;y2=y1<<30|y1>>>2;y1=y0;y0=t0;H[j>>2]=t1}for(j=k+240|0;(j|0)<(k+320|0);j=j+4|0){t1=(H[j-12>>2]^H[j-32>>2]^H[j-56>>2]^H[j-64>>2])<<1|(H[j-12>>2]^H[j-32>>2]^H[j-56>>2]^H[j-64>>2])>>>31;t0=((y0<<5|y0>>>27)+(y1^y2^y3)|0)+((t1+y4|0)-899497514|0)|0;y4=y3;y3=y2;y2=y1<<30|y1>>>2;y1=y0;y0=t0;H[j>>2]=t1}y0=y0+z0|0;y1=y1+z1|0;y2=y2+z2|0;y3=y3+z3|0;y4=y4+z4|0}H[x+320>>2]=y0;H[x+324>>2]=y1;H[x+328>>2]=y2;H[x+332>>2]=y3;H[x+336>>2]=y4}return{hash}}const uploadsSHA1Worker=()=>{const workerCodeBlob=new Blob(["const RushaCore = ".concat(RushaCore.toString()),";\n",'function Rusha(e){for(var r=function(e){if("string"==typeof e)return"string";if(e instanceof Array)return"array";if("undefined"!=typeof global&&global.Buffer&&global.Buffer.isBuffer(e))return"buffer";if(e instanceof ArrayBuffer)return"arraybuffer";if(e.buffer instanceof ArrayBuffer)return"view";if(e instanceof Blob)return"blob";throw new Error("Unsupported data type.")},n={fill:0},t=function(e){for(e+=9;e%64>0;e+=1);return e},a=function(e,r,n,t,a){var f,s=this,i=a%4,h=(t+i)%4,u=t-h;switch(i){case 0:e[a]=s[n+3];case 1:e[a+1-(i<<1)|0]=s[n+2];case 2:e[a+2-(i<<1)|0]=s[n+1];case 3:e[a+3-(i<<1)|0]=s[n]}if(!(t<h+i)){for(f=4-i;f<u;f=f+4|0)r[a+f>>2|0]=s[n+f]<<24|s[n+f+1]<<16|s[n+f+2]<<8|s[n+f+3];switch(h){case 3:e[a+u+1|0]=s[n+u+2];case 2:e[a+u+2|0]=s[n+u+1];case 1:e[a+u+3|0]=s[n+u]}}},f=function(e){switch(r(e)){case"string":return function(e,r,n,t,a){var f,s=this,i=a%4,h=(t+i)%4,u=t-h;switch(i){case 0:e[a]=s.charCodeAt(n+3);case 1:e[a+1-(i<<1)|0]=s.charCodeAt(n+2);case 2:e[a+2-(i<<1)|0]=s.charCodeAt(n+1);case 3:e[a+3-(i<<1)|0]=s.charCodeAt(n)}if(!(t<h+i)){for(f=4-i;f<u;f=f+4|0)r[a+f>>2]=s.charCodeAt(n+f)<<24|s.charCodeAt(n+f+1)<<16|s.charCodeAt(n+f+2)<<8|s.charCodeAt(n+f+3);switch(h){case 3:e[a+u+1|0]=s.charCodeAt(n+u+2);case 2:e[a+u+2|0]=s.charCodeAt(n+u+1);case 1:e[a+u+3|0]=s.charCodeAt(n+u)}}}.bind(e);case"array":case"buffer":return a.bind(e);case"arraybuffer":return a.bind(new Uint8Array(e));case"view":return a.bind(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));case"blob":return function(e,r,n,t,a){var f,s=a%4,i=(t+s)%4,h=t-i,u=new Uint8Array(reader.readAsArrayBuffer(this.slice(n,n+t)));switch(s){case 0:e[a]=u[3];case 1:e[a+1-(s<<1)|0]=u[2];case 2:e[a+2-(s<<1)|0]=u[1];case 3:e[a+3-(s<<1)|0]=u[0]}if(!(t<i+s)){for(f=4-s;f<h;f=f+4|0)r[a+f>>2|0]=u[f]<<24|u[f+1]<<16|u[f+2]<<8|u[f+3];switch(i){case 3:e[a+h+1|0]=u[h+2];case 2:e[a+h+2|0]=u[h+1];case 1:e[a+h+3|0]=u[h]}}}.bind(e)}},s=new Array(256),i=0;i<256;i++)s[i]=(i<16?"0":"")+i.toString(16);var h=function(e){for(var r=new Uint8Array(e),n=new Array(e.byteLength),t=0;t<n.length;t++)n[t]=s[r[t]];return n.join("")};!function(e){if(e%64>0)throw new Error("Chunk size must be a multiple of 128 bit");n.offset=0,n.maxChunkLen=e,n.padMaxChunkLen=t(e),n.heap=new ArrayBuffer(function(e){var r;if(e<=65536)return 65536;if(e<16777216)for(r=1;r<e;r<<=1);else for(r=16777216;r<e;r+=16777216);return r}(n.padMaxChunkLen+320+20)),n.h32=new Int32Array(n.heap),n.h8=new Int8Array(n.heap),n.core=new RushaCore({Int32Array:Int32Array,DataView:DataView},{},n.heap),n.buffer=null}(e||65536);var u=function(e,r){n.offset=0;var t=new Int32Array(e,r+320,5);t[0]=1732584193,t[1]=-271733879,t[2]=-1732584194,t[3]=271733878,t[4]=-1009589776},c=function(e,r){var a,f,s,i=t(e),h=new Int32Array(n.heap,0,i>>2);return function(e,r){var n=new Uint8Array(e.buffer),t=r%4,a=r-t;switch(t){case 0:n[a+3]=0;case 1:n[a+2]=0;case 2:n[a+1]=0;case 3:n[a+0]=0}for(var f=1+(r>>2);f<e.length;f++)e[f]=0}(h,e),s=r,(a=h)[(f=e)>>2]|=128<<24-(f%4<<3),a[14+(2+(f>>2)&-16)]=s/(1<<29)|0,a[15+(2+(f>>2)&-16)]=s<<3,i},o=function(e,r,t,a){f(e)(n.h8,n.h32,r,t,a||0)},d=function(e,r,t,a,f){var s=t;o(e,r,t),f&&(s=c(t,a)),n.core.hash(s,n.padMaxChunkLen)},y=function(e,r){var n=new Int32Array(e,r+320,5),t=new Int32Array(5),a=new DataView(t.buffer);return a.setInt32(0,n[0],!1),a.setInt32(4,n[1],!1),a.setInt32(8,n[2],!1),a.setInt32(12,n[3],!1),a.setInt32(16,n[4],!1),t},w=this.rawDigest=function(e){var r=e.byteLength||e.length||e.size||0;u(n.heap,n.padMaxChunkLen);var t=0,a=n.maxChunkLen;for(t=0;r>t+a;t+=a)d(e,t,a,r,!1);return d(e,t,r-t,r,!0),y(n.heap,n.padMaxChunkLen)};this.digest=this.digestFromString=this.digestFromBuffer=this.digestFromArrayBuffer=function(e){return h(w(e).buffer)},this.resetState=function(){return u(n.heap,n.padMaxChunkLen),this},this.append=function(e){var r,t=0,a=e.byteLength||e.length||e.size||0,f=n.offset%n.maxChunkLen;for(n.offset+=a;t<a;)r=Math.min(a-t,n.maxChunkLen-f),o(e,t,r,f),t+=r,(f+=r)===n.maxChunkLen&&(n.core.hash(n.maxChunkLen,n.padMaxChunkLen),f=0);return this},this.getState=function(){var e;if(n.offset%n.maxChunkLen)e=n.heap.slice(0);else{var r=new Int32Array(n.heap,n.padMaxChunkLen+320,5);e=r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}return{offset:n.offset,heap:e}},this.setState=function(e){(n.offset=e.offset,20===e.heap.byteLength)?new Int32Array(n.heap,n.padMaxChunkLen+320,5).set(new Int32Array(e.heap)):n.h32.set(new Int32Array(e.heap));return this};var p=this.rawEnd=function(){var e=n.offset,r=e%n.maxChunkLen,t=c(r,e);n.core.hash(t,n.padMaxChunkLen);var a=y(n.heap,n.padMaxChunkLen);return u(n.heap,n.padMaxChunkLen),a};this.end=function(){return h(p().buffer)}}',";\n","var setupWorker = ",function workerBase(){const fileSha1=new Rusha;fileSha1.resetState();let expectedOffset=0;self.onmessage=event=>{const{data}=event,{part,fileSize,partContents}=data,startTimestamp=Date.now();try{if(part.offset!==expectedOffset)throw new Error("Out of order parts given to worker");if(fileSha1.append(partContents),self.postMessage({type:"partDone",part:data.part,duration:Date.now()-startTimestamp,partContents},[partContents]),expectedOffset+=part.size,part.offset+part.size===fileSize){const hash=fileSha1.end();self.postMessage({type:"done",sha1:hash})}}catch(err){const message={type:"error",name:err.name,message:err.message,part};self.postMessage(message)}}}.toString(),";\n","setupWorker();"],{type:"text/javascript"}),workerUrl=(window.URL||window.webkitURL).createObjectURL(workerCodeBlob),worker=new Worker(workerUrl);return worker.oldTerminate=worker.terminate,worker.terminate=()=>{(window.URL||window.webkitURL).revokeObjectURL(workerUrl),worker.oldTerminate()},worker};var Browser=__webpack_require__("./src/utils/Browser.js"),constants=__webpack_require__("./src/constants.js"),get=__webpack_require__("./node_modules/lodash/get.js"),get_default=__webpack_require__.n(get),Uri=__webpack_require__("./node_modules/jsuri/Uri.js"),Uri_default=__webpack_require__.n(Uri);var Base=__webpack_require__("./src/api/Base.js");function _defineProperty(obj,key,value){return(key=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class BaseUpload extends Base.Z{constructor(){super(...arguments),_defineProperty(this,"retryCount",0),_defineProperty(this,"reachabilityRetryCount",0),_defineProperty(this,"isUploadFallbackLogicEnabled",!1),_defineProperty(this,"makePreflightRequest",(()=>{if(this.isDestroyed())return;let url="".concat(this.getBaseApiUrl(),"/files/content");if(this.fileId&&(url=url.replace("content","".concat(this.fileId,"/content"))),this.isUploadFallbackLogicEnabled){const unreachableHostUrls=this.uploadsReachability.getUnreachableHostsUrls();0!==unreachableHostUrls.length&&(url+="?unreachable_hosts=".concat(unreachableHostUrls.join(",")))}const{size,name}=this.file,attributes={name:this.fileName||name,parent:{id:this.folderId},description:this.fileDescription,size};this.xhr.options({url,data:attributes,successHandler:response=>{this.isUploadFallbackLogicEnabled?this.preflightSuccessReachabilityHandler(response):this.preflightSuccessHandler(response)},errorHandler:this.preflightErrorHandler})})),_defineProperty(this,"preflightSuccessReachabilityHandler",(async _ref=>{let{data}=_ref;if(this.isDestroyed())return;const{upload_url}=data;if(!upload_url)return void this.preflightSuccessHandler({data});const uploadHost=this.getUploadHostFromUrl(upload_url);if(uploadHost==="".concat(constants._6Q,"/")||uploadHost==="".concat(constants.a07,"/")||uploadHost==="".concat(constants.YZx,"/"))return void this.preflightSuccessHandler({data});await this.uploadsReachability.isReachable(uploadHost)?this.preflightSuccessHandler({data}):this.reachabilityRetryCount>=10?this.preflightSuccessHandler({data:{}}):(this.reachabilityRetryCount+=1,this.makePreflightRequest())})),_defineProperty(this,"preflightErrorHandler",(error=>{if(this.isDestroyed())return;this.fileName=this.file?this.file.name:"";let errorData=error;const{response}=error;if(response&&response.data&&(errorData=response.data),this.retryCount>=5)this.errorCallback(errorData);else if(errorData&&409===errorData.status){if(this.overwrite){const conflictFileId=errorData.context_info.conflicts.id;!this.fileId&&conflictFileId&&(this.fileId=conflictFileId)}else if(this.conflictCallback)this.fileName=this.conflictCallback(this.fileName);else{const extension=this.fileName.substr(this.fileName.lastIndexOf("."))||"";this.fileName="".concat(this.fileName.substr(0,this.fileName.lastIndexOf(".")),"-").concat(Date.now()).concat(extension)}this.makePreflightRequest(),this.retryCount+=1}else if(!errorData||429!==errorData.status&&"too_many_requests"!==errorData.code)errorData&&(errorData.status||"Failed to fetch"===errorData.message)&&"function"==typeof this.errorCallback?this.errorCallback(errorData):(this.retryTimeout=setTimeout(this.makePreflightRequest,2**this.retryCount*constants.LCp),this.retryCount+=1);else{let retryAfterMs=constants.dXG;if(errorData.headers){const retryAfterSec=parseInt(errorData.headers["retry-after"]||errorData.headers.get("Retry-After"),10);Number.isNaN(retryAfterSec)||(retryAfterMs=retryAfterSec*constants.LCp)}this.retryTimeout=setTimeout(this.makePreflightRequest,retryAfterMs),this.retryCount+=1}}))}readFile(reader,blob){return new Promise(((resolve,reject)=>{reader.readAsArrayBuffer(blob),reader.onload=()=>{resolve({buffer:reader.result,readCompleteTimestamp:Date.now()})},reader.onerror=reject}))}getUploadHostFromUrl(uploadUrl){const splitUrl=uploadUrl.split("/");return"".concat(splitUrl[0],"//").concat(splitUrl[2],"/")}}const uploads_BaseUpload=BaseUpload;function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function BaseMultiput_defineProperty(obj,key,value){return(key=function BaseMultiput_toPropertyKey(t){var i=function BaseMultiput_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const DEFAULT_MULTIPUT_CONFIG={digestReadahead:5,initialRetryDelayMs:5e3,maxRetryDelayMs:6e4,parallelism:4,requestTimeoutMs:12e4,retries:5};const uploads_BaseMultiput=class BaseMultiput extends uploads_BaseUpload{constructor(options,sessionEndpoints,config){super(function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){BaseMultiput_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({},options,{shouldRetry:!1})),BaseMultiput_defineProperty(this,"logEvent",((eventType,eventInfo)=>{const data={event_type:eventType};return eventInfo&&(data.event_info=eventInfo),this.xhr.post({url:this.sessionEndpoints.logEvent,data})})),this.config=config||DEFAULT_MULTIPUT_CONFIG,this.sessionEndpoints=sessionEndpoints}};function MultiputPart_defineProperty(obj,key,value){return(key=function MultiputPart_toPropertyKey(t){var i=function MultiputPart_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const uploads_MultiputPart=class MultiputPart extends uploads_BaseMultiput{constructor(options,index,offset,partSize,fileSize,sessionId,sessionEndpoints,config,getNumPartsUploading,onSuccess,onProgress,onError){super(options,sessionEndpoints,config),MultiputPart_defineProperty(this,"toJSON",(()=>JSON.stringify({index:this.index,offset:this.offset,partSize:this.partSize,state:this.state,uploadedBytes:this.uploadedBytes,numUploadRetriesPerformed:this.numUploadRetriesPerformed,numDigestRetriesPerformed:this.numDigestRetriesPerformed,sha1:this.sha1,timing:this.timing}))),MultiputPart_defineProperty(this,"getPart",(()=>this.data.part||{})),MultiputPart_defineProperty(this,"upload",(()=>{if(this.isDestroyedOrPaused())return;if(!this.sha1)throw new Error("Part SHA-1 unavailable");if(!this.blob)throw new Error("Part blob unavailable");const clientEventInfo={documentHidden:document.hidden,digest_retries:this.numDigestRetriesPerformed,timing:this.timing,parts_uploading:this.getNumPartsUploading()},headers={"Content-Type":"application/octet-stream",Digest:"sha=".concat(this.sha1),"Content-Range":"bytes ".concat(this.offset,"-").concat(this.rangeEnd,"/").concat(this.fileSize),"X-Box-Client-Event-Info":JSON.stringify(clientEventInfo)};this.state=2,this.startTimestamp=Date.now(),this.xhr.uploadFile({url:this.sessionEndpoints.uploadPart,data:this.blob,headers,method:constants.PMc,successHandler:this.uploadSuccessHandler,errorHandler:this.uploadErrorHandler,progressHandler:this.uploadProgressHandler,withIdleTimeout:!0,idleTimeoutDuration:this.config.requestTimeoutMs})})),MultiputPart_defineProperty(this,"uploadSuccessHandler",(_ref=>{let{data}=_ref;this.isDestroyedOrPaused()||(this.state=3,this.consoleLog("Upload completed: ".concat(this.toJSON(),".")),this.data=data,this.blob=null,this.timing.uploadTime=Date.now()-this.startTimestamp,this.onSuccess(this),this.uploadedBytes=this.partSize)})),MultiputPart_defineProperty(this,"uploadProgressHandler",(event=>{if(this.isDestroyedOrPaused())return;const newUploadedBytes=parseInt(event.loaded,10),prevUploadedBytes=this.uploadedBytes;this.uploadedBytes=newUploadedBytes,this.onProgress(prevUploadedBytes,newUploadedBytes)})),MultiputPart_defineProperty(this,"uploadErrorHandler",(async error=>{if(this.isDestroyedOrPaused())return;const xhr_ready_state=get_default()(this.xhr,"xhr.readyState",null),xhr_status_text=get_default()(this.xhr,"xhr.statusText","");this.consoleLog("Upload failure ".concat(error.message," for part ").concat(this.toJSON(),". XHR state: ").concat(xhr_ready_state,"."));const eventInfo={message:error.message,part:{uploadedBytes:this.uploadedBytes,id:this.id,index:this.index,offset:this.offset},xhr_ready_state,xhr_status_text},eventInfoString=JSON.stringify(eventInfo);if(this.sessionEndpoints.logEvent?(0,utils_function.j)(((resolve,reject)=>{this.logEvent("part_failure",eventInfoString).then(resolve).catch(reject)}),this.config.retries,this.config.initialRetryDelayMs).catch((e=>this.consoleLog("Failure in logEvent: ".concat(e.message)))):this.consoleLog("logEvent endpoint not found"),this.numUploadRetriesPerformed>=this.config.retries)return void this.onError(error,eventInfoString);const retryDelayMs=(0,uploads.uM)(this.config.initialRetryDelayMs,this.config.maxRetryDelayMs,this.numUploadRetriesPerformed);this.numUploadRetriesPerformed+=1,this.consoleLog("Retrying uploading part ".concat(this.toJSON()," in ").concat(retryDelayMs," ms")),this.retryTimeout=setTimeout(this.retryUpload,retryDelayMs)})),MultiputPart_defineProperty(this,"retryUpload",(async()=>{if(!this.isDestroyedOrPaused())try{const parts=await this.listParts(this.index,1);if(parts&&1===parts.length&&parts[0].offset===this.offset&&parts[0].part_id)return this.consoleLog("Part ".concat(this.toJSON()," is available on server. Not re-uploading.")),this.id=parts[0].part_id,void this.uploadSuccessHandler({data:{part:parts[0]}});throw this.consoleLog("Part ".concat(this.toJSON()," is not available on server. Re-uploading.")),new Error("Part not found on the server")}catch(error){const{response}=error;response&&response.status&&this.consoleLog("Error ".concat(response.status," while listing part ").concat(this.toJSON(),". Re-uploading.")),this.numUploadRetriesPerformed+=1,this.upload()}})),MultiputPart_defineProperty(this,"listParts",(async(partIndex,limit)=>{const params={offset:partIndex,limit},endpoint=function updateQueryParameters(url,queryParams){if(!queryParams)return url;const uri=new(Uri_default())(url);return Object.keys(queryParams).forEach((key=>{const value=queryParams[key];value&&(uri.hasQueryParam(key)?uri.replaceQueryParam(key,value):uri.addQueryParam(key,value))})),uri.toString()}(this.sessionEndpoints.listParts,params);return(await this.xhr.get({url:endpoint})).data.entries})),this.index=index,this.numDigestRetriesPerformed=0,this.numUploadRetriesPerformed=0,this.offset=offset,this.partSize=partSize,this.fileSize=fileSize,this.state=0,this.timing={},this.uploadedBytes=0,this.data={},this.config=config,this.rangeEnd=offset+partSize-1,this.rangeEnd>fileSize-1&&(this.rangeEnd=fileSize-1),this.isPaused=!1,this.onSuccess=onSuccess||noop_default(),this.onError=onError||noop_default(),this.onProgress=onProgress||noop_default(),this.getNumPartsUploading=getNumPartsUploading}cancel(){clearTimeout(this.retryTimeout),this.blob=null,this.data={},this.destroy()}pause(){clearTimeout(this.retryTimeout),this.isPaused=!0,this.state=1,this.xhr.abort()}unpause(){this.isPaused=!1,this.state=2,this.retryUpload()}reset(){this.numUploadRetriesPerformed=0,this.timing={},this.uploadedBytes=0}isDestroyedOrPaused(){return this.isDestroyed()||this.isPaused}};function MultiputUpload_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function MultiputUpload_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?MultiputUpload_ownKeys(Object(t),!0).forEach((function(r){MultiputUpload_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):MultiputUpload_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function MultiputUpload_defineProperty(obj,key,value){return(key=function MultiputUpload_toPropertyKey(t){var i=function MultiputUpload_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const uploads_MultiputUpload=class MultiputUpload extends uploads_BaseMultiput{constructor(options,config){super(options,{createSession:null,uploadPart:null,listParts:null,commit:null,abort:null,logEvent:null},config),MultiputUpload_defineProperty(this,"getBaseUploadUrlFromPreflightResponse",(_ref=>{let{data}=_ref;if(!data||!data.upload_url)return this.getBaseUploadUrl();const splitUrl=data.upload_url.split("/");return this.uploadHost="".concat(splitUrl[0],"//").concat(splitUrl[2]),this.getBaseUploadUrl()})),MultiputUpload_defineProperty(this,"preflightSuccessHandler",(async preflightResponse=>{if(this.isDestroyed())return;const uploadUrl=this.getBaseUploadUrlFromPreflightResponse(preflightResponse);let createSessionUrl="".concat(uploadUrl,"/files/upload_sessions");createSessionUrl.includes("fupload-ec2")&&(this.config.parallelism=1);const postData={file_size:this.file.size,file_name:this.fileName};this.fileId?createSessionUrl=createSessionUrl.replace("upload_sessions","".concat(this.fileId,"/upload_sessions")):postData.folder_id=this.folderId;try{const response=await this.xhr.post({url:createSessionUrl,data:postData});this.createSessionSuccessHandler(response.data)}catch(error){const errorData=this.getErrorResponse(error);if(errorData&&errorData.status>=500&&errorData.status<600)return void this.createSessionErrorHandler(error);if(errorData&&409===errorData.status&&"session_conflict"===errorData.code)return void this.createSessionSuccessHandler(errorData.context_info.session);if(errorData&&errorData.status===constants.Ebv&&errorData.code===constants.UFL||errorData.status===constants.Ebv&&"access_denied_insufficient_permissions"===errorData.code)return void this.errorCallback(errorData);if(errorData&&409===errorData.status)return this.resolveConflict(errorData),void this.createSessionRetry();this.sessionErrorHandler(error,"create_session_misc_error",JSON.stringify(error))}})),MultiputUpload_defineProperty(this,"createSessionErrorHandler",(error=>{this.isDestroyed()||(this.createSessionNumRetriesPerformed<this.config.retries?this.createSessionRetry():(this.consoleLog("Too many create session failures, failing upload"),this.sessionErrorHandler(error,"create_session_retries_exceeded",JSON.stringify(error))))})),MultiputUpload_defineProperty(this,"getSessionInfo",(async()=>{const uploadUrl=this.getBaseUploadUrl(),sessionUrl="".concat(uploadUrl,"/files/upload_sessions/").concat(this.sessionId);try{const response=await this.xhr.get({url:sessionUrl});this.getSessionSuccessHandler(response.data)}catch(error){this.getSessionErrorHandler(error)}})),MultiputUpload_defineProperty(this,"partUploadSuccessHandler",(part=>{this.numPartsUploading-=1,this.numPartsUploaded+=1,this.updateProgress(part.uploadedBytes,this.partSize),this.processNextParts()})),MultiputUpload_defineProperty(this,"partUploadErrorHandler",((error,eventInfo)=>{if(this.sessionErrorHandler(error,"part_upload_retries_exceeded",eventInfo),this.isResumableUploadsEnabled){let nextUploadIndex=this.firstUnuploadedPartIndex;for(;this.numPartsUploading>0;){const part=this.parts[nextUploadIndex];part&&2===part.state&&(part.reset(),part.pause(),this.numPartsUploading-=1,this.numPartsDigestReady+=1),nextUploadIndex+=1}}})),MultiputUpload_defineProperty(this,"updateProgress",((prevUploadedBytes,newUploadedBytes)=>{this.isDestroyed()||(this.totalUploadedBytes+=newUploadedBytes-prevUploadedBytes,this.progressCallback({loaded:this.totalUploadedBytes,total:this.file.size}))})),MultiputUpload_defineProperty(this,"processNextParts",(()=>{if(!this.failSessionIfFileChangeDetected())if(this.numPartsUploaded===this.parts.length&&this.fileSha1)this.commitSession();else{for(this.updateFirstUnuploadedPartIndex();this.canStartMorePartUploads();)this.uploadNextPart();this.shouldComputeDigestForNextPart()&&this.computeDigestForNextPart()}})),MultiputUpload_defineProperty(this,"onWorkerMessage",(event=>{if(this.isDestroyed())return;const{data}=event;if("partDone"===data.type){const{part}=data;this.parts[part.index].timing.fileDigestTime=data.duration,this.processNextParts()}else"done"===data.type?(this.fileSha1=function hexToBase64(str){return btoa(String.fromCharCode.apply(null,str.replace(/\r|\n/g,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")))}(data.sha1),this.sha1Worker.terminate(),this.processNextParts()):"error"===data.type&&this.sessionErrorHandler(null,"web_worker_error",JSON.stringify(data))})),MultiputUpload_defineProperty(this,"sendPartToWorker",((part,buffer)=>{if(this.isDestroyed())return;const partInformation={index:part.index,offset:part.offset,size:part.partSize};this.sha1Worker.postMessage({part:partInformation,fileSize:this.file.size,partContents:buffer},[buffer]),this.consoleLog("Part sent to worker: ".concat(JSON.stringify(part),".}"))})),MultiputUpload_defineProperty(this,"onPartDigestError",((error,part)=>{if(this.consoleLog("Error computing digest for part ".concat(JSON.stringify(part),": ").concat(JSON.stringify(error))),"NotFoundError"===error.name||"NOT_FOUND_ERR"===error.name)return void this.sessionErrorHandler(null,"file_reader_received_not_found_error",JSON.stringify(error));if(this.failSessionIfFileChangeDetected())return;if(part.numDigestRetriesPerformed>=this.config.retries)return void this.sessionErrorHandler(null,"part_digest_retries_exceeded",JSON.stringify(error));const retryDelayMs=(0,uploads.uM)(this.config.initialRetryDelayMs,this.config.maxRetryDelayMs,part.numDigestRetriesPerformed);part.numDigestRetriesPerformed+=1,this.consoleLog("Retrying digest work for part ".concat(JSON.stringify(part)," in ").concat(retryDelayMs," ms")),setTimeout((()=>{this.computeDigestForPart(part)}),retryDelayMs)})),MultiputUpload_defineProperty(this,"commitSession",(()=>{if(this.isDestroyed())return;const stats={totalPartReadTime:0,totalPartDigestTime:0,totalFileDigestTime:0,totalPartUploadTime:0},data={parts:this.parts.map((part=>(stats.totalPartReadTime+=part.timing.readTime,stats.totalPartDigestTime+=part.timing.subtleCryptoTime,stats.totalFileDigestTime+=part.timing.fileDigestTime,stats.totalPartUploadTime+=part.timing.uploadTime,part.getPart()))).sort(((part1,part2)=>part1.offset-part2.offset)),attributes:{}},fileLastModified=(0,uploads.Kt)(this.file);fileLastModified&&(data.attributes.content_modified_at=fileLastModified),this.fileDescription&&(data.attributes.description=this.fileDescription);const clientEventInfo={avg_part_read_time:Math.round(stats.totalPartReadTime/this.parts.length),avg_part_digest_time:Math.round(stats.totalPartDigestTime/this.parts.length),avg_file_digest_time:Math.round(stats.totalFileDigestTime/this.parts.length),avg_part_upload_time:Math.round(stats.totalPartUploadTime/this.parts.length)},fileSha1=this.fileSha1,headers={Digest:"sha=".concat(fileSha1),"X-Box-Client-Event-Info":JSON.stringify(clientEventInfo)};this.xhr.post({url:this.sessionEndpoints.commit,data,headers}).then(this.commitSessionSuccessHandler).catch(this.commitSessionErrorHandler)})),MultiputUpload_defineProperty(this,"commitSessionSuccessHandler",(response=>{if(this.isDestroyed())return;const{status,data}=response;if(202===status)return void this.commitSessionRetry(response);let{entries}=data;!entries&&data.id&&(entries=[data]),this.destroy(),this.successCallback&&entries&&this.successCallback(entries)})),MultiputUpload_defineProperty(this,"commitSessionErrorHandler",(error=>{if(this.isDestroyed())return;const{response}=error;if(response)return this.commitRetryCount>=this.config.retries?(this.consoleLog("Too many commit failures, failing upload"),void this.sessionErrorHandler(error,"commit_retries_exceeded",JSON.stringify(error))):void this.commitSessionRetry(response);this.consoleError(error)})),MultiputUpload_defineProperty(this,"getNumPartsUploading",(()=>this.numPartsUploading)),this.parts=[],this.options=options,this.fileSha1=null,this.totalUploadedBytes=0,this.numPartsNotStarted=0,this.numPartsDigestComputing=0,this.numPartsDigestReady=0,this.numPartsUploading=0,this.numPartsUploaded=0,this.firstUnuploadedPartIndex=0,this.createSessionNumRetriesPerformed=0,this.partSize=0,this.commitRetryCount=0,this.clientId=null,this.isResumableUploadsEnabled=!1,this.numResumeRetries=0}reset(){this.parts=[],this.fileSha1=null,this.totalUploadedBytes=0,this.numPartsNotStarted=0,this.numPartsDigestComputing=0,this.numPartsDigestReady=0,this.numPartsUploading=0,this.numPartsUploaded=0,this.firstUnuploadedPartIndex=0,this.createSessionNumRetriesPerformed=0,this.partSize=0,this.commitRetryCount=0,this.numResumeRetries=0}setFileInfo(_ref2){let{file,folderId,errorCallback,progressCallback,successCallback,overwrite=!0,conflictCallback,fileId}=_ref2;this.file=file,this.fileName=this.file.name,this.folderId=folderId,this.errorCallback=errorCallback||noop_default(),this.progressCallback=progressCallback||noop_default(),this.successCallback=successCallback||noop_default(),this.overwrite=overwrite,this.conflictCallback=conflictCallback,this.fileId=fileId}upload(_ref3){let{file,fileDescription,folderId,errorCallback,progressCallback,successCallback,overwrite=!0,conflictCallback,fileId}=_ref3;this.file=file,this.fileName=this.file.name,this.initialFileSize=this.file.size,this.initialFileLastModified=(0,uploads.Kt)(this.file),this.folderId=folderId,this.errorCallback=errorCallback||noop_default(),this.progressCallback=progressCallback||noop_default(),this.successCallback=successCallback||noop_default(),this.sha1Worker=uploadsSHA1Worker(),this.sha1Worker.addEventListener("message",this.onWorkerMessage),this.conflictCallback=conflictCallback,this.overwrite=overwrite,this.fileId=fileId,this.fileDescription=fileDescription,this.makePreflightRequest()}createSessionRetry(){const retryDelayMs=(0,uploads.uM)(this.config.initialRetryDelayMs,this.config.maxRetryDelayMs,this.createSessionNumRetriesPerformed);this.createSessionNumRetriesPerformed+=1,this.consoleLog("Retrying create session in ".concat(retryDelayMs," ms")),this.createSessionTimeout=setTimeout(this.makePreflightRequest,retryDelayMs)}createSessionSuccessHandler(data){if(this.isDestroyed())return;const{id,part_size,session_endpoints}=data;this.sessionId=id,this.partSize=part_size,this.sessionEndpoints=MultiputUpload_objectSpread({},this.sessionEndpoints,{uploadPart:session_endpoints.upload_part,listParts:session_endpoints.list_parts,commit:session_endpoints.commit,abort:session_endpoints.abort,logEvent:session_endpoints.log_event}),this.populateParts(),this.processNextParts()}resume(_ref4){let{file,folderId,errorCallback,progressCallback,sessionId,successCallback,overwrite=!0,conflictCallback,fileId}=_ref4;this.setFileInfo({file,folderId,errorCallback,progressCallback,successCallback,conflictCallback,overwrite,fileId}),this.sessionId=sessionId,this.sha1Worker||(this.sha1Worker=uploadsSHA1Worker()),this.sha1Worker.addEventListener("message",this.onWorkerMessage),this.getSessionInfo()}getSessionSuccessHandler(data){const{part_size,session_endpoints}=data;this.partSize=part_size,this.sessionEndpoints=MultiputUpload_objectSpread({},this.sessionEndpoints,{uploadPart:session_endpoints.upload_part,listParts:session_endpoints.list_parts,commit:session_endpoints.commit,abort:session_endpoints.abort,logEvent:session_endpoints.log_event}),this.processNextParts()}getSessionErrorHandler(error){if(this.isDestroyed())return;const errorData=this.getErrorResponse(error);if(this.numResumeRetries>this.config.retries)this.errorCallback(errorData);else if(errorData&&429===errorData.status){let retryAfterMs=constants.dXG;if(errorData.headers){const retryAfterSec=parseInt(errorData.headers["retry-after"]||errorData.headers.get("Retry-After"),10);isNaN_default()(retryAfterSec)||(retryAfterMs=retryAfterSec*constants.LCp)}this.retryTimeout=setTimeout(this.getSessionInfo,retryAfterMs),this.numResumeRetries+=1}else if(errorData&&errorData.status>=400&&errorData.status<500){this.parts.forEach((part=>{part.cancel()})),this.reset(),clearTimeout(this.createSessionTimeout),clearTimeout(this.commitSessionTimeout),this.abortSession();const uploadOptions={file:this.file,folderId:this.folderId,errorCallback:this.errorCallback,progressCallback:this.progressCallback,successCallback:this.successCallback,overwrite:this.overwrite,fileId:this.fileId};this.upload(uploadOptions)}else this.retryTimeout=setTimeout(this.getSessionInfo,2**this.numResumeRetries*constants.LCp),this.numResumeRetries+=1}async sessionErrorHandler(error,logEventType,logMessage){this.isResumableUploadsEnabled||this.destroy();const errorData=this.getErrorResponse(error);this.errorCallback(errorData);try{if(!this.sessionEndpoints.logEvent)throw new Error("logEvent endpoint not found");await(0,utils_function.j)(((resolve,reject)=>{this.logEvent(logEventType,logMessage).then(resolve).catch(reject)}),this.config.retries,this.config.initialRetryDelayMs),this.isResumableUploadsEnabled||this.abortSession()}catch(err){this.isResumableUploadsEnabled||this.abortSession()}}abortSession(){this.sha1Worker&&this.sha1Worker.terminate(),this.sessionEndpoints.abort&&this.sessionId&&this.xhr.delete({url:this.sessionEndpoints.abort}).then((()=>{this.sessionId=""}))}shouldComputeDigestForNextPart(){return!this.isDestroyed()&&0===this.numPartsDigestComputing&&this.numPartsNotStarted>0&&this.numPartsDigestReady<this.config.digestReadahead}computeDigestForNextPart(){for(let i=this.firstUnuploadedPartIndex;i<this.parts.length;i+=1){const part=this.parts[i];if(0===part.state)return this.numPartsNotStarted-=1,this.numPartsDigestComputing+=1,void this.computeDigestForPart(part)}}async computeDigestForPart(part){const blob=this.file.slice(part.offset,part.offset+this.partSize),reader=new window.FileReader,startTimestamp=Date.now();try{const{buffer,readCompleteTimestamp}=await this.readFile(reader,blob),sha1ArrayBuffer=await digest("SHA-1",buffer),sha1=btoa([].reduce.call(new Uint8Array(sha1ArrayBuffer),((data,byte)=>data+String.fromCharCode(byte)),""));this.sendPartToWorker(part,buffer),part.sha1=sha1,part.state=1,part.blob=blob,this.numPartsDigestReady+=1,this.numPartsDigestComputing-=1;const digestCompleteTimestamp=Date.now();part.timing={partDigestTime:digestCompleteTimestamp-startTimestamp,readTime:readCompleteTimestamp-startTimestamp,subtleCryptoTime:digestCompleteTimestamp-readCompleteTimestamp},this.processNextParts()}catch(error){this.onPartDigestError(error,part)}}commitSessionRetry(response){const{status,headers}=response;let retryAfterMs=constants.dXG;if(headers){const retryAfterSec=parseInt(headers["retry-after"],10);Number.isNaN(retryAfterSec)||(retryAfterMs=1e3*retryAfterSec)}const defaultRetryDelayMs=(0,uploads.uM)(this.config.initialRetryDelayMs,this.config.maxRetryDelayMs,this.commitRetryCount);202!==status&&(this.commitRetryCount+=1);const retryDelayMs=retryAfterMs||defaultRetryDelayMs;this.consoleLog("Retrying commit in ".concat(retryDelayMs," ms")),this.commitSessionTimeout=setTimeout(this.commitSession,retryDelayMs)}uploadNextPart(){for(let i=this.firstUnuploadedPartIndex;i<this.parts.length;i+=1){const part=this.parts[i];if(1===part.state){this.numPartsDigestReady-=1,this.numPartsUploading+=1,part.isPaused?part.unpause():part.upload();break}}}canStartMorePartUploads(){return!this.isDestroyed()&&this.numPartsUploading<this.config.parallelism&&this.numPartsDigestReady>0}updateFirstUnuploadedPartIndex(){let part=this.parts[this.firstUnuploadedPartIndex];for(;part&&3===part.state;)this.firstUnuploadedPartIndex+=1,part=this.parts[this.firstUnuploadedPartIndex]}populateParts(){this.numPartsNotStarted=Math.ceil(this.file.size/this.partSize);for(let i=0;i<this.numPartsNotStarted;i+=1){const offset=i*this.partSize,currentPartSize=Math.min(offset+this.partSize,this.file.size)-offset,part=new uploads_MultiputPart(this.options,i,offset,currentPartSize,this.file.size,this.sessionId,this.sessionEndpoints,this.config,this.getNumPartsUploading,this.partUploadSuccessHandler,this.updateProgress,this.partUploadErrorHandler);this.parts.push(part)}}failSessionIfFileChangeDetected(){const currentFileSize=this.file.size,currentFileLastModified=(0,uploads.Kt)(this.file);if(currentFileSize!==this.initialFileSize||currentFileLastModified!==this.initialFileLastModified){const changeJSON=JSON.stringify({oldSize:this.initialFileSize,newSize:currentFileSize,oldLastModified:this.initialFileLastModified,newLastModified:currentFileLastModified});return Browser.Z.isIE()?(this.sessionErrorHandler(null,"file_changed_during_upload",changeJSON),!0):(this.consoleLog("file properties changed during upload: ".concat(changeJSON)),!1)}return!1}cancel(){this.isDestroyed()||(this.parts.forEach((part=>{part.cancel()})),this.parts=[],clearTimeout(this.createSessionTimeout),clearTimeout(this.commitSessionTimeout),this.abortSession(),this.destroy())}async resolveConflict(data){if(this.overwrite&&data.context_info)return void(this.fileId=data.context_info.conflicts.id);if(this.conflictCallback)return void(this.fileName=this.conflictCallback(this.fileName));const extension=this.fileName.substr(this.fileName.lastIndexOf("."))||"";this.fileName="".concat(this.fileName.substr(0,this.fileName.lastIndexOf(".")),"-").concat(Date.now()).concat(extension)}getErrorResponse(error){if(!error)return{};const{response}=error;return response?401===response.status?response:response.data:{}}};function PlainUpload_defineProperty(obj,key,value){return(key=function PlainUpload_toPropertyKey(t){var i=function PlainUpload_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const uploads_PlainUpload=class PlainUpload extends uploads_BaseUpload{constructor(){super(...arguments),PlainUpload_defineProperty(this,"uploadSuccessHandler",(_ref=>{let{data}=_ref;const{entries}=data;this.isDestroyed()||"function"==typeof this.successCallback&&this.successCallback(entries)})),PlainUpload_defineProperty(this,"uploadProgressHandler",(event=>{this.isDestroyed()||"function"==typeof this.progressCallback&&this.progressCallback(event)})),PlainUpload_defineProperty(this,"preflightSuccessHandler",(async _ref2=>{let{data}=_ref2;if(this.isDestroyed())return;let uploadUrl=data.upload_url;uploadUrl||(uploadUrl="".concat(this.getBaseUploadUrl(),"/files/content"),this.fileId&&(uploadUrl=uploadUrl.replace("content","".concat(this.fileId,"/content"))));const options={url:uploadUrl,data:{attributes:JSON.stringify({name:this.fileName,parent:{id:this.folderId},description:this.fileDescription,content_modified_at:(0,uploads.Kt)(this.file)}),file:this.file},headers:{},successHandler:this.uploadSuccessHandler,errorHandler:this.preflightErrorHandler,progressHandler:this.uploadProgressHandler},sha1=await this.computeSHA1(this.file);sha1&&(options.headers={"Content-MD5":sha1}),this.xhr.uploadFile(options)}))}upload(_ref3){let{folderId,fileId,file,fileDescription,successCallback=noop_default(),errorCallback=noop_default(),progressCallback=noop_default(),conflictCallback,overwrite=!0}=_ref3;this.isDestroyed()||(this.folderId=folderId,this.fileId=fileId,this.file=file,this.fileDescription=fileDescription,this.fileName=this.file.name,this.successCallback=successCallback,this.errorCallback=errorCallback,this.progressCallback=progressCallback,this.overwrite=overwrite,this.conflictCallback=conflictCallback,this.makePreflightRequest())}cancel(){this.isDestroyed()||(clearTimeout(this.retryTimeout),this.destroy())}async computeSHA1(file){let sha1="";try{const reader=new window.FileReader,{buffer}=await this.readFile(reader,file),hashBuffer=await digest("SHA-1",buffer);sha1=Array.from(new Uint8Array(hashBuffer)).map((b=>"00".concat(b.toString(16)).slice(-2))).join("")}catch(e){}return sha1}};var Folder=__webpack_require__("./src/api/Folder.js"),File=__webpack_require__("./src/api/File.js"),WebLink=__webpack_require__("./src/api/WebLink.js"),flatten=__webpack_require__("./src/utils/flatten.js"),utils_fields=__webpack_require__("./src/utils/fields.js"),error=__webpack_require__("./src/utils/error.js");function Search_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function Search_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Search_ownKeys(Object(t),!0).forEach((function(r){Search_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Search_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function Search_defineProperty(obj,key,value){return(key=function Search_toPropertyKey(t){var i=function Search_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class Search extends Base.Z{constructor(){super(...arguments),Search_defineProperty(this,"searchSuccessHandler",(_ref=>{let{data}=_ref;if(this.isDestroyed())return;const{entries,total_count,limit,offset}=data;if(!Array.isArray(entries)||"number"!=typeof total_count||"number"!=typeof limit||"number"!=typeof offset)throw(0,error.vz)();const flattened=(0,flatten.Z)(entries,new Folder.Z(this.options),new File.Z(this.options),new WebLink.Z(this.options));this.itemCache=(this.itemCache||[]).concat(flattened),this.getCache().set(this.key,{item_collection:Search_objectSpread({},data,{entries:this.itemCache})}),this.finish()})),Search_defineProperty(this,"searchErrorHandler",(error=>{this.isDestroyed()||this.errorCallback(error,this.errorCode)}))}getEncodedQuery(query){return encodeURIComponent(query)}getCacheKey(id,query){return"".concat(constants.dtD).concat(id,"|").concat(query)}getUrl(){return"".concat(this.getBaseApiUrl(),"/search")}isLoaded(){return this.getCache().has(this.key)}finish(){if(this.isDestroyed())return;const cache=this.getCache(),search=cache.get(this.key),{item_collection}=search;if(!item_collection)throw(0,error.vz)();const{entries,total_count}=item_collection;if(!Array.isArray(entries)||"number"!=typeof total_count)throw(0,error.vz)();const collection={id:this.id,items:entries.map((key=>cache.get(key))),offset:this.offset,percentLoaded:100,sortBy:constants.wnY,sortDirection:constants.hWS,totalCount:total_count};this.successCallback(collection)}searchRequest(){let options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.isDestroyed())return Promise.reject();const{fields}=options,requestFields=fields||utils_fields.YF;return this.errorCode=constants.A2K,this.xhr.get({url:this.getUrl(),params:{offset:this.offset,query:this.query,ancestor_folder_ids:this.id,limit:this.limit,fields:requestFields.toString()},headers:requestFields.includes(constants.cGX)?{"X-Rep-Hints":constants.APX}:{}}).then(this.searchSuccessHandler).catch(this.searchErrorHandler)}search(id,query,limit,offset,successCallback,errorCallback){let options=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};this.isDestroyed()||(this.limit=limit,this.offset=offset,this.query=query,this.id=id,this.key=this.getCacheKey(id,this.getEncodedQuery(this.query)),this.successCallback=successCallback,this.errorCallback=errorCallback,options.forceFetch&&this.getCache().unset(this.key),this.isLoaded()?this.finish():this.searchRequest(options))}}const api_Search=Search;function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}function Recents_defineProperty(obj,key,value){return(key=function Recents_toPropertyKey(t){var i=function Recents_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class Recents extends Base.Z{constructor(){super(...arguments),Recents_defineProperty(this,"recentsSuccessHandler",(_ref=>{let{data}=_ref;if(this.isDestroyed())return;const{entries,order:{by,direction}}=data,items=[];entries.forEach((_ref2=>{let{item,interacted_at}=_ref2;const{path_collection}=item;(this.id===constants.HV3||!!path_collection&&-1!==path_collection.entries.findIndex((crumb=>crumb.id===this.id)))&&items.push(_extends(item,{interacted_at}))}));const flattenedItems=(0,flatten.Z)(items,new Folder.Z(this.options),new File.Z(this.options),new WebLink.Z(this.options));this.getCache().set(this.key,{item_collection:{entries:flattenedItems,order:[{by,direction}]}}),this.finish()})),Recents_defineProperty(this,"recentsErrorHandler",(error=>{this.isDestroyed()||this.errorCallback(error,this.errorCode)}))}getCacheKey(id){return"".concat(constants.oEU).concat(id)}getUrl(){return"".concat(this.getBaseApiUrl(),"/recent_items")}finish(){if(this.isDestroyed())return;const cache=this.getCache(),recents=cache.get(this.key),{item_collection}=recents;if(!item_collection)throw(0,error.vz)();const{entries}=item_collection;if(!Array.isArray(entries))throw(0,error.vz)();const collection={id:this.id,items:entries.map((key=>cache.get(key))),percentLoaded:100,sortBy:constants.OKH,sortDirection:constants.hWS};this.successCallback(collection)}recentsRequest(){let options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.isDestroyed())return Promise.reject();const{fields}=options,requestFields=fields||utils_fields.YF;return this.errorCode=constants.uzK,this.xhr.get({url:this.getUrl(),params:{fields:requestFields.toString()},headers:requestFields.includes(constants.cGX)?{"X-Rep-Hints":constants.APX}:{}}).then(this.recentsSuccessHandler).catch(this.recentsErrorHandler)}recents(id,successCallback,errorCallback){let options=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(this.isDestroyed())return;this.id=id,this.successCallback=successCallback,this.errorCallback=errorCallback;const cache=this.getCache();this.key=this.getCacheKey(this.id),options.forceFetch&&cache.unset(this.key),cache.has(this.key)?this.finish():this.recentsRequest(options)}}const api_Recents=Recents;var utils_file=__webpack_require__("./src/utils/file.js");function OffsetBasedAPI_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function OffsetBasedAPI_defineProperty(obj,key,value){return(key=function OffsetBasedAPI_toPropertyKey(t){var i=function OffsetBasedAPI_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class OffsetBasedApi extends Base.Z{getQueryParameters(offset,limit,fields){const queryParams={offset,limit};return fields&&fields.length>0&&(queryParams.fields=fields.toString()),queryParams}hasMoreItems(offset,totalCount){return void 0===totalCount||offset<totalCount}async offsetGetRequest(id,offset,limit,shouldFetchAll,fields){if(!this.isDestroyed())try{const params=this.getQueryParameters(offset,limit,fields),url=this.getUrl(id),{data}=await this.xhr.get({url,id:(0,utils_file.mc)(id),params}),entries=this.data?this.data.entries:[];this.data=function OffsetBasedAPI_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?OffsetBasedAPI_ownKeys(Object(t),!0).forEach((function(r){OffsetBasedAPI_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):OffsetBasedAPI_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({},data,{entries:entries.concat(data.entries)});const totalCount=data.total_count,nextOffset=offset+limit;if(shouldFetchAll&&this.hasMoreItems(nextOffset,totalCount))return void this.offsetGetRequest(id,nextOffset,limit,shouldFetchAll,fields);this.successHandler(this.data)}catch(error){this.errorHandler(error)}}async offsetGet(id,successCallback,errorCallback){let offset=arguments.length>3&&void 0!==arguments[3]?arguments[3]:constants.CVe,limit=arguments.length>4&&void 0!==arguments[4]?arguments[4]:constants.XAo,fields=arguments.length>5?arguments[5]:void 0,shouldFetchAll=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return this.successCallback=successCallback,this.errorCallback=errorCallback,this.offsetGetRequest(id,offset,limit,shouldFetchAll,fields)}}const OffsetBasedAPI=OffsetBasedApi;function Versions_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function Versions_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Versions_ownKeys(Object(t),!0).forEach((function(r){Versions_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Versions_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}function Versions_defineProperty(obj,key,value){return(key=function Versions_toPropertyKey(t){var i=function Versions_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const api_Versions=class Versions extends OffsetBasedAPI{constructor(){super(...arguments),Versions_defineProperty(this,"successHandler",(data=>{this.isDestroyed()||"function"!=typeof this.successCallback||this.successCallback(data)}))}getUrl(id){if(!id)throw new Error("Missing file id!");return"".concat(this.getBaseApiUrl(),"/files/").concat(id,"/versions")}getVersionUrl(id,versionId){if(!versionId)throw new Error("Missing version id!");return"".concat(this.getUrl(id),"/").concat(versionId)}addPermissions(versions,file){if(!versions)return versions;const{entries,total_count}=versions,can_upload=get_default()(file,["permissions",constants.FDd],!1);return{entries:entries.map((_ref=>{let{permissions}=_ref;return Versions_objectSpread({},_objectWithoutProperties(_ref,["permissions"]),{permissions:Versions_objectSpread({can_upload},permissions)})})),total_count}}deleteVersion(_ref2){let{errorCallback,fileId,permissions,successCallback,versionId}=_ref2;this.errorCode=constants.IKS;try{this.checkApiCallValidity(constants.p0b,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}this.delete({id:fileId,url:this.getVersionUrl(fileId,versionId),successCallback,errorCallback})}getVersions(fileId,successCallback,errorCallback){let offset=arguments.length>3&&void 0!==arguments[3]?arguments[3]:constants.CVe,limit=arguments.length>4&&void 0!==arguments[4]?arguments[4]:constants.XAo,fields=arguments.length>5&&void 0!==arguments[5]?arguments[5]:utils_fields.Zk,shouldFetchAll=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];this.errorCode=constants.gZc,this.offsetGet(fileId,successCallback,errorCallback,offset,limit,fields,shouldFetchAll)}getVersion(fileId,fileVersionId,successCallback,errorCallback){this.errorCode=constants.ouI,this.get({id:fileId,successCallback,errorCallback,url:this.getVersionUrl(fileId,fileVersionId),requestData:{params:{fields:utils_fields.Zk.toString()}}})}addCurrentVersion(currentVersion,versions,file){if(!currentVersion)return versions||{entries:[],total_count:0};if(!versions)return{entries:[currentVersion],total_count:1};const promotedFromId=get_default()(file,"restored_from.id"),promotedVersion=versions.entries.find((version=>version.id===promotedFromId));return promotedVersion&&(currentVersion.version_promoted=promotedVersion.version_number),{entries:[...versions.entries,currentVersion],total_count:versions.total_count+1}}promoteVersion(_ref3){let{errorCallback,fileId,permissions,successCallback,versionId}=_ref3;this.errorCode=constants.ubs;try{this.checkApiCallValidity(constants.FDd,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}this.post({id:fileId,data:{data:{id:versionId,type:"file_version"}},url:this.getVersionUrl(fileId,"current"),successCallback,errorCallback})}restoreVersion(_ref4){let{errorCallback,fileId,permissions,successCallback,versionId}=_ref4;this.errorCode=constants._Ox;try{this.checkApiCallValidity(constants.p0b,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}this.put({id:fileId,data:{data:{trashed_at:null}},url:this.getVersionUrl(fileId,versionId),successCallback,errorCallback})}};function Comments_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function Comments_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Comments_ownKeys(Object(t),!0).forEach((function(r){Comments_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Comments_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function Comments_defineProperty(obj,key,value){return(key=function Comments_toPropertyKey(t){var i=function Comments_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const api_Comments=class Comments extends OffsetBasedAPI{constructor(){super(...arguments),Comments_defineProperty(this,"successHandler",(data=>{if(this.isDestroyed()||"function"!=typeof this.successCallback)return;if(!data)return void this.successCallback();if(!data.entries)return void this.successCallback(this.format(data));const comments=data.entries.map(this.format);this.successCallback(Comments_objectSpread({},data,{entries:comments}))}))}getUrl(id){if(!id)throw new Error("Missing file id!");return"".concat(this.getBaseApiUrl(),"/files/").concat(id,"/comments")}commentsUrl(id){const baseUrl="".concat(this.getBaseApiUrl(),"/comments");return id?"".concat(baseUrl,"/").concat(id):baseUrl}format(comment){return Comments_objectSpread({},comment,{tagged_message:""!==comment.tagged_message?comment.tagged_message:comment.message})}createComment(_ref){let{file,message,taggedMessage,successCallback,errorCallback}=_ref;this.errorCode=constants.AQu;const{id="",permissions}=file;try{this.checkApiCallValidity(constants.C69,permissions,id)}catch(e){return void errorCallback(e,this.errorCode)}const requestData={data:{item:{id,type:"file"},message,tagged_message:taggedMessage},params:{fields:utils_fields.LG.toString()}};this.post({id,url:this.commentsUrl(),data:requestData,successCallback,errorCallback})}updateComment(_ref2){let{file,commentId,message,tagged_message,permissions,successCallback,errorCallback}=_ref2;this.errorCode=constants.gYx;const{id=""}=file;try{this.checkApiCallValidity(constants.AAt,permissions,id)}catch(e){return void errorCallback(e,this.errorCode)}const requestData={data:{message,tagged_message}};this.put({id,url:this.commentsUrl(commentId),data:requestData,successCallback,errorCallback})}deleteComment(_ref3){let{file,commentId,permissions,successCallback,errorCallback}=_ref3;this.errorCode=constants.g5Q;const{id=""}=file;try{this.checkApiCallValidity(constants.p0b,permissions,id)}catch(e){return void errorCallback(e,this.errorCode)}this.delete({id,url:this.commentsUrl(commentId),successCallback,errorCallback})}getComments(fileId,permissions,successCallback,errorCallback){let fields=arguments.length>4&&void 0!==arguments[4]?arguments[4]:utils_fields.LG,offset=arguments.length>5?arguments[5]:void 0,limit=arguments.length>6?arguments[6]:void 0,shouldFetchAll=arguments.length>7?arguments[7]:void 0;this.errorCode=constants.Mzr;try{this.checkApiCallValidity(constants.C69,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}this.offsetGet(fileId,successCallback,errorCallback,offset,limit,fields,shouldFetchAll)}};function TasksBase_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function TasksBase_defineProperty(obj,key,value){return(key=function TasksBase_toPropertyKey(t){var i=function TasksBase_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function TasksBase_objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function TasksBase_objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}const RETRYABLE=[constants.QUF,constants.olu,constants.GAo,constants.gz,constants.vST,constants.SJd];class TasksBase extends Base.Z{constructor(_ref){let{retryableStatusCodes=RETRYABLE}=_ref;super(function TasksBase_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?TasksBase_ownKeys(Object(t),!0).forEach((function(r){TasksBase_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):TasksBase_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({},TasksBase_objectWithoutProperties(_ref,["retryableStatusCodes"]),{retryableStatusCodes}))}}const tasks_TasksBase=TasksBase;function TasksNew_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function TasksNew_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?TasksNew_ownKeys(Object(t),!0).forEach((function(r){TasksNew_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):TasksNew_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function TasksNew_defineProperty(obj,key,value){return(key=function TasksNew_toPropertyKey(t){var i=function TasksNew_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function TasksNew_objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function TasksNew_objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}const tasks_TasksNew=class TasksNew extends tasks_TasksBase{getUrlForFileTasks(id){return"".concat(this.getBaseApiUrl(),"/undoc/files/").concat(id,"/linked_tasks?limit=").concat(constants.w_G)}getUrlForTaskCreateWithDeps(){return"".concat(this.getBaseApiUrl(),"/undoc/tasks/with_dependencies")}getUrlForTask(id){return"".concat(this.getBaseApiUrl(),"/undoc/tasks/").concat(id)}getUrlForTaskWithDeps(id){return"".concat(this.getBaseApiUrl(),"/undoc/tasks/").concat(id,"/with_dependencies")}updateTaskWithDeps(_ref){let{errorCallback,file,successCallback,task}=_ref;this.errorCode=constants.PLP;const createTaskCollabsPayload=task.addedAssignees.map((assignee=>({op:assignee.item&&"group"===assignee.item.type?"add_task_collaborators_expand_group":"add_task_collaborator",payload:{target:{type:assignee.item&&"group"===assignee.item.type?"group":"user",id:assignee.id}}}))),deleteTaskCollabsPayload=task.removedAssignees.map((assignee=>({op:"delete_task_collaborator",id:assignee.id}))),{id,addedAssignees,removedAssignees}=task,updateTaskPayload=TasksNew_objectWithoutProperties(task,["id","addedAssignees","removedAssignees"]);this.put({id:file.id,url:this.getUrlForTaskWithDeps(task.id),data:{data:[{op:"update_task",payload:TasksNew_objectSpread({},updateTaskPayload)},...createTaskCollabsPayload,...deleteTaskCollabsPayload]},successCallback,errorCallback})}deleteTask(_ref2){let{errorCallback,file,successCallback,task}=_ref2;this.errorCode=constants.TLE,this.delete({id:file.id,url:this.getUrlForTask(task.id),successCallback,errorCallback})}getTasksForFile(_ref3){let{errorCallback,file,successCallback}=_ref3;this.errorCode=constants.ilT,this.get({id:file.id,url:this.getUrlForFileTasks(file.id),successCallback,errorCallback})}getTask(_ref4){let{errorCallback,file,id,successCallback}=_ref4;this.errorCode=constants.ilT,this.get({id:file.id,url:this.getUrlForTask(id),successCallback,errorCallback})}createTaskWithDeps(_ref5){let{errorCallback,file,successCallback,task,assignees}=_ref5;this.errorCode=constants.bgA;const createTaskCollabsPayload=assignees.map((assignee=>({target:{type:assignee.item&&"group"===assignee.item.type?"group":"user",id:assignee.id}}))),createTaskLinksPayload=[{target:{id:file.id,type:"file"}}],createTaskWithDepsPayload={task:TasksNew_objectSpread({},task),assigned_to:createTaskCollabsPayload,task_links:createTaskLinksPayload};this.post({id:file.id,url:this.getUrlForTaskCreateWithDeps(),data:{data:TasksNew_objectSpread({},createTaskWithDepsPayload)},successCallback,errorCallback})}};var omit=__webpack_require__("./node_modules/lodash/omit.js"),omit_default=__webpack_require__.n(omit);function TaskCollaborators_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function TaskCollaborators_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?TaskCollaborators_ownKeys(Object(t),!0).forEach((function(r){TaskCollaborators_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):TaskCollaborators_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function TaskCollaborators_defineProperty(obj,key,value){return(key=function TaskCollaborators_toPropertyKey(t){var i=function TaskCollaborators_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const tasks_TaskCollaborators=class TaskCollaborators extends tasks_TasksBase{getUrlForTaskCollaborators(taskId){return"".concat(this.getBaseApiUrl(),"/undoc/tasks/").concat(taskId,"/task_collaborators?role=ASSIGNEE&limit=").concat(constants.w_G)}getUrlForTaskCollaboratorCreate(){return"".concat(this.getBaseApiUrl(),"/undoc/task_collaborators")}getUrlForTaskCollaborator(id){return"".concat(this.getBaseApiUrl(),"/undoc/task_collaborators/").concat(id)}getUrlForTaskGroupCreate(){return"".concat(this.getBaseApiUrl(),"/undoc/task_collaborators/expand_group")}createTaskCollaborator(_ref){let{errorCallback,file,successCallback,task,user}=_ref;this.errorCode=constants.Ci5;const requestData={data:{task:{type:"task",id:task.id},target:{type:"user",id:user.id}}};this.post({id:file.id,url:this.getUrlForTaskCollaboratorCreate(),data:TaskCollaborators_objectSpread({},requestData),successCallback,errorCallback})}createTaskCollaboratorsforGroup(_ref2){let{errorCallback,file,successCallback,task,group}=_ref2;this.errorCode=constants.Ci5;const requestData={data:{task:{type:"task",id:task.id},target:{type:"group",id:group.id}}};this.post({id:file.id,url:this.getUrlForTaskGroupCreate(),data:TaskCollaborators_objectSpread({},requestData),successCallback,errorCallback})}getTaskCollaborators(_ref3){let{errorCallback,file,successCallback,task}=_ref3;this.errorCode=constants.MnT;const url=this.getUrlForTaskCollaborators(task.id);this.get({id:file.id,successCallback,errorCallback,url})}updateTaskCollaborator(_ref4){let{errorCallback,file,successCallback,taskCollaborator}=_ref4;this.errorCode=constants.$Et;const requestData={data:omit_default()(taskCollaborator,"id")};this.put({id:file.id,url:this.getUrlForTaskCollaborator(taskCollaborator.id),data:TaskCollaborators_objectSpread({},requestData),successCallback,errorCallback})}deleteTaskCollaborator(_ref5){let{errorCallback,file,successCallback,taskCollaborator}=_ref5;this.errorCode=constants.kT4,this.delete({id:file.id,url:this.getUrlForTaskCollaborator(taskCollaborator.id),successCallback,errorCallback})}};function TaskLinks_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function TaskLinks_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?TaskLinks_ownKeys(Object(t),!0).forEach((function(r){TaskLinks_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):TaskLinks_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function TaskLinks_defineProperty(obj,key,value){return(key=function TaskLinks_toPropertyKey(t){var i=function TaskLinks_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const tasks_TaskLinks=class TaskLinks extends tasks_TasksBase{getUrlForTaskLinkCreate(){return"".concat(this.getBaseApiUrl(),"/undoc/task_links")}createTaskLink(_ref){let{errorCallback,file,successCallback,task}=_ref;this.errorCode=constants.NXm;const requestData={data:{target:{id:file.id,type:"file"},task:{id:task.id,type:"task"}}};this.post({id:file.id,url:this.getUrlForTaskLinkCreate(),data:TaskLinks_objectSpread({},requestData),successCallback,errorCallback})}};function MarkerBasedAPI_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function MarkerBasedAPI_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?MarkerBasedAPI_ownKeys(Object(t),!0).forEach((function(r){MarkerBasedAPI_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):MarkerBasedAPI_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function MarkerBasedAPI_defineProperty(obj,key,value){return(key=function MarkerBasedAPI_toPropertyKey(t){var i=function MarkerBasedAPI_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class MarkerBasedApi extends Base.Z{hasMoreItems(marker){return null!==marker&&""!==marker}async markerGetRequest(id,marker,limit,shouldFetchAll){let requestData=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(!this.isDestroyed())try{const url=this.getUrl(id),queryParams=MarkerBasedAPI_objectSpread({},requestData,{marker,limit}),{data}=await this.xhr.get({url,id:(0,utils_file.mc)(id),params:queryParams}),entries=this.data?this.data.entries:[];this.data=MarkerBasedAPI_objectSpread({},data,{entries:entries.concat(data.entries)});const nextMarker=data.next_marker;if(shouldFetchAll&&this.hasMoreItems(nextMarker))return void this.markerGetRequest(id,nextMarker,limit,shouldFetchAll,requestData);this.successHandler(this.data)}catch(error){this.errorHandler(error)}}async markerGet(_ref){let{id,successCallback,errorCallback,marker="",limit=1e3,requestData,shouldFetchAll=!0}=_ref;return this.successCallback=successCallback,this.errorCallback=errorCallback,this.markerGetRequest(id,marker,limit,shouldFetchAll,requestData)}}const MarkerBasedAPI=MarkerBasedApi;function utils_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function utils_defineProperty(obj,key,value){return(key=function utils_toPropertyKey(t){var i=function utils_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const formatComment=comment=>{const formattedComment=function utils_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?utils_ownKeys(Object(t),!0).forEach((function(r){utils_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):utils_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({},comment,{tagged_message:comment.message});return comment.replies&&comment.replies.length&&(formattedComment.replies=comment.replies.map(formatComment)),formattedComment};function ThreadedComments_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function ThreadedComments_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ThreadedComments_ownKeys(Object(t),!0).forEach((function(r){ThreadedComments_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ThreadedComments_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function ThreadedComments_defineProperty(obj,key,value){return(key=function ThreadedComments_toPropertyKey(t){var i=function ThreadedComments_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const api_ThreadedComments=class ThreadedComments extends MarkerBasedAPI{constructor(){super(...arguments),ThreadedComments_defineProperty(this,"successHandler",(data=>{if(this.isDestroyed()||"function"!=typeof this.successCallback)return;if(!data)return void this.successCallback();if(!data.entries)return void this.successCallback(formatComment(data));const comments=data.entries.map(formatComment);this.successCallback(ThreadedComments_objectSpread({},data,{entries:comments}))}))}getUrl(fileId){return"".concat(this.getBaseApiUrl(),"/undoc/comments").concat(fileId?"?file_id=".concat(fileId):"")}getUrlForId(commentId){return"".concat(this.getUrl(),"/").concat(commentId)}getUrlWithRepliesForId(commentId,fileId){return"".concat(this.getUrlForId(commentId),"/replies").concat(fileId?"?file_id=".concat(fileId):"")}createComment(_ref){let{file,message,successCallback,errorCallback}=_ref;this.errorCode=constants.AQu;const{id,permissions}=file;try{this.checkApiCallValidity(constants.C69,permissions,id)}catch(e){return void errorCallback(e,this.errorCode)}this.post({id,url:this.getUrl(id),data:{data:{message}},successCallback,errorCallback})}updateComment(_ref2){let{fileId,commentId,status,message,permissions,successCallback,errorCallback}=_ref2;if(this.errorCode=constants.gYx,message)try{this.checkApiCallValidity(constants.AAt,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}if(status)try{this.checkApiCallValidity(constants.qS2,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}const requestData={data:{status,message}};this.put({id:fileId,url:this.getUrlForId(commentId),data:requestData,successCallback,errorCallback})}deleteComment(_ref3){let{fileId,commentId,permissions,successCallback,errorCallback}=_ref3;this.errorCode=constants.g5Q;try{this.checkApiCallValidity(constants.p0b,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}this.delete({id:fileId,url:this.getUrlForId(commentId),successCallback,errorCallback})}getComment(_ref4){let{commentId,errorCallback,fileId,permissions,successCallback}=_ref4;this.errorCode=constants.bOA;try{this.checkApiCallValidity(constants.C69,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}this.get({id:fileId,errorCallback,successCallback,url:this.getUrlForId(commentId)})}getComments(_ref5){let{fileId,permissions,successCallback,errorCallback,marker,limit,shouldFetchAll,repliesCount}=_ref5;this.errorCode=constants.Mzr;try{this.checkApiCallValidity(constants.C69,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}this.markerGet({id:fileId,successCallback,errorCallback,marker,limit,requestData:ThreadedComments_objectSpread({},repliesCount?{replies_count:repliesCount}:null),shouldFetchAll})}getCommentReplies(_ref6){let{fileId,commentId,permissions,successCallback,errorCallback}=_ref6;this.errorCode=constants.Cb_;try{this.checkApiCallValidity(constants.C69,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}this.get({id:fileId,errorCallback,successCallback,url:this.getUrlWithRepliesForId(commentId)})}createCommentReply(_ref7){let{fileId,commentId,permissions,successCallback,errorCallback,message}=_ref7;this.errorCode=constants.S$h;try{this.checkApiCallValidity(constants.C69,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}this.post({id:fileId,data:{data:{message}},errorCallback,successCallback,url:this.getUrlWithRepliesForId(commentId,fileId)})}};class FileAccessStats extends Base.Z{getUrl(id){if(!id)throw new Error("Missing file id!");return"".concat(this.getBaseApiUrl(),"/file_access_stats/").concat(id)}getFileAccessStats(id,successCallback,errorCallback){this.errorCode=constants.ozf,this.get({id,successCallback,errorCallback})}}const api_FileAccessStats=FileAccessStats;function FileActivities_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function FileActivities_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?FileActivities_ownKeys(Object(t),!0).forEach((function(r){FileActivities_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):FileActivities_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function FileActivities_defineProperty(obj,key,value){return(key=function FileActivities_toPropertyKey(t){var i=function FileActivities_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class FileActivities extends Base.Z{getFilteredUrl(id,activityTypes,shouldShowReplies){return"".concat(this.getBaseApiUrl()).concat(function getFileActivityQueryParams(fileID){let activityTypes=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],shouldShowReplies=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const baseEndpoint="/file_activities?file_id=".concat(fileID),hasActivityTypes=!!activityTypes&&!!activityTypes.length,enabledRepliesQueryParam="&enable_replies=".concat(shouldShowReplies?"true":"false","&reply_limit=").concat(1),activityTypeQueryParam=hasActivityTypes?"&activity_types=".concat(activityTypes.join()):"";return"".concat(baseEndpoint).concat(activityTypeQueryParam).concat(enabledRepliesQueryParam)}(id,activityTypes,shouldShowReplies))}getActivities(_ref){let{activityTypes,errorCallback,fileID,permissions,repliesCount,shouldShowReplies,successCallback}=_ref;this.errorCode=constants.WrP;try{if(!fileID)throw new Error("Missing file id!");activityTypes.includes(constants.aoc)&&this.checkApiCallValidity(constants.C69,permissions,fileID),activityTypes.includes(constants.KLQ)&&this.checkApiCallValidity(constants.V34,permissions,fileID)}catch(e){return void errorCallback(e,this.errorCode)}this.get({id:fileID,successCallback,errorCallback,requestData:FileActivities_objectSpread({},repliesCount?{replies_count:repliesCount}:null),url:this.getFilteredUrl(fileID,activityTypes,shouldShowReplies)})}}const api_FileActivities=FileActivities;function MarkerBasedGroups_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function MarkerBasedGroups_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?MarkerBasedGroups_ownKeys(Object(t),!0).forEach((function(r){MarkerBasedGroups_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):MarkerBasedGroups_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function MarkerBasedGroups_defineProperty(obj,key,value){return(key=function MarkerBasedGroups_toPropertyKey(t){var i=function MarkerBasedGroups_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const api_MarkerBasedGroups=class MarkerBasedGroups extends MarkerBasedAPI{getUrl(){return"".concat(this.getBaseApiUrl(),"/groups")}getGroupsInEnterprise(id,successCallback,errorCallback,requestData){let limit=arguments.length>4&&void 0!==arguments[4]?arguments[4]:constants.b5M;this.errorCode=constants.l9U,this.markerGet({id,limit,successCallback,errorCallback,requestData:MarkerBasedGroups_objectSpread({usemarker:!0},requestData),shouldFetchAll:!1})}};function MarkerBasedUsers_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function MarkerBasedUsers_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?MarkerBasedUsers_ownKeys(Object(t),!0).forEach((function(r){MarkerBasedUsers_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):MarkerBasedUsers_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function MarkerBasedUsers_defineProperty(obj,key,value){return(key=function MarkerBasedUsers_toPropertyKey(t){var i=function MarkerBasedUsers_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const api_MarkerBasedUsers=class MarkerBasedUsers extends MarkerBasedAPI{getUrl(){return"".concat(this.getBaseApiUrl(),"/users")}getUsersInEnterprise(id,successCallback,errorCallback,requestData){let limit=arguments.length>4&&void 0!==arguments[4]?arguments[4]:constants.b5M;this.errorCode=constants.TJs,this.markerGet({id,limit,successCallback,errorCallback,requestData:MarkerBasedUsers_objectSpread({usemarker:!0},requestData),shouldFetchAll:!1})}};class Groups extends Base.Z{getUrlForGroupCount(id){return"".concat(this.getBaseApiUrl(),"/groups/").concat(id,"/memberships")}getGroupCount(_ref){let{errorCallback:_errorCallback=noop_default(),successCallback:_successCallback=noop_default(),group,file}=_ref;return new Promise(((resolve,reject)=>this.get({id:file.id,url:this.getUrlForGroupCount(group.id),successCallback:function successCallback(){_successCallback(...arguments),resolve(...arguments)},errorCallback:function errorCallback(){_errorCallback(...arguments),reject()},requestData:{params:{limit:1}}})))}}const api_Groups=Groups;var query_string=__webpack_require__("./node_modules/query-string/index.js"),TokenService=__webpack_require__("./src/utils/TokenService.js");class Users extends Base.Z{getUrl(){return"".concat(this.getBaseApiUrl(),"/users/me")}getAvatarUrl(id){if(!id)throw new Error("Missing user id");return"".concat(this.getBaseApiUrl(),"/users/").concat(id,"/avatar")}async getAvatarUrlWithAccessToken(userId,fileId){if(!userId)return null;const cache=this.getCache();if(cache.has(userId))return cache.get(userId);const accessToken=await TokenService.Z.getReadToken((0,utils_file.mc)(fileId),this.options.token);if("string"==typeof accessToken){const options={access_token:accessToken,pic_type:"large"},urlParams=query_string.stringify(options),url="".concat(this.getAvatarUrl(userId),"?").concat(urlParams);return cache.set(userId,url),url}return null}getUser(id,successCallback,errorCallback){let requestData=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.errorCode=constants.OwG,this.get({id,successCallback,errorCallback,requestData})}}const api_Users=Users;var uniqueId=__webpack_require__("./node_modules/lodash/uniqueId.js"),uniqueId_default=__webpack_require__.n(uniqueId);class Metadata extends File.Z{getMetadataCacheKey(id){return"".concat(constants.qeG).concat(id)}getSkillsCacheKey(id){return"".concat(this.getMetadataCacheKey(id),"_skills")}getClassificationCacheKey(id){return"".concat(this.getMetadataCacheKey(id),"_classification")}getMetadataUrl(id,scope,template){const baseUrl="".concat(this.getUrl(id),"/metadata");return scope&&template?"".concat(baseUrl,"/").concat(scope,"/").concat(template):baseUrl}getMetadataTemplateUrl(){return"".concat(this.getBaseApiUrl(),"/metadata_templates")}getMetadataTemplateUrlForInstance(id){return"".concat(this.getMetadataTemplateUrl(),"?metadata_instance_id=").concat(id)}getMetadataTemplateSchemaUrl(templateKey){return"".concat(this.getMetadataTemplateUrl(),"/enterprise/").concat(templateKey,"/schema")}getMetadataTemplateUrlForScope(scope){return"".concat(this.getMetadataTemplateUrl(),"/").concat(scope)}getCustomPropertiesTemplate(){return{id:uniqueId_default()("metadata_template_"),scope:constants.XZm,templateKey:constants.NXA,hidden:!1}}createEditor(instance,template,canEdit){const data={};return Object.keys(instance).forEach((key=>{key.startsWith("$")||(data[key]=instance[key])})),{template,instance:{id:instance.$id,canEdit:instance.$canEdit&&canEdit,data}}}async getTemplates(id,scope,instanceId){this.errorCode=constants.cP;let templates={};const url=instanceId?this.getMetadataTemplateUrlForInstance(instanceId):this.getMetadataTemplateUrlForScope(scope);try{templates=await this.xhr.get({url,id:(0,utils_file.mc)(id),params:{limit:constants.jmR}})}catch(e){const{status}=e;if((0,error.zg)(status))throw e}return get_default()(templates,"data.entries",[])}getSchemaByTemplateKey(templateKey){const url=this.getMetadataTemplateSchemaUrl(templateKey);return this.xhr.get({url})}async getInstances(id){this.errorCode=constants.xST;let instances={};try{instances=await this.xhr.get({url:this.getMetadataUrl(id),id:(0,utils_file.mc)(id)})}catch(e){const{status}=e;if((0,error.zg)(status))throw e}return get_default()(instances,"data.entries",[])}getUserAddableTemplates(customPropertiesTemplate,enterpriseTemplates,hasMetadataFeature,isExternallyOwned){let userAddableTemplates=[];return hasMetadataFeature&&(userAddableTemplates=isExternallyOwned?[customPropertiesTemplate]:[customPropertiesTemplate].concat(enterpriseTemplates)),userAddableTemplates.filter((template=>!template.hidden&&template.templateKey!==constants.II3))}extractClassification(id,instances){const classification=instances.find((instance=>instance.$template===constants.II3));if(classification){instances.splice(instances.indexOf(classification),1);const cache=this.getCache(),key=this.getClassificationCacheKey(id);cache.set(key,classification)}return instances}async getTemplateForInstance(id,instance,templates){const instanceId=instance.$id,templateKey=instance.$template,scope=instance.$scope;let template=templates.find((t=>t.templateKey===templateKey&&t.scope===scope));if(!template&&scope.startsWith(constants.xhn)){template=(await this.getTemplates(id,scope,instanceId))[0]}return template}async getEditors(id,instances,customPropertiesTemplate,enterpriseTemplates,globalTemplates,canEdit){const templates=[customPropertiesTemplate].concat(enterpriseTemplates,globalTemplates),filteredInstances=this.extractClassification(id,instances),editors=[];return await Promise.all(filteredInstances.map((async instance=>{const template=await this.getTemplateForInstance(id,instance,templates);template&&editors.push(this.createEditor(instance,template,canEdit))}))),editors}async getMetadata(file,successCallback,errorCallback,hasMetadataFeature){let options=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{id,permissions,is_externally_owned}=file;if(this.errorCode=constants.xST,this.successCallback=successCallback,this.errorCallback=errorCallback,!id||!permissions)return void this.errorHandler((0,error.vz)());const cache=this.getCache(),key=this.getMetadataCacheKey(id);if(options.forceFetch&&cache.unset(key),!cache.has(key)||(this.successHandler(cache.get(key)),options.refreshCache))try{const customPropertiesTemplate=this.getCustomPropertiesTemplate(),[instances,globalTemplates,enterpriseTemplates]=await Promise.all([this.getInstances(id),this.getTemplates(id,constants.XZm),hasMetadataFeature?this.getTemplates(id,constants.xhn):Promise.resolve([])]),metadata={editors:await this.getEditors(id,instances,customPropertiesTemplate,enterpriseTemplates,globalTemplates,!!permissions.can_upload),templates:this.getUserAddableTemplates(customPropertiesTemplate,enterpriseTemplates,hasMetadataFeature,is_externally_owned)};cache.set(key,metadata),this.isDestroyed()||this.successHandler(metadata)}catch(e){this.errorHandler(e)}}async getSkills(file,successCallback,errorCallback){let forceFetch=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.errorCode=constants.d5L;const{id}=file;if(!id)return void errorCallback((0,error.vz)(),this.errorCode);const cache=this.getCache(),key=this.getSkillsCacheKey(id);if(this.successCallback=successCallback,this.errorCallback=errorCallback,forceFetch&&cache.unset(key),cache.has(key))return void this.successHandler(cache.get(key));let skills={data:get_default()(file,constants.qah)};try{if(skills.data||(skills=await this.xhr.get({url:this.getMetadataUrl(id,constants.XZm,constants._Tf),id:(0,utils_file.mc)(id)})),!this.isDestroyed()){const cards=skills.data.cards||[];cache.set(key,cards),this.successHandler(cards)}}catch(e){this.errorHandler(e)}}async updateSkills(file,operations,successCallback,errorCallback){this.errorCode=constants.i9o;const{id,permissions}=file;if(id&&permissions)if(permissions.can_upload){this.successCallback=successCallback,this.errorCallback=errorCallback;try{const metadata=await this.xhr.put({url:this.getMetadataUrl(id,constants.XZm,constants._Tf),headers:{[constants.JdJ]:"application/json-patch+json"},id:(0,utils_file.mc)(id),data:operations});if(!this.isDestroyed()){const cards=metadata.data.cards||[];this.merge(this.getCacheKey(id),constants.qah,metadata.data),this.getCache().set(this.getSkillsCacheKey(id),cards),this.successHandler(cards)}}catch(e){this.errorHandler(e)}}else errorCallback((0,error.pm)(),this.errorCode);else errorCallback((0,error.vz)(),this.errorCode)}async updateMetadata(file,template,operations,successCallback,errorCallback){this.errorCode=constants.XSU,this.successCallback=successCallback,this.errorCallback=errorCallback;const{id,permissions}=file;if(!id||!permissions)return void this.errorHandler((0,error.vz)());const canEdit=!!permissions.can_upload;if(canEdit)try{const metadata=await this.xhr.put({url:this.getMetadataUrl(id,template.scope,template.templateKey),headers:{[constants.JdJ]:"application/json-patch+json"},id:(0,utils_file.mc)(id),data:operations});if(!this.isDestroyed()){const cache=this.getCache(),key=this.getMetadataCacheKey(id),cachedMetadata=cache.get(key),editor=this.createEditor(metadata.data,template,canEdit);cachedMetadata&&cachedMetadata.editors&&cachedMetadata.editors.splice(cachedMetadata.editors.findIndex((_ref=>{let{instance}=_ref;return instance.id===editor.instance.id})),1,editor),this.successHandler(editor)}}catch(e){this.errorHandler(e)}else this.errorHandler((0,error.pm)())}async createMetadata(file,template,successCallback,errorCallback){if(this.errorCode=constants.UtL,!file||!template)return void errorCallback((0,error.vz)(),this.errorCode);const{id,permissions,is_externally_owned}=file;if(!id||!permissions)return void errorCallback((0,error.vz)(),this.errorCode);const canEdit=!!permissions.can_upload,isProperties=template.templateKey===constants.NXA&&template.scope===constants.XZm;if(!canEdit||is_externally_owned&&!isProperties)errorCallback((0,error.pm)(),this.errorCode);else{this.successCallback=successCallback,this.errorCallback=errorCallback;try{const metadata=await this.xhr.post({url:this.getMetadataUrl(id,template.scope,template.templateKey),id:(0,utils_file.mc)(id),data:{}});if(!this.isDestroyed()){const cache=this.getCache(),key=this.getMetadataCacheKey(id),cachedMetadata=cache.get(key),editor=this.createEditor(metadata.data,template,canEdit);cachedMetadata.editors.push(editor),this.successHandler(editor)}}catch(e){this.errorHandler(e)}}}async deleteMetadata(file,template,successCallback,errorCallback){if(this.errorCode=constants.f40,!file||!template)return void errorCallback((0,error.vz)(),this.errorCode);const{scope,templateKey}=template,{id,permissions}=file;if(id&&permissions)if(permissions.can_upload){this.successCallback=successCallback,this.errorCallback=errorCallback;try{if(await this.xhr.delete({url:this.getMetadataUrl(id,scope,templateKey),id:(0,utils_file.mc)(id)}),!this.isDestroyed()){const cache=this.getCache(),key=this.getMetadataCacheKey(id),metadata=cache.get(key);metadata.editors.splice(metadata.editors.findIndex((editor=>editor.template.scope===scope&&editor.template.templateKey===templateKey)),1),this.successHandler()}}catch(e){this.errorHandler(e)}}else errorCallback((0,error.pm)(),this.errorCode);else errorCallback((0,error.vz)(),this.errorCode)}}const api_Metadata=Metadata;function FileCollaborators_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function FileCollaborators_defineProperty(obj,key,value){return(key=function FileCollaborators_toPropertyKey(t){var i=function FileCollaborators_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const api_FileCollaborators=class FileCollaborators extends MarkerBasedAPI{constructor(){var _this;super(...arguments),_this=this,FileCollaborators_defineProperty(this,"successHandler",(data=>{if(this.isDestroyed()||"function"!=typeof this.successCallback)return;const collaboratorSelectorItems=data.entries.map((collab=>{let item;return"group"===collab.type?item=collab:(item=collab,item.email=item.login),{id:collab.id,name:collab.name,item}}));this.successCallback(function FileCollaborators_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?FileCollaborators_ownKeys(Object(t),!0).forEach((function(r){FileCollaborators_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):FileCollaborators_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({},data,{entries:collaboratorSelectorItems}))})),FileCollaborators_defineProperty(this,"getCollaboratorsWithQuery",(function(fileId,successCallback,errorCallback,searchStr){let{includeGroups=!1}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};searchStr&&""!==searchStr.trim()&&_this.getFileCollaborators(fileId,successCallback,errorCallback,{filter_term:searchStr,include_groups:includeGroups,include_uploader_collabs:!1})}))}getUrl(id){if(!id)throw new Error("Missing file id!");return"".concat(this.getBaseApiUrl(),"/files/").concat(id,"/collaborators")}getFileCollaborators(id,successCallback,errorCallback){let requestData=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},limit=arguments.length>4&&void 0!==arguments[4]?arguments[4]:constants.y8l;this.markerGet({id,limit,successCallback,errorCallback,requestData})}};function ItemCollaborations_defineProperty(obj,key,value){return(key=function ItemCollaborations_toPropertyKey(t){var i=function ItemCollaborations_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const api_ItemCollaborations=class ItemCollaborations extends MarkerBasedAPI{constructor(){var _this;super(...arguments),_this=this,ItemCollaborations_defineProperty(this,"getCollaborations",(function(id,successCallback,errorCallback){let requestData=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},limit=arguments.length>4&&void 0!==arguments[4]?arguments[4]:constants.y8l;_this.markerGet({id,limit,successCallback,errorCallback,requestData})})),ItemCollaborations_defineProperty(this,"successHandler",(data=>{this.isDestroyed()||"function"!=typeof this.successCallback||this.successCallback(data)}))}getUrl(id){return"getUrl(".concat(id,") should be overridden")}};const api_FileCollaborations=class FileCollaborations extends api_ItemCollaborations{getUrl(id){if(!id)throw new Error("Missing file ID!");return"".concat(this.getBaseApiUrl(),"/files/").concat(id,"/collaborations")}};const api_FolderCollaborations=class FolderCollaborations extends api_ItemCollaborations{getUrl(id){if(!id)throw new Error("Missing folder ID!");return"".concat(this.getBaseApiUrl(),"/folders/").concat(id,"/collaborations")}};function Collaborations_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function Collaborations_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Collaborations_ownKeys(Object(t),!0).forEach((function(r){Collaborations_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Collaborations_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function Collaborations_defineProperty(obj,key,value){return(key=function Collaborations_toPropertyKey(t){var i=function Collaborations_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class Collaborations extends Base.Z{constructor(){super(...arguments),Collaborations_defineProperty(this,"addCollaboration",((item,collaboration,successCallback,errorCallback)=>{const{id}=item;this.post({id,data:{data:Collaborations_objectSpread({item},collaboration)},errorCallback,successCallback,url:this.getUrl()})}))}getUrl(){return"".concat(this.getBaseApiUrl(),"/collaborations")}}const api_Collaborations=Collaborations;var messages=__webpack_require__("./src/elements/common/messages.js"),api_messages=__webpack_require__("./src/api/messages.js");var merge=__webpack_require__("./node_modules/lodash/merge.js"),merge_default=__webpack_require__.n(merge);function Annotations_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function Annotations_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Annotations_ownKeys(Object(t),!0).forEach((function(r){Annotations_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Annotations_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function Annotations_defineProperty(obj,key,value){return(key=function Annotations_toPropertyKey(t){var i=function Annotations_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class Annotations extends MarkerBasedAPI{constructor(){super(...arguments),Annotations_defineProperty(this,"successHandler",(data=>{if(this.isDestroyed()||"function"!=typeof this.successCallback)return;if(!data)return void this.successCallback();if(!data.entries)return data.type&&"comment"===data.type?void this.successCallback(formatComment(data)):void this.successCallback(this.formatReplies(data));if(data.entries.length&&"comment"===data.entries[0].type){const replies=data.entries.map(formatComment);return void this.successCallback(Annotations_objectSpread({},data,{entries:replies}))}const annotations=data.entries.map(this.formatReplies);this.successCallback(Annotations_objectSpread({},data,{entries:annotations}))}))}formatReplies(annotation){return annotation.replies&&annotation.replies.length?Annotations_objectSpread({},annotation,{replies:annotation.replies.map(formatComment)}):annotation}getUrl(){return"".concat(this.getBaseApiUrl(),"/undoc/annotations")}getUrlForId(annotationId){return"".concat(this.getUrl(),"/").concat(annotationId)}getUrlWithRepliesForId(annotationId){return"".concat(this.getUrlForId(annotationId),"/replies")}createAnnotation(fileId,fileVersionId,payload,permissions,successCallback,errorCallback){this.errorCode=constants.hXf;try{this.checkApiCallValidity(constants.pjV,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}const defaults={description:{type:"reply"},file_version:{id:fileVersionId,type:"file_version"}};this.post({id:fileId,data:{data:merge_default()(defaults,payload)},errorCallback,successCallback,url:this.getUrl()})}updateAnnotation(fileId,annotationId,permissions,payload,successCallback,errorCallback){this.errorCode=constants.OEn;const{message,status}=payload;if(message)try{this.checkApiCallValidity(constants.AAt,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}if(status)try{this.checkApiCallValidity(constants.qS2,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}this.put({id:fileId,data:{data:{description:message?{message}:void 0,status}},errorCallback,successCallback,url:this.getUrlForId(annotationId)})}deleteAnnotation(fileId,annotationId,permissions,successCallback,errorCallback){this.errorCode=constants.h_U;try{this.checkApiCallValidity(constants.p0b,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}this.delete({id:fileId,errorCallback,successCallback,url:this.getUrlForId(annotationId)})}getAnnotation(fileId,annotationId,permissions,successCallback,errorCallback,shouldFetchReplies){this.errorCode=constants.est;try{this.checkApiCallValidity(constants.V34,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}const requestData=shouldFetchReplies?{params:{fields:"replies"}}:void 0;this.get({id:fileId,errorCallback,successCallback,url:this.getUrlForId(annotationId),requestData})}getAnnotations(fileId,fileVersionId,permissions,successCallback,errorCallback,limit,shouldFetchAll,shouldFetchReplies){this.errorCode=constants.zE_;try{this.checkApiCallValidity(constants.V34,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}const requestData=Annotations_objectSpread({file_id:fileId,file_version_id:fileVersionId},shouldFetchReplies?{fields:"replies"}:null);this.markerGet({id:fileId,errorCallback,limit,requestData,shouldFetchAll,successCallback})}getAnnotationReplies(fileId,annotationId,permissions,successCallback,errorCallback){this.errorCode=constants.Cb_;try{this.checkApiCallValidity(constants.V34,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}this.get({id:fileId,errorCallback,successCallback,url:this.getUrlWithRepliesForId(annotationId)})}createAnnotationReply(fileId,annotationId,permissions,message,successCallback,errorCallback){this.errorCode=constants.S$h;try{this.checkApiCallValidity(constants.pjV,permissions,fileId)}catch(e){return void errorCallback(e,this.errorCode)}this.post({id:fileId,data:{data:{message}},errorCallback,successCallback,url:"".concat(this.getUrlWithRepliesForId(annotationId),"?file_id=").concat(fileId)})}}function AppActivity_defineProperty(obj,key,value){return(key=function AppActivity_toPropertyKey(t){var i=function AppActivity_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const api_AppActivity=class AppActivity extends MarkerBasedAPI{constructor(){super(...arguments),AppActivity_defineProperty(this,"permissions",{}),AppActivity_defineProperty(this,"mapAppActivityItem",(item=>{const{activity_template,app,created_by,id,occurred_at,rendered_text,type}=item,{can_delete}=this.permissions;return{activity_template,app,created_at:occurred_at,created_by,id,permissions:{can_delete},rendered_text,type}})),AppActivity_defineProperty(this,"successHandler",(_ref=>{let{entries=[]}=_ref;if(this.isDestroyed()||"function"!=typeof this.successCallback)return;const activityEntries=entries.map(this.mapAppActivityItem);this.successCallback({entries:activityEntries,total_count:activityEntries.length})})),AppActivity_defineProperty(this,"errorHandler",(error=>{if(this.isDestroyed()&&"function"!=typeof this.errorCallback)return;const{response}=error;response.status===constants.cEo?this.successHandler({entries:[],total_count:0}):this.errorCallback(error,response.status)}))}getUrl(){return"".concat(this.getBaseApiUrl(),"/app_activities")}getDeleteUrl(id){if(!id)throw new Error("Missing file id!");return"".concat(this.getUrl(),"/").concat(id)}getAppActivity(id,permissions,successCallback,errorCallback){const requestData={item_id:id,item_type:"file",fields:utils_fields.Q0.toString()};this.permissions=permissions,this.markerGet({id,successCallback,errorCallback,requestData})}deleteAppActivity(_ref2){let{id,appActivityId,successCallback,errorCallback}=_ref2;this.errorCode=constants.GsS,this.delete({id,url:this.getDeleteUrl(appActivityId),successCallback,errorCallback})}};function Feed_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function Feed_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Feed_ownKeys(Object(t),!0).forEach((function(r){Feed_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Feed_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function Feed_defineProperty(obj,key,value){return(key=function Feed_toPropertyKey(t){var i=function Feed_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function Feed_objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function Feed_objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}const TASK_NEW_INITIAL_STATUS=constants.HyO,getItemWithFilteredReplies=(item,replyId)=>{const{replies=[]}=item,rest=Feed_objectWithoutProperties(item,["replies"]);return Feed_objectSpread({replies:replies.filter((_ref=>{let{id}=_ref;return id!==replyId}))},rest)},getItemWithPendingReply=(item,reply)=>{const{replies=[]}=item;return Feed_objectSpread({replies:[...replies,reply]},Feed_objectWithoutProperties(item,["replies"]))},parseReplies=replies=>[...replies].map((reply=>Feed_objectSpread({},reply,{tagged_message:reply.tagged_message||reply.message||""})));class Feed extends Base.Z{constructor(options){var _this;super(options),_this=this,Feed_defineProperty(this,"updateAnnotation",((file,annotationId,text,status,permissions,successCallback,errorCallback)=>{if(!file.id)throw(0,error.vz)();if(!text&&!status)throw(0,error.hz)();this.annotationsAPI=new Annotations(this.options),this.file=file,this.errorCallback=errorCallback;const feedItemChanges={};text&&(feedItemChanges.message=text),status&&(feedItemChanges.status=status),this.updateFeedItem(Feed_objectSpread({},feedItemChanges,{isPending:!0}),annotationId),this.annotationsAPI.updateAnnotation(this.file.id,annotationId,permissions,feedItemChanges,(annotation=>{const{replies,total_reply_count}=annotation,annotationBase=Feed_objectWithoutProperties(annotation,["replies","total_reply_count"]);this.updateFeedItem(Feed_objectSpread({},annotationBase,{isPending:!1}),annotationId),this.isDestroyed()||successCallback(annotation)}),((e,code)=>{this.updateCommentErrorCallback(e,code,annotationId)}))})),Feed_defineProperty(this,"updateCommentErrorCallback",((e,code,id)=>{this.updateFeedItem(this.createFeedError(api_messages.Z.commentUpdateErrorMessage),id),this.feedErrorCallback(!0,e,code)})),Feed_defineProperty(this,"updateReplyErrorCallback",((error,code,id,parentId)=>{this.updateReplyItem(this.createFeedError(api_messages.Z.commentUpdateErrorMessage),parentId,id),this.feedErrorCallback(!0,error,code)})),Feed_defineProperty(this,"fetchRepliesErrorCallback",((error,code,id)=>{this.updateFeedItem(this.createFeedError(api_messages.Z.repliesFetchErrorMessage),id),this.feedErrorCallback(!0,error,code)})),Feed_defineProperty(this,"deleteAnnotation",((file,annotationId,permissions,successCallBack,errorCallback)=>{if(this.annotationsAPI=new Annotations(this.options),!file.id)throw(0,error.vz)();this.file=file,this.errorCallback=errorCallback,this.updateFeedItem({isPending:!0},annotationId),this.annotationsAPI.deleteAnnotation(this.file.id,annotationId,permissions,this.deleteFeedItem.bind(this,annotationId,successCallBack),((error,code)=>{this.deleteCommentErrorCallback(error,code,annotationId)}))})),Feed_defineProperty(this,"fetchThreadedCommentSuccessCallback",((resolve,successCallback,comment)=>{successCallback(comment),resolve()})),Feed_defineProperty(this,"updateTaskCollaborator",((file,taskId,taskCollaboratorId,taskCollaboratorStatus,_successCallback,errorCallback)=>{if(!file.id)throw(0,error.vz)();this.file=file,this.errorCallback=errorCallback,this.updateFeedItem({isPending:!0},taskId);const collaboratorsApi=new tasks_TaskCollaborators(this.options);this.taskCollaboratorsAPI.push(collaboratorsApi);const taskCollaboratorPayload={id:taskCollaboratorId,status:taskCollaboratorStatus},handleError=(e,code)=>{let errorMessage;switch(taskCollaboratorStatus){case constants.Hu4:errorMessage=api_messages.Z.taskApproveErrorMessage;break;case constants.CDt:errorMessage=api_messages.Z.taskCompleteErrorMessage;break;case constants.z6z:errorMessage=api_messages.Z.taskRejectErrorMessage;break;default:errorMessage=api_messages.Z.taskCompleteErrorMessage}this.updateFeedItem(this.createFeedError(errorMessage,api_messages.Z.taskActionErrorTitle),taskId),this.feedErrorCallback(!0,e,code)};collaboratorsApi.updateTaskCollaborator({file,taskCollaborator:taskCollaboratorPayload,successCallback:taskCollab=>{this.updateTaskCollaboratorSuccessCallback(taskId,file,taskCollab,_successCallback,handleError)},errorCallback:handleError})})),Feed_defineProperty(this,"updateTaskCollaboratorSuccessCallback",((taskId,file,updatedCollaborator,_successCallback2,errorCallback)=>{this.tasksNewAPI=new tasks_TasksNew(this.options),this.tasksNewAPI.getTask({id:taskId,file,successCallback:task=>{this.updateFeedItem(Feed_objectSpread({},task,{isPending:!1}),taskId),_successCallback2(updatedCollaborator)},errorCallback})})),Feed_defineProperty(this,"updateTaskNew",(async function(file,task){let successCallback=arguments.length>2&&void 0!==arguments[2]?arguments[2]:noop_default(),errorCallback=arguments.length>3&&void 0!==arguments[3]?arguments[3]:noop_default();if(!file.id)throw(0,error.vz)();_this.file=file,_this.errorCallback=errorCallback,_this.tasksNewAPI=new tasks_TasksNew(_this.options),_this.updateFeedItem({isPending:!0},task.id);try{const groupInfoPromises=task.addedAssignees.filter((assignee=>assignee.item&&"group"===assignee.item.type)).map((assignee=>assignee.id)).map((groupId=>new api_Groups(_this.options).getGroupCount({file,group:{id:groupId}}))),hasAnyGroupCountExceeded=(await Promise.all(groupInfoPromises)).some((groupInfo=>groupInfo.total_count>constants.uDT)),warning={code:constants.tyK,type:"warning"};if(hasAnyGroupCountExceeded)return void _this.feedErrorCallback(!1,warning,constants.tyK);await new Promise(((resolve,reject)=>{_this.tasksNewAPI.updateTaskWithDeps({file,task,successCallback:resolve,errorCallback:reject})})),await new Promise(((resolve,reject)=>{_this.tasksNewAPI.getTask({file,id:task.id,successCallback:taskData=>{_this.updateFeedItem(Feed_objectSpread({},taskData,{isPending:!1}),task.id),resolve()},errorCallback:e=>{_this.updateFeedItem({isPending:!1},task.id),_this.feedErrorCallback(!1,e,constants.PLP),reject()}})})),_this.isDestroyed()||successCallback()}catch(e){_this.updateFeedItem({isPending:!1},task.id),_this.feedErrorCallback(!1,e,constants.PLP)}})),Feed_defineProperty(this,"deleteComment",((file,commentId,permissions,successCallback,errorCallback)=>{if(this.commentsAPI=new api_Comments(this.options),!file.id)throw(0,error.vz)();this.file=file,this.errorCallback=errorCallback,this.updateFeedItem({isPending:!0},commentId),this.commentsAPI.deleteComment({file,commentId,permissions,successCallback:this.deleteFeedItem.bind(this,commentId,successCallback),errorCallback:(e,code)=>{this.deleteCommentErrorCallback(e,code,commentId)}})})),Feed_defineProperty(this,"deleteThreadedComment",((file,commentId,permissions,successCallback,errorCallback)=>{if(!file.id)throw(0,error.vz)();this.file=file,this.errorCallback=errorCallback,this.updateFeedItem({isPending:!0},commentId),this.threadedCommentsAPI=new api_ThreadedComments(this.options),this.threadedCommentsAPI.deleteComment({fileId:file.id,commentId,permissions,successCallback:this.deleteFeedItem.bind(this,commentId,successCallback),errorCallback:(e,code)=>{this.deleteCommentErrorCallback(e,code,commentId)}})})),Feed_defineProperty(this,"deleteReply",((file,id,parentId,permissions,successCallback,errorCallback)=>{if(!file.id)throw(0,error.vz)();this.file=file,this.errorCallback=errorCallback,this.updateReplyItem({isPending:!0},parentId,id),this.threadedCommentsAPI=new api_ThreadedComments(this.options),this.threadedCommentsAPI.deleteComment({fileId:file.id,commentId:id,permissions,successCallback:this.deleteReplySuccessCallback.bind(this,id,parentId,successCallback),errorCallback:(e,code)=>{this.deleteReplyErrorCallback(e,code,id,parentId)}})})),Feed_defineProperty(this,"deleteReplySuccessCallback",((id,parentId,successCallback)=>{this.modifyFeedItemRepliesCountBy(parentId,-1),this.deleteReplyItem(id,parentId,successCallback)})),Feed_defineProperty(this,"deleteCommentErrorCallback",((e,code,commentId)=>{this.updateFeedItem(this.createFeedError(api_messages.Z.commentDeleteErrorMessage),commentId),this.feedErrorCallback(!0,e,code)})),Feed_defineProperty(this,"deleteReplyErrorCallback",((error,code,id,parentId)=>{this.updateReplyItem(this.createFeedError(api_messages.Z.commentDeleteErrorMessage),parentId,id),this.feedErrorCallback(!0,error,code)})),Feed_defineProperty(this,"createTaskNew",((file,currentUser,message,assignees,taskType,dueAt,completionRule,_successCallback3,errorCallback)=>{if(!file.id)throw(0,error.vz)();this.file=file,this.errorCallback=errorCallback;const uuid=uniqueId_default()("task_");let dueAtString;if(dueAt){dueAtString=new Date(dueAt).toISOString()}const pendingTask={created_by:{type:"task_collaborator",target:currentUser,id:uniqueId_default()(),role:"CREATOR",status:TASK_NEW_INITIAL_STATUS},completion_rule:completionRule,created_at:(new Date).toISOString(),due_at:dueAtString,id:uuid,description:message,type:constants.PNZ,assigned_to:{entries:assignees.map((assignee=>({id:uniqueId_default()(),target:Feed_objectSpread({},assignee,{avatar_url:"",type:"user"}),status:TASK_NEW_INITIAL_STATUS,permissions:{can_delete:!1,can_update:!1},role:"ASSIGNEE",type:"task_collaborator"}))),limit:10,next_marker:null},permissions:{can_update:!1,can_delete:!1,can_create_task_collaborator:!1,can_create_task_link:!1},task_links:{entries:[{id:uniqueId_default()(),type:"task_link",target:Feed_objectSpread({type:"file"},file),permissions:{can_delete:!1,can_update:!1}}],limit:1,next_marker:null},task_type:taskType,status:constants.HyO},taskPayload={description:message,due_at:dueAtString,task_type:taskType,completion_rule:completionRule},groupInfoPromises=assignees.filter((assignee=>"group"===(assignee.item&&assignee.item.type))).map((assignee=>assignee.id)).map((groupId=>new api_Groups(this.options).getGroupCount({file,group:{id:groupId}})));Promise.all(groupInfoPromises).then((groupCounts=>{const hasAnyGroupCountExceeded=groupCounts.some((groupInfo=>groupInfo.total_count>constants.uDT)),warning={code:constants.tyK,type:"warning"};hasAnyGroupCountExceeded?this.feedErrorCallback(!1,warning,constants.tyK):(this.tasksNewAPI=new tasks_TasksNew(this.options),this.tasksNewAPI.createTaskWithDeps({file,task:taskPayload,assignees,successCallback:taskWithDepsData=>{this.addPendingItem(this.file.id,currentUser,pendingTask),this.updateFeedItem(Feed_objectSpread({},taskWithDepsData,{task_links:{entries:taskWithDepsData.task_links,next_marker:null,limit:1},assigned_to:{entries:taskWithDepsData.assigned_to,next_marker:null,limit:taskWithDepsData.assigned_to.length},isPending:!1}),uuid),_successCallback3(taskWithDepsData)},errorCallback:(e,code)=>{this.feedErrorCallback(!1,e,code)}}))})).catch((error=>{this.feedErrorCallback(!1,error,constants.bgA)}))})),Feed_defineProperty(this,"deleteTaskNew",(function(file,task){let successCallback=arguments.length>2&&void 0!==arguments[2]?arguments[2]:noop_default(),errorCallback=arguments.length>3&&void 0!==arguments[3]?arguments[3]:noop_default();if(!file.id)throw(0,error.vz)();_this.file=file,_this.errorCallback=errorCallback,_this.tasksNewAPI=new tasks_TasksNew(_this.options),_this.updateFeedItem({isPending:!0},task.id),_this.tasksNewAPI.deleteTask({file,task,successCallback:_this.deleteFeedItem.bind(_this,task.id,successCallback),errorCallback:(e,code)=>{_this.updateFeedItem(_this.createFeedError(api_messages.Z.taskDeleteErrorMessage),task.id),_this.feedErrorCallback(!0,e,code)}})})),Feed_defineProperty(this,"deleteFeedItem",(function(id){let successCallback=arguments.length>1&&void 0!==arguments[1]?arguments[1]:noop_default();const cachedItems=_this.getCachedItems(_this.file.id);if(cachedItems){const feedItems=cachedItems.items.filter((feedItem=>feedItem.id!==id));_this.setCachedItems(_this.file.id,feedItems),_this.isDestroyed()||successCallback(id)}})),Feed_defineProperty(this,"deleteReplyItem",(function(id,parentId){let successCallback=arguments.length>2&&void 0!==arguments[2]?arguments[2]:noop_default();const feedItems=(_this.getCachedItems(_this.file.id)||{items:[],errors:[]}).items.map((item=>item.id!==parentId?item:item.type===constants.Htd||item.type===constants.Pyv?getItemWithFilteredReplies(item,id):item));_this.setCachedItems(_this.file.id,feedItems),_this.isDestroyed()||successCallback(id,parentId)})),Feed_defineProperty(this,"feedErrorCallback",(function(){let hasError=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1?arguments[1]:void 0,code=arguments.length>2?arguments[2]:void 0;hasError&&_this.errors.push(Feed_objectSpread({},e,{code})),!_this.isDestroyed()&&_this.errorCallback&&_this.errorCallback(e,code,{error:e,[constants.dHW]:hasError}),console.error(e)})),Feed_defineProperty(this,"addPendingItem",((id,currentUser,itemBase)=>{if(!currentUser)throw(0,error.pG)();const date=(new Date).toISOString(),pendingFeedItem=Feed_objectSpread({created_at:date,created_by:currentUser,modified_at:date,isPending:!0},itemBase),cachedItems=this.getCachedItems(this.file.id),feedItemsWithPendingItem=[...cachedItems?cachedItems.items:[],pendingFeedItem];return this.setCachedItems(id,feedItemsWithPendingItem),pendingFeedItem})),Feed_defineProperty(this,"addPendingReply",((parentId,currentUser,commentBase)=>{if(!this.file.id)throw(0,error.vz)();if(!currentUser)throw(0,error.pG)();const date=(new Date).toISOString(),pendingReply=Feed_objectSpread({created_at:date,created_by:currentUser,modified_at:date,isPending:!0},commentBase),cachedItems=this.getCachedItems(this.file.id);if(cachedItems){const updatedFeedItems=cachedItems.items.map((item=>item.id===parentId&&item.type===constants.Pyv||item.id===parentId&&item.type===constants.Htd?getItemWithPendingReply(item,pendingReply):item));this.setCachedItems(this.file.id,updatedFeedItems)}return pendingReply})),Feed_defineProperty(this,"createCommentSuccessCallback",((commentData,id,successCallback)=>{const{message="",tagged_message=""}=commentData;commentData.tagged_message=tagged_message||message,this.updateFeedItem(Feed_objectSpread({},commentData,{isPending:!1}),id),this.isDestroyed()||successCallback(commentData)})),Feed_defineProperty(this,"createCommentErrorCallback",((e,code,id)=>{const errorMessage=e.status===constants.WRV?api_messages.Z.commentCreateConflictMessage:api_messages.Z.commentCreateErrorMessage;this.updateFeedItem(this.createFeedError(errorMessage),id),this.feedErrorCallback(!1,e,code)})),Feed_defineProperty(this,"createReplySuccessCallback",((commentData,parentId,id,successCallback)=>{this.updateReplyItem(Feed_objectSpread({},commentData,{isPending:!1}),parentId,id),this.isDestroyed()||successCallback(commentData)})),Feed_defineProperty(this,"createReplyErrorCallback",((error,code,parentId,id)=>{const errorMessage=error.status===constants.WRV?api_messages.Z.commentCreateConflictMessage:api_messages.Z.commentCreateErrorMessage;this.updateReplyItem(this.createFeedError(errorMessage),parentId,id),this.feedErrorCallback(!1,error,code)})),Feed_defineProperty(this,"updateFeedItem",((updates,id)=>{if(!this.file.id)throw(0,error.vz)();const cachedItems=this.getCachedItems(this.file.id);if(cachedItems){const updatedFeedItems=cachedItems.items.map((item=>item.id===id?Feed_objectSpread({},item,{},updates):item));return this.setCachedItems(this.file.id,updatedFeedItems),updatedFeedItems}return null})),Feed_defineProperty(this,"updateReplyItem",((replyUpdates,parentId,id)=>{if(!this.file.id)throw(0,error.vz)();const getItemWithUpdatedReply=(item,replyId,updates)=>{const updatedItem=Feed_objectSpread({},item);return updatedItem.replies&&(updatedItem.replies=updatedItem.replies.map((reply=>reply.id===replyId?Feed_objectSpread({},reply,{},updates):reply))),updatedItem},cachedItems=this.getCachedItems(this.file.id);if(cachedItems){const updatedFeedItems=cachedItems.items.map((item=>item.id===parentId&&item.type===constants.Pyv||item.id===parentId&&item.type===constants.Htd?getItemWithUpdatedReply(item,id,replyUpdates):item));this.setCachedItems(this.file.id,updatedFeedItems)}})),Feed_defineProperty(this,"createComment",((file,currentUser,text,hasMention,_successCallback4,errorCallback)=>{const uuid=uniqueId_default()("comment_"),commentData={id:uuid,tagged_message:text,type:constants.Pyv};if(!file.id)throw(0,error.vz)();this.file=file,this.errorCallback=errorCallback,this.addPendingItem(this.file.id,currentUser,commentData);const message={};hasMention?message.taggedMessage=text:message.message=text,this.commentsAPI=new api_Comments(this.options),this.commentsAPI.createComment(Feed_objectSpread({file},message,{successCallback:comment=>{this.createCommentSuccessCallback(comment,uuid,_successCallback4)},errorCallback:(e,code)=>{this.createCommentErrorCallback(e,code,uuid)}}))})),Feed_defineProperty(this,"createThreadedComment",((file,currentUser,text,_successCallback5,errorCallback)=>{if(!file.id)throw(0,error.vz)();const uuid=uniqueId_default()("comment_"),commentData={id:uuid,tagged_message:text,type:constants.Pyv};this.file=file,this.errorCallback=errorCallback,this.addPendingItem(this.file.id,currentUser,commentData),this.threadedCommentsAPI=new api_ThreadedComments(this.options),this.threadedCommentsAPI.createComment({file,message:text,successCallback:comment=>{this.createCommentSuccessCallback(comment,uuid,_successCallback5)},errorCallback:(e,code)=>{this.createCommentErrorCallback(e,code,uuid)}})})),Feed_defineProperty(this,"updateComment",((file,commentId,text,hasMention,permissions,_successCallback6,errorCallback)=>{const commentData={tagged_message:text};if(!file.id)throw(0,error.vz)();this.file=file,this.errorCallback=errorCallback,this.updateFeedItem(Feed_objectSpread({},commentData,{isPending:!0}),commentId);const message={};hasMention?message.tagged_message=text:message.message=text,this.commentsAPI=new api_Comments(this.options),this.commentsAPI.updateComment(Feed_objectSpread({file,commentId,permissions},message,{successCallback:comment=>{this.updateFeedItem(Feed_objectSpread({},message,{isPending:!1}),commentId),this.isDestroyed()||_successCallback6(comment)},errorCallback:(e,code)=>{this.updateCommentErrorCallback(e,code,commentId)}}))})),Feed_defineProperty(this,"updateThreadedComment",((file,commentId,text,status,permissions,_successCallback7,errorCallback)=>{if(!file.id)throw(0,error.vz)();if(!text&&!status)throw(0,error.hz)();const commentData={};text&&(commentData.tagged_message=text),status&&(commentData.status=status),this.file=file,this.errorCallback=errorCallback,this.updateFeedItem(Feed_objectSpread({},commentData,{isPending:!0}),commentId),this.threadedCommentsAPI=new api_ThreadedComments(this.options),this.threadedCommentsAPI.updateComment({fileId:file.id,commentId,permissions,message:text,status,successCallback:comment=>{const{replies,total_reply_count}=comment,commentBase=Feed_objectWithoutProperties(comment,["replies","total_reply_count"]);this.updateFeedItem(Feed_objectSpread({},commentBase,{isPending:!1}),commentId),this.isDestroyed()||_successCallback7(comment)},errorCallback:(e,code)=>{this.updateCommentErrorCallback(e,code,commentId)}})})),Feed_defineProperty(this,"updateReply",((file,id,parentId,text,permissions,_successCallback8,errorCallback)=>{if(!file.id)throw(0,error.vz)();this.file=file,this.errorCallback=errorCallback,this.updateReplyItem({tagged_message:text,isPending:!0},parentId,id),this.threadedCommentsAPI=new api_ThreadedComments(this.options),this.threadedCommentsAPI.updateComment({fileId:file.id,commentId:id,permissions,message:text,undefined:void 0,successCallback:comment=>{this.updateReplyItem(Feed_objectSpread({},comment,{isPending:!1}),parentId,id),this.isDestroyed()||_successCallback8(comment)},errorCallback:(error,code)=>{this.updateReplyErrorCallback(error,code,id,parentId)}})})),Feed_defineProperty(this,"modifyFeedItemRepliesCountBy",((id,n)=>{if(!this.file.id)throw(0,error.vz)();const{items:feedItems=[]}=this.getCachedItems(this.file.id)||{},feedItem=feedItems.find((_ref2=>{let{id:itemId}=_ref2;return itemId===id}));if(!feedItem||"annotation"!==feedItem.type&&"comment"!==feedItem.type)return;const newReplyCount=(feedItem.total_reply_count||0)+n;newReplyCount>=0&&this.updateFeedItem({total_reply_count:newReplyCount},id)})),Feed_defineProperty(this,"deleteAppActivity",((file,appActivityId,successCallback,errorCallback)=>{const{id}=file;if(!id)throw(0,error.vz)();this.appActivityAPI=new api_AppActivity(this.options),this.file=file,this.errorCallback=errorCallback,this.updateFeedItem({isPending:!0},appActivityId),this.appActivityAPI.deleteAppActivity({id,appActivityId,successCallback:this.deleteFeedItem.bind(this,appActivityId,successCallback),errorCallback:(e,code)=>{this.deleteAppActivityErrorCallback(e,code,appActivityId)}})})),Feed_defineProperty(this,"deleteAppActivityErrorCallback",((e,code,id)=>{this.updateFeedItem(this.createFeedError(api_messages.Z.appActivityDeleteErrorMessage),id),this.feedErrorCallback(!0,e,code)})),this.taskCollaboratorsAPI=[],this.taskLinksAPI=[],this.errors=[]}addAnnotation(file,currentUser,annotation,id,isPending){if(!file.id)throw(0,error.vz)();if(this.file=file,isPending){const newAnnotation=Feed_objectSpread({},annotation,{created_by:currentUser,id,type:constants.Htd});this.addPendingItem(this.file.id,currentUser,newAnnotation)}else this.updateFeedItem(Feed_objectSpread({},annotation,{isPending:!1}),id)}getCacheKey(id){return"".concat(constants.Im9).concat(id)}getCachedItems(id){const cache=this.getCache(),cacheKey=this.getCacheKey(id);return cache.get(cacheKey)}setCachedItems(id,items){const cache=this.getCache(),cacheKey=this.getCacheKey(id);cache.set(cacheKey,{errors:this.errors,items})}feedItems(file,shouldRefreshCache,successCallback,errorCallback,onError){let{shouldShowAnnotations=!1,shouldShowAppActivity=!1,shouldShowReplies=!1,shouldShowTasks=!0,shouldShowVersions=!0,shouldUseUAA=!1}=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const{id,permissions={}}=file,cachedItems=this.getCachedItems(id);if(cachedItems){const{errors,items}=cachedItems;if(errors.length?errorCallback(items,errors):successCallback(items),!shouldRefreshCache)return}this.file=file,this.errors=[],this.errorCallback=onError;const annotationsPromise=!shouldUseUAA&&shouldShowAnnotations?this.fetchAnnotations(permissions,shouldShowReplies):Promise.resolve(),commentsPromise=()=>shouldUseUAA?Promise.resolve():shouldShowReplies?this.fetchThreadedComments(permissions):this.fetchComments(permissions),tasksPromise=!shouldUseUAA&&shouldShowTasks?this.fetchTasksNew():Promise.resolve(),appActivityPromise=!shouldUseUAA&&shouldShowAppActivity?this.fetchAppActivity(permissions):Promise.resolve(),versionsPromise=!shouldUseUAA&&shouldShowVersions?this.fetchVersions():Promise.resolve(),currentVersionPromise=!shouldUseUAA&&shouldShowVersions?this.fetchCurrentVersion():Promise.resolve(),annotationActivityType=shouldShowAnnotations&&permissions[constants.V34]?[constants.KLQ]:[],appActivityActivityType=shouldShowAppActivity?[constants.xOh]:[],taskActivityType=shouldShowTasks?[constants.d5f]:[],versionsActivityType=shouldShowVersions?[constants.HBG]:[],filteredActivityTypes=[...annotationActivityType,...appActivityActivityType,...permissions[constants.C69]?[constants.aoc]:[],...taskActivityType,...versionsActivityType],fileActivitiesPromise=shouldUseUAA&&filteredActivityTypes.length?this.fetchFileActivities(permissions,filteredActivityTypes,shouldShowReplies):Promise.resolve(),handleFeedItems=feedItems=>{this.isDestroyed()||(this.setCachedItems(id,feedItems),this.errors.length?errorCallback(feedItems,this.errors):successCallback(feedItems))};shouldUseUAA?fileActivitiesPromise.then((response=>{if(!response)return;const parsedFeedItems=(response=>response&&response.entries&&response.entries.length?response.entries.map((item=>{if(!item.source)return null;const source=Feed_objectSpread({},item.source);switch(item.activity_type){case constants.d5f:{var _taskItem$assigned_to;const taskItem=Feed_objectSpread({},source[constants.d5f]);if(null===(_taskItem$assigned_to=taskItem.assigned_to)||void 0===_taskItem$assigned_to?void 0:_taskItem$assigned_to.entries){const assignedToEntries=taskItem.assigned_to.entries.map((entry=>{const assignedToEntry=Feed_objectSpread({},entry);return assignedToEntry.role=entry.role.toUpperCase(),assignedToEntry.status=entry.status.toUpperCase(),assignedToEntry}));taskItem.assigned_to.entries=assignedToEntries}return taskItem.completion_rule&&(taskItem.completion_rule=taskItem.completion_rule.toUpperCase()),taskItem.status&&(taskItem.status=taskItem.status.toUpperCase()),taskItem.task_type&&(taskItem.task_type=taskItem.task_type.toUpperCase()),taskItem.created_by={target:taskItem.created_by},taskItem}case constants.aoc:{const commentItem=Feed_objectSpread({},source[constants.aoc]);if(commentItem.replies&&commentItem.replies.length){const replies=parseReplies(commentItem.replies);commentItem.replies=replies}return commentItem.tagged_message=commentItem.tagged_message||commentItem.message||"",commentItem}case constants.KLQ:{const annotationItem=Feed_objectSpread({},source[constants.KLQ]);if(annotationItem.replies&&annotationItem.replies.length){const replies=parseReplies(annotationItem.replies);annotationItem.replies=replies}return annotationItem}case constants.xOh:{const appActivityItem=Feed_objectSpread({},source[constants.xOh]);return appActivityItem.created_at=appActivityItem.occurred_at,appActivityItem}case constants.HBG:{var _versionsItem$end,_versionsItem$start;const versionsItem=Feed_objectSpread({},source[constants.HBG]);if(versionsItem.type=constants.Vek,versionsItem.action_by){const collaborators={};1===versionsItem.action_by.length&&(versionsItem.uploader_display_name=versionsItem.action_by[0].name),versionsItem.action_by.map((collaborator=>(collaborators[collaborator.id]=Feed_objectSpread({},collaborator),collaborator))),versionsItem.collaborators=collaborators}var _versionsItem$start2,_versionsItem$start3,_versionsItem$start4,_versionsItem$start5,_versionsItem$start6,_versionsItem$start7;return(null===(_versionsItem$end=versionsItem.end)||void 0===_versionsItem$end?void 0:_versionsItem$end.number)&&(versionsItem.version_end=versionsItem.end.number,versionsItem.id=versionsItem.end.id),(null===(_versionsItem$start=versionsItem.start)||void 0===_versionsItem$start?void 0:_versionsItem$start.number)&&(versionsItem.version_start=versionsItem.start.number),versionsItem.version_start===versionsItem.version_end&&(versionsItem.version_number=versionsItem.version_start,versionsItem.action_type===constants.jLw&&(null===(_versionsItem$start2=versionsItem.start)||void 0===_versionsItem$start2?void 0:_versionsItem$start2.created_at)&&(null===(_versionsItem$start3=versionsItem.start)||void 0===_versionsItem$start3?void 0:_versionsItem$start3.created_by)&&(versionsItem.modified_at=versionsItem.start.created_at,versionsItem.modified_by=Feed_objectSpread({},versionsItem.start.created_by)),versionsItem.action_type===constants._CQ&&(null===(_versionsItem$start4=versionsItem.start)||void 0===_versionsItem$start4?void 0:_versionsItem$start4.trashed_at)&&(null===(_versionsItem$start5=versionsItem.start)||void 0===_versionsItem$start5?void 0:_versionsItem$start5.trashed_by)&&(versionsItem.trashed_at=versionsItem.start.trashed_at,versionsItem.trashed_by=Feed_objectSpread({},versionsItem.start.trashed_by)),versionsItem.action_type===constants.nw1&&(null===(_versionsItem$start6=versionsItem.start)||void 0===_versionsItem$start6?void 0:_versionsItem$start6.restored_at)&&(null===(_versionsItem$start7=versionsItem.start)||void 0===_versionsItem$start7?void 0:_versionsItem$start7.restored_by)&&(versionsItem.restored_at=versionsItem.start.restored_at,versionsItem.restored_by=Feed_objectSpread({},versionsItem.start.restored_by))),versionsItem}default:return null}})).filter((item=>!!item)).reverse():[])(response);handleFeedItems(parsedFeedItems)})):Promise.all([versionsPromise,currentVersionPromise,commentsPromise(),tasksPromise,appActivityPromise,annotationsPromise]).then((_ref3=>{let[versions,currentVersion,...feedItems]=_ref3;const sortedFeedItems=function sortFeedItems(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return args.reduce(((items,itemContainer)=>itemContainer?items.concat(itemContainer.entries):items),[]).sort(((a,b)=>Date.parse(a.created_at)-Date.parse(b.created_at)))}(currentVersion?this.versionsAPI.addCurrentVersion(currentVersion,versions,this.file):void 0,...feedItems);handleFeedItems(sortedFeedItems)}))}fetchAnnotations(permissions,shouldFetchReplies){return this.annotationsAPI=new Annotations(this.options),new Promise((resolve=>{this.annotationsAPI.getAnnotations(this.file.id,void 0,permissions,resolve,this.fetchFeedItemErrorCallback.bind(this,resolve),void 0,void 0,shouldFetchReplies)}))}fetchComments(permissions){return this.commentsAPI=new api_Comments(this.options),new Promise((resolve=>{this.commentsAPI.getComments(this.file.id,permissions,resolve,this.fetchFeedItemErrorCallback.bind(this,resolve))}))}fetchThreadedComment(file,commentId,successCallback,errorCallback){const{id,permissions}=file;if(!id||!permissions)throw(0,error.vz)();return this.threadedCommentsAPI=new api_ThreadedComments(this.options),new Promise((resolve=>{this.threadedCommentsAPI.getComment({commentId,errorCallback,fileId:id,permissions,successCallback:this.fetchThreadedCommentSuccessCallback.bind(this,resolve,successCallback)})}))}fetchThreadedComments(permissions){return this.threadedCommentsAPI=new api_ThreadedComments(this.options),new Promise((resolve=>{this.threadedCommentsAPI.getComments({errorCallback:this.fetchFeedItemErrorCallback.bind(this,resolve),fileId:this.file.id,permissions,successCallback:resolve})}))}fetchFileActivities(permissions,activityTypes){let shouldShowReplies=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.fileActivitiesAPI=new api_FileActivities(this.options),new Promise((resolve=>{this.fileActivitiesAPI.getActivities({errorCallback:this.fetchFeedItemErrorCallback.bind(this,resolve),fileID:this.file.id,permissions,successCallback:resolve,activityTypes,shouldShowReplies})}))}fetchReplies(file,commentFeedItemId,commentFeedItemType,successCallback,errorCallback){const{id,permissions}=file;if(!id||!permissions)throw(0,error.vz)();this.file=file,this.errorCallback=errorCallback,this.updateFeedItem({isRepliesLoading:!0},commentFeedItemId);const successCallbackFn=_ref4=>{let{entries}=_ref4;this.updateFeedItem({isRepliesLoading:!1,replies:entries,total_reply_count:entries.length},commentFeedItemId),successCallback(entries)},errorCallbackFn=(error,code)=>{this.fetchRepliesErrorCallback(error,code,commentFeedItemId)};commentFeedItemType===constants.Htd?(this.annotationsAPI=new Annotations(this.options),this.annotationsAPI.getAnnotationReplies(file.id,commentFeedItemId,permissions,successCallbackFn,errorCallbackFn)):commentFeedItemType===constants.Pyv&&(this.threadedCommentsAPI=new api_ThreadedComments(this.options),this.threadedCommentsAPI.getCommentReplies({fileId:file.id,commentId:commentFeedItemId,permissions,successCallback:successCallbackFn,errorCallback:errorCallbackFn}))}fetchVersions(){return this.versionsAPI=new api_Versions(this.options),new Promise((resolve=>{this.versionsAPI.getVersions(this.file.id,resolve,this.fetchFeedItemErrorCallback.bind(this,resolve),void 0,void 0,utils_fields.xs)}))}fetchCurrentVersion(){return this.versionsAPI=new api_Versions(this.options),new Promise((resolve=>{const{file_version={}}=this.file;this.versionsAPI.getVersion(this.file.id,file_version.id,resolve,this.fetchFeedItemErrorCallback.bind(this,resolve))}))}fetchTasksNew(){return this.tasksNewAPI=new tasks_TasksNew(this.options),new Promise((resolve=>{this.tasksNewAPI.getTasksForFile({file:{id:this.file.id},successCallback:resolve,errorCallback:(err,code)=>this.fetchFeedItemErrorCallback(resolve,err,code)})}))}fetchFeedItemErrorCallback(resolve,e,code){const{status}=e,shouldDisplayError=(0,error.zg)(status);this.feedErrorCallback(shouldDisplayError,e,code),resolve()}createTaskCollaboratorsforGroup(file,task,assignee){if(!file.id)throw(0,error.vz)();return this.file=file,new Promise(((resolve,reject)=>{const taskCollaboratorsAPI=new tasks_TaskCollaborators(this.options);this.taskCollaboratorsAPI.push(taskCollaboratorsAPI),taskCollaboratorsAPI.createTaskCollaboratorsforGroup({file,task,group:assignee,successCallback:resolve,errorCallback:e=>{reject(e)}})}))}createTaskCollaborator(file,task,assignee){if(!file.id)throw(0,error.vz)();return this.file=file,new Promise(((resolve,reject)=>{const taskCollaboratorsAPI=new tasks_TaskCollaborators(this.options);this.taskCollaboratorsAPI.push(taskCollaboratorsAPI),taskCollaboratorsAPI.createTaskCollaborator({file,task,user:assignee,successCallback:resolve,errorCallback:e=>{reject(e)}})}))}deleteTaskCollaborator(file,task,assignee){if(!file.id)throw(0,error.vz)();return this.file.id=file.id,new Promise(((resolve,reject)=>{const taskCollaboratorsAPI=new tasks_TaskCollaborators(this.options);this.taskCollaboratorsAPI.push(taskCollaboratorsAPI),taskCollaboratorsAPI.deleteTaskCollaborator({file,task,taskCollaborator:{id:assignee.id},successCallback:resolve,errorCallback:e=>{reject(e)}})}))}createTaskLink(file,task){if(!file.id)throw(0,error.vz)();return this.file=file,new Promise(((resolve,reject)=>{const taskLinksAPI=new tasks_TaskLinks(this.options);this.taskLinksAPI.push(taskLinksAPI),taskLinksAPI.createTaskLink({file,task,successCallback:resolve,errorCallback:reject})}))}createFeedError(message){return{error:{message,title:arguments.length>1&&void 0!==arguments[1]?arguments[1]:messages.default.errorOccured}}}createReply(file,currentUser,parentId,parentType,text,successCallback,errorCallback){const{id,permissions}=file;if(!id||!permissions)throw(0,error.vz)();const uuid=uniqueId_default()("comment_"),commentData={id:uuid,tagged_message:text,type:constants.Pyv};this.file=file,this.errorCallback=errorCallback,this.addPendingReply(parentId,currentUser,commentData),this.modifyFeedItemRepliesCountBy(parentId,1);const successCallbackFn=comment=>{this.createReplySuccessCallback(comment,parentId,uuid,successCallback)},errorCallbackFn=(error,code)=>{this.createReplyErrorCallback(error,code,parentId,uuid)};parentType===constants.Htd?(this.annotationsAPI=new Annotations(this.options),this.annotationsAPI.createAnnotationReply(file.id,parentId,permissions,text,successCallbackFn,errorCallbackFn)):parentType===constants.Pyv&&(this.threadedCommentsAPI=new api_ThreadedComments(this.options),this.threadedCommentsAPI.createCommentReply({fileId:file.id,commentId:parentId,permissions,message:text,successCallback:successCallbackFn,errorCallback:errorCallbackFn}))}destroyTaskCollaborators(){Array.isArray(this.taskCollaboratorsAPI)&&(this.taskCollaboratorsAPI.forEach((api=>api.destroy())),this.taskCollaboratorsAPI=[])}destroyTaskLinks(){Array.isArray(this.taskLinksAPI)&&(this.taskLinksAPI.forEach((api=>api.destroy())),this.taskLinksAPI=[])}fetchAppActivity(permissions){return this.appActivityAPI=new api_AppActivity(this.options),new Promise((resolve=>{this.appActivityAPI.getAppActivity(this.file.id,permissions,resolve,this.fetchFeedItemErrorCallback.bind(this,resolve))}))}destroy(){super.destroy(),this.annotationsAPI&&(this.annotationsAPI.destroy(),delete this.annotationsAPI),this.commentsAPI&&(this.commentsAPI.destroy(),delete this.commentsAPI),this.threadedCommentsAPI&&(this.threadedCommentsAPI.destroy(),delete this.threadedCommentsAPI),this.versionsAPI&&(this.versionsAPI.destroy(),delete this.versionsAPI),this.appActivityAPI&&(this.appActivityAPI.destroy(),delete this.appActivityAPI),this.tasksNewAPI&&(this.tasksNewAPI.destroy(),delete this.tasksNewAPI),this.destroyTaskCollaborators(),this.destroyTaskLinks()}}const api_Feed=Feed;class AppIntegrations extends Base.Z{getUrl(integrationId){if(!integrationId)throw new Error("Missing app integration id!");return"".concat(this.getBaseApiUrl(),"/app_integrations/").concat(integrationId)}execute(integrationId,fileId,successCallback,errorCallback){if(!integrationId)throw new Error("Missing integration id!");if(!fileId)throw new Error("Missing file id!");this.errorCode=constants._K8;const executeURL="".concat(this.getUrl(integrationId),"/execute"),body={data:{item:{id:fileId,type:constants.nqi}}};this.post({id:fileId,url:executeURL,data:body,successCallback,errorCallback})}}const api_AppIntegrations=AppIntegrations;class OpenWith extends Base.Z{getUrl(id){if(!id)throw new Error("Missing file id!");return"".concat(this.getBaseApiUrl(),"/files/").concat(id,"/open_with_integrations")}getOpenWithIntegrations(fileId,_successCallback,errorCallback){this.errorCode=constants.YLT,this.get({id:fileId,successCallback:openWithIntegrations=>{const formattedOpenWithData=this.formatOpenWithData(openWithIntegrations),consolidatedOpenWithIntegrations=this.consolidateBoxEditIntegrations(formattedOpenWithData);_successCallback(consolidatedOpenWithIntegrations)},errorCallback})}consolidateBoxEditIntegrations(integrations){let consolidatedIntegrations=[...integrations];return integrations.some((item=>item.appIntegrationId===constants.FBC))&&(consolidatedIntegrations=integrations.filter((item=>item.appIntegrationId!==constants.zpn))),consolidatedIntegrations}formatOpenWithData(openWithIntegrations){const{items,default_app_integration:defaultIntegration}=openWithIntegrations;return items.map((_ref=>{let{app_integration,disabled_reasons,display_name,display_description,display_order,is_disabled,should_show_consent_popup}=_ref;const{id,type}=app_integration;return{appIntegrationId:id,displayDescription:display_description,disabledReasons:disabled_reasons||[],displayOrder:display_order,isDefault:!!defaultIntegration&&id===defaultIntegration.id,isDisabled:is_disabled,displayName:display_name,requiresConsent:should_show_consent_popup,type}})).sort(((integrationA,integrationB)=>integrationA.displayOrder-integrationB.displayOrder))}}const api_OpenWith=OpenWith;function MetadataQuery_defineProperty(obj,key,value){return(key=function MetadataQuery_toPropertyKey(t){var i=function MetadataQuery_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class MetadataQuery extends Base.Z{constructor(){super(...arguments),MetadataQuery_defineProperty(this,"queryMetadataSuccessHandler",(_ref=>{let{data}=_ref;this.getCache().set(this.key,data),this.finish()}))}getCacheKey(id){return"".concat(constants.oYB).concat(id)}getUrl(){return"".concat(this.getBaseApiUrl(),"/metadata_queries/execute_read")}isLoaded(){return this.getCache().has(this.key)}finish(){if(this.isDestroyed())return;const metadataQueryData=this.getCache().get(this.key);this.successCallback(metadataQueryData)}queryMetadataRequest(query){this.isDestroyed()||(this.errorCode=constants.kKO,this.xhr.post({url:this.getUrl(),data:query}).then(this.queryMetadataSuccessHandler).catch(this.errorHandler))}queryMetadata(query,successCallback,errorCallback){let options=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(this.isDestroyed())return;const{context={}}=options;this.key=this.getCacheKey(context.id),this.successCallback=successCallback,this.errorCallback=errorCallback,options.forceFetch&&this.getCache().unset(this.key),this.isLoaded()?this.finish():this.queryMetadataRequest(query)}}const api_MetadataQuery=MetadataQuery,BROWSER_CONSTANTS={CHROME:"Chrome",EDGE:"Edge",FIREFOX:"Firefox",MAC:"Mac",SAFARI:"Safari",IE:"Explorer"},BROWSER_DATA=[{key:"userAgent",subString:BROWSER_CONSTANTS.EDGE,identity:BROWSER_CONSTANTS.EDGE},{key:"userAgent",subString:BROWSER_CONSTANTS.CHROME,identity:BROWSER_CONSTANTS.CHROME},{key:"userAgent",subString:"criOS",identity:BROWSER_CONSTANTS.CHROME,versionSearch:"criOS"},{key:"vendor",subString:"Apple",identity:BROWSER_CONSTANTS.SAFARI,versionSearch:"Version"},{key:"userAgent",subString:BROWSER_CONSTANTS.FIREFOX,identity:BROWSER_CONSTANTS.FIREFOX},{key:"userAgent",subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{key:"userAgent",subString:"Trident",identity:"Explorer",versionSearch:"rv"},{key:"userAgent",subString:"Gecko",identity:"Mozilla",versionSearch:"rv"}],OS_DATA=[{key:"platform",subString:"Win",identity:"Windows"},{key:"userAgent",subString:"iPod",identity:"iOS",device:"iPod"},{key:"userAgent",subString:"iPhone",identity:"iOS",device:"iPhone"},{key:"userAgent",subString:"iPad",identity:"iOS",device:"iPad"},{key:"platform",subString:BROWSER_CONSTANTS.MAC,identity:BROWSER_CONSTANTS.MAC},{key:"userAgent",subString:"Android",identity:"Android"},{key:"platform",subString:"Linux",identity:"Linux"}];function getBrowserData(navigator,data){let dataString,identity=null,device=null,versionSearchString="";for(let i=0,len=data.length;i<len;i+=1)if(dataString=navigator[data[i].key],versionSearchString=data[i].versionSearch||data[i].identity,dataString&&-1!==dataString.indexOf(data[i].subString)){identity=data[i].identity,device=data[i].device;break}return{identity,device,versionSearchString}}function getBrowserVersion(dataString,versionSearchString){const index=dataString.indexOf(versionSearchString);if(-1===index)return"";const versionArr=dataString.substring(index+versionSearchString.length+1).match(/[0-9]+(?:\.[0-9]*)?/);return versionArr&&versionArr.length?versionArr[0]:""}const box_edit_BrowserUtils=new class BrowserUtils{constructor(){const{navigator}=window,browserData=getBrowserData(navigator,BROWSER_DATA),osInfo=getBrowserData(navigator,OS_DATA);this.browser=browserData.identity||"unknown",this.version=getBrowserVersion(navigator.userAgent,browserData.versionSearchString)||getBrowserVersion(navigator.appVersion,browserData.versionSearchString)||"unknown",this.OS=osInfo.identity||"unknown",this.device=osInfo.device||"unknown"}getName(){return this.browser}getVersion(){return this.version}isMinBrowser(name,minVersion){return this.browser.toLowerCase()===name.toLowerCase()&&parseFloat(this.version)>=parseFloat(minVersion)}isSafari(){return this.browser===BROWSER_CONSTANTS.SAFARI}isFirefox(){return this.browser===BROWSER_CONSTANTS.FIREFOX}isChrome(){return this.browser===BROWSER_CONSTANTS.CHROME}isIE(){return this.browser===BROWSER_CONSTANTS.IE}isEdge(){return this.browser===BROWSER_CONSTANTS.EDGE}isIEAndSpecificBrowserPluginSupported(pluginID){return this.isIE()&&function isActiveXObjectEnabledForIE(objectID){const objectIdentifier=objectID||"htmlfile";let enabled=!1;try{if("ActiveXObject"in window){const{ActiveXObject}=window;enabled=!!new ActiveXObject(objectIdentifier)}}catch(exception){enabled=!1}return enabled}(pluginID)}};const promise=function promiseOne(promises){const errors=[];let error,errorCount=0;return new Promise(((resolve,reject)=>{promises.forEach(((promise,idx)=>{promise.then(resolve).catch((idx=>err=>{errors[idx]=err,errorCount+=1,errorCount===promises.length&&(error=new Error("no promises resolved"),reject(error))})(idx))}))}))},box_edit_constants={SAFARI_CHANNEL_NAME:"safari_channel",SECRET_STORE_COOKIE_NAME:"box-edit-secret-cookie-name",BOX_EDIT_APP_NAME:"BoxEdit",BOX_EDIT_NOT_SUPPORTED_ERROR:"box_edit_not_supported_error",BOX_EDIT_UNINSTALLED_ERROR:"box_edit_uninstalled_error",BOX_EDIT_UPGRADE_BROWSER_ERROR:"box_edit_upgrade_browser_error",BOX_EDIT_SAFARI_ERROR:"box_edit_safari_error",BOX_EDIT_INSECURE_REQUESTS_UPGRADED_ERROR:"box_edit_insecure_requests_upgraded_error",BOX_TOOLS_PLUGIN_NAME:"Box.BoxTools",BOX_SECURE_LOCAL_BASE_URL:"https://edit.boxlocalhost.com:",BOX_UNSECURE_LOCAL_BASE_URL:"http://127.0.0.1:",ACTIVEX_CHANNEL_NAME:"activex_channel",HTTP_CHANNEL_NAME:"http_channel",HTTPS_CHANNEL_NAME:"https_channel",OPERATION_STATUS:"status",OPERATION_REQUEST:"application_request",OPERATION_COMMAND:"application_command",UNCREATED_STATUS:"uncreated",CREATED_STATUS:"created",ACTIVE_STATUS:"active",HIVE_TABLE_WEBAPP_BOXTOOLS_ANALYTICS:"webapp_boxtools_analytics",KEY_LENGTH:16,KEY_ID_LENGTH:8,IV:"75392C57F66CE7E7EF47110410280DD7",OUTPUT_EVENT:"box_extension_output",REQUEST_ID_PRE:"BOX-EXT-REQ-ID-",REQUEST_TIMEOUT_RESPONSE_CODE:408,EXTENSION_BLACKLIST:{A6P:1,AC:1,AS:1,ACR:1,ACTION:1,AIR:1,APP:1,AWK:1,BAT:1,BOXNOTE:1,CGI:1,CHM:1,CMD:1,COM:1,CSH:1,DEK:1,DLD:1,DS:1,EBM:1,ESH:1,EXE:1,EZS:1,FKY:1,FRS:1,FXP:1,GADGET:1,HMS:1,HTA:1,ICD:1,INX:1,IPF:1,ISU:1,JAR:1,JS:1,JSE:1,JSX:1,KIX:1,LNK:1,LUA:1,MCR:1,MEM:1,MPX:1,MS:1,MSI:1,MST:1,OBS:1,PAF:1,PEX:1,PIF:1,PL:1,PRC:1,PRG:1,PVD:1,PWC:1,PY:1,PYC:1,PYO:1,QPX:1,RBX:1,REG:1,RGS:1,ROX:1,RPJ:1,SCAR:1,SCR:1,SCRIPT:1,SCPT:1,SCT:1,SH:1,SHB:1,SHS:1,SPR:1,TLB:1,TMS:1,U3P:1,UDF:1,URL:1,VB:1,VBE:1,VBS:1,VBSCRIPT:1,WCM:1,WPK:1,WS:1,WSF:1,XQT:1}};function Channel_defineProperty(obj,key,value){return(key=function Channel_toPropertyKey(t){var i=function Channel_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const box_edit_Channel=class Channel{constructor(appName){Channel_defineProperty(this,"buildNextRequestID",(()=>"".concat(box_edit_constants.REQUEST_ID_PRE).concat(this.window.performance.now()))),Channel_defineProperty(this,"buildDetailsObj",((operationType,data,comServerToApplicationTimeoutSec)=>{const timeoutSecString=comServerToApplicationTimeoutSec.toString(),details={data:void 0,operation:operationType,properties:{application:this.appName,timeout:timeoutSecString},req_id:this.buildNextRequestID()};if(operationType!==box_edit_constants.OPERATION_STATUS){if(!data)throw new TypeError("Data cannot be undefined for ".concat(operationType));details.data=data}return details})),this.appName=appName,this.window=window}sendCommand(requestData,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec){return Promise.resolve("TODO")}sendRequest(requestData,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec){return Promise.resolve("TODO")}getComServerStatus(browserToComServerTimeoutMS,comServerToApplicationTimeoutSec){return Promise.resolve("TODO")}destroy(){}};function ActiveXChannel_defineProperty(obj,key,value){return(key=function ActiveXChannel_toPropertyKey(t){var i=function ActiveXChannel_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const box_edit_ActiveXChannel=class ActiveXChannel extends box_edit_Channel{constructor(appName,isSynchronous){var _this;super(appName),_this=this,ActiveXChannel_defineProperty(this,"executeOperation",(function(){let operationType=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},browserToComServerTimeoutMS=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,comServerToApplicationTimeoutSec=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new Promise(((resolve,reject)=>{const details=_this.buildDetailsObj(operationType,data,comServerToApplicationTimeoutSec),timeoutId=setTimeout((()=>{reject(new Error({status_code:box_edit_constants.REQUEST_TIMEOUT_RESPONSE_CODE}))}),browserToComServerTimeoutMS);_this.reqIdToPromiseMap.set(details.req_id,{resolve,rejectTimeout:timeoutId}),_this.executeActiveXEvent({detail:details})}))})),ActiveXChannel_defineProperty(this,"repairActiveXConnection",(payload=>{box_edit_BrowserUtils.isIEAndSpecificBrowserPluginSupported(box_edit_constants.BOX_TOOLS_PLUGIN_NAME)&&(this.retryAttempt>=2||(this.retryAttempt+=1,setTimeout((()=>{this.executeActiveXEvent(payload)}),100)))})),ActiveXChannel_defineProperty(this,"executeActiveXEvent",(payload=>{const activeX=this.createActiveXObjectJSRef(),hasExecuteSyncAPI="ExecuteSync"in activeX;try{this.isSynchronous&&hasExecuteSyncAPI?activeX.ExecuteSync(JSON.stringify(payload)):activeX.Execute(JSON.stringify(payload))}catch(ex){this.repairActiveXConnection(payload)}})),ActiveXChannel_defineProperty(this,"createActiveXObjectJSRef",(()=>{const{ActiveXObject}=this.window;return new ActiveXObject(box_edit_constants.BOX_TOOLS_PLUGIN_NAME)})),ActiveXChannel_defineProperty(this,"setupActiveXCommunication",(()=>{this.isActiveXExtensionListenerAttached||(this.document.addEventListener(box_edit_constants.OUTPUT_EVENT,this.appExtensionEventResponseHandler),this.isActiveXExtensionListenerAttached=!0)})),ActiveXChannel_defineProperty(this,"tearDownActiveXCommunication",(()=>{this.isActiveXExtensionListenerAttached&&(this.document.removeEventListener(box_edit_constants.OUTPUT_EVENT,this.appExtensionEventResponseHandler),this.isActiveXExtensionListenerAttached=!1)})),ActiveXChannel_defineProperty(this,"appExtensionEventResponseHandler",(responseVal=>{this.retryAttempt>0&&(this.retryAttempt=0);const response="string"==typeof responseVal.detail?JSON.parse(responseVal.detail):responseVal.detail;if(this.reqIdToPromiseMap.has(response.req_id)){const resolveObj=this.reqIdToPromiseMap.get(response.req_id);if(resolveObj){clearTimeout(resolveObj.rejectTimeout),this.reqIdToPromiseMap.delete(response.req_id);const responseData="string"==typeof response.com_server_response.data?JSON.parse(response.com_server_response.data):response.com_server_response.data;resolveObj.resolve(responseData)}}})),ActiveXChannel_defineProperty(this,"getComServerStatus",((browserToComServerTimeoutMS,comServerToApplicationTimeoutSec)=>this.executeOperation(box_edit_constants.OPERATION_STATUS,null,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec))),ActiveXChannel_defineProperty(this,"sendRequest",((data,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec)=>this.executeOperation(box_edit_constants.OPERATION_REQUEST,data,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec))),ActiveXChannel_defineProperty(this,"sendCommand",((data,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec)=>this.executeOperation(box_edit_constants.OPERATION_COMMAND,data,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec))),ActiveXChannel_defineProperty(this,"destroy",(()=>{this.tearDownActiveXCommunication()})),this.isSynchronous=isSynchronous,this.channelName=box_edit_constants.ACTIVEX_CHANNEL_NAME,this.reqIdToPromiseMap=new Map,this.isActiveXExtensionListenerAttached=!1,this.retryAttempt=0,this.document=document,this.window=window,this.setupActiveXCommunication()}};var LocalStore=__webpack_require__("./src/utils/LocalStore.js");function set(name,value,expires){let path=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"/",domain=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";const{document}=window,expiresDate=new Date,cookie=[];void 0===expires&&(expires=expiresDate.getTime()+5184e6),expiresDate.setTime(expires),cookie.push("".concat(name,"=").concat(encodeURIComponent(value))),0!==expires&&cookie.push("; expires=".concat(expiresDate.toUTCString())),cookie.push("; path=".concat(path)),domain&&cookie.push("; domain=".concat(domain)),cookie.push("; secure"),document.cookie=cookie.join("")}function HTTPChannel_defineProperty(obj,key,value){return(key=function HTTPChannel_toPropertyKey(t){var i=function HTTPChannel_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const localStore=new LocalStore.Z;function getPreferredPortOrdering(){return function shouldUseFallbackFirst(){return!!localStore.getItem("comUseFallback")}()?{primary:17224,fallback:17223}:{primary:17223,fallback:17224}}const box_edit_HTTPChannel=class HTTPChannel extends box_edit_Channel{constructor(_appName,_url,channelName){super(_appName),HTTPChannel_defineProperty(this,"createCORSRequest",((method,url)=>{let xhr;try{const{XMLHttpRequest}=this.window;return xhr=new XMLHttpRequest,xhr.open(method,url,!0),xhr}catch(ex){if(this.retryCounter<3)return this.retryCounter+=1,this.createCORSRequest(method,url);throw new Error("could not create xhr")}})),HTTPChannel_defineProperty(this,"getComServerStatusInstallationPromise",(timeoutMS=>{let resolve,reject;const comServerInstallationPromise=new Promise(((res,rej)=>{resolve=res,reject=rej})),resolveWithValidPort=(port,res)=>{this.currentPort=port,17223===port?function clearFallbackPortPreference(){localStore.removeItem("comUseFallback")}():function saveFallbackPortPreference(){localStore.setItem("comUseFallback",1)}(),this.comServerInstallationPromiseRejected=!1,resolve(res)},portPreferences=getPreferredPortOrdering(),primaryPort=portPreferences.primary,fallbackPort=portPreferences.fallback;return this.checkInstallStatus(primaryPort,timeoutMS).then(resolveWithValidPort.bind(this,primaryPort)).catch((err=>{if("notrunning"===err)return this.comServerInstallationPromiseRejected=!0,void reject();this.checkInstallStatus(fallbackPort,timeoutMS).then(resolveWithValidPort.bind(this,fallbackPort)).catch((()=>{this.comServerInstallationPromiseRejected=!0,reject()}))})),comServerInstallationPromise})),HTTPChannel_defineProperty(this,"sendComServerRequest",((method,url,data,timeoutMS)=>new Promise(((resolve,reject)=>{try{const request=this.createCORSRequest(method,url);request.setRequestHeader("Content-Type","text/plain; charset=UTF-8"),request.onload=()=>{resolve(request)},request.onerror=()=>{reject(request)},timeoutMS>0&&(request.timeout=timeoutMS,request.ontimeout=()=>{reject(request)}),setTimeout((()=>{request.send(data)}),0)}catch(err){reject()}})))),HTTPChannel_defineProperty(this,"checkInstallStatus",((port,timeoutMS)=>this.sendComServerRequest("GET","".concat(this.url).concat(port,"/status"),null,timeoutMS).then((request=>{const response=JSON.parse(request.responseText);if(response.running)return response;throw this.comServerInstallationPromiseRejected=!0,new Error("notrunning")})))),HTTPChannel_defineProperty(this,"getComChannel",(appName=>function cookies_get(name){const{document}=window,cookies=document.cookie.split("; "),len=cookies.length;let pair,i;for(i=0;i<len;i+=1)if(pair=cookies[i].split("="),pair[0]===name)return pair[1]?decodeURIComponent(pair[1]):"";return""}("".concat(appName,"-bgp-id")))),HTTPChannel_defineProperty(this,"setComChannel",(appName=>{const bgpId=this.getComChannel(appName)||this.generateId(),comChannelName="bgp-".concat(bgpId),aYearFromNow=(new Date).getTime()+31536e6;return set("".concat(appName,"-bgp-id"),bgpId,aYearFromNow),set("bgp-".concat(bgpId),"generic",aYearFromNow),comChannelName})),HTTPChannel_defineProperty(this,"getComServerStatus",(timeoutMS=>!this.comServerInstallationPromise||this.comServerInstallationPromiseRejected?(this.comServerInstallationPromise=null,this.comServerInstallationPromise=this.getComServerStatusInstallationPromise(timeoutMS),this.comServerInstallationPromise):this.comServerInstallationPromise)),HTTPChannel_defineProperty(this,"sendRequest",((data,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec)=>{const url="".concat(this.url).concat(this.currentPort,"/application_request?application=").concat(this.appName,"&com=").concat(this.comChannelName,"&timeout=").concat(comServerToApplicationTimeoutSec);return this.sendComServerRequest("POST",url,data,browserToComServerTimeoutMS).then((results=>{const response=JSON.parse(results.responseText);if(response.response_type&&"error"===response.response_type)throw new Error("Communication error: ".concat(response.message));return response}))})),HTTPChannel_defineProperty(this,"sendCommand",((data,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec)=>{const url="".concat(this.url).concat(this.currentPort,"/application_command?application=").concat(this.appName,"&com=").concat(this.comChannelName,"&timeout=").concat(comServerToApplicationTimeoutSec);return this.sendComServerRequest("POST",url,data,browserToComServerTimeoutMS).then((results=>JSON.parse(results.responseText)))})),HTTPChannel_defineProperty(this,"generateId",(()=>{const time=(new Date).getTime();return"xxxxxxxx".replace(/x/g,(()=>Math.floor((time+16*Math.random())%16).toString(16)))})),this.url=_url,this.comChannelName=this.setComChannel(_appName),this.channelName=channelName,this.comServerInstallationPromise=null,this.comServerInstallationPromiseRejected=!1,this.retryCounter=0,this.sendCount=0,this.currentPort=getPreferredPortOrdering().primary,this.window=window}};function SafariChannel_defineProperty(obj,key,value){return(key=function SafariChannel_toPropertyKey(t){var i=function SafariChannel_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const box_edit_SafariChannel=class SafariChannel extends box_edit_Channel{constructor(appName){var _this;super(appName),_this=this,SafariChannel_defineProperty(this,"executeOperation",(function(){let operationType=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},browserToComServerTimeoutMS=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,comServerToApplicationTimeoutSec=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new Promise(((resolve,reject)=>{const details=_this.buildDetailsObj(operationType,data,comServerToApplicationTimeoutSec),timeoutId=setTimeout((()=>{reject(new Error({status_code:box_edit_constants.REQUEST_TIMEOUT_RESPONSE_CODE}))}),browserToComServerTimeoutMS);_this.reqIdToPromiseMap.set(details.req_id,{resolve,rejectTimeout:timeoutId}),_this.createAndDispatchAppExtensionEvent({detail:details})}))})),SafariChannel_defineProperty(this,"setupSafariExtensionCommunication",(()=>{this.isAppExtensionListenerAttached||(this.isAppExtensionListenerAttached=!0,this.document.addEventListener("box_extension_output",this.appExtensionEventResponseHandler))})),SafariChannel_defineProperty(this,"tearDownSafariExtensionCommunication",(()=>{this.isAppExtensionListenerAttached&&(this.isAppExtensionListenerAttached=!1,this.document.removeEventListener("box_extension_output",this.appExtensionEventResponseHandler))})),SafariChannel_defineProperty(this,"appExtensionEventResponseHandler",(responseVal=>{const response="string"==typeof responseVal.detail?JSON.parse(responseVal.detail):responseVal.detail;if(this.reqIdToPromiseMap.has(response.req_id)){const resolveObj=this.reqIdToPromiseMap.get(response.req_id);if(resolveObj){clearTimeout(resolveObj.rejectTimeout),this.reqIdToPromiseMap.delete(response.req_id);const responseData="string"==typeof response.com_server_response.data?JSON.parse(response.com_server_response.data):response.com_server_response.data;resolveObj.resolve(responseData)}}})),SafariChannel_defineProperty(this,"createAndDispatchAppExtensionEvent",(payload=>{const{CustomEvent}=this.window,eventInstance=new CustomEvent("box_extension_input",payload);this.document.dispatchEvent(eventInstance)})),SafariChannel_defineProperty(this,"getComServerStatus",((browserToComServerTimeoutMS,comServerToApplicationTimeoutSec)=>this.executeOperation(box_edit_constants.OPERATION_STATUS,null,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec))),SafariChannel_defineProperty(this,"sendRequest",((data,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec)=>this.executeOperation(box_edit_constants.OPERATION_REQUEST,data,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec))),SafariChannel_defineProperty(this,"sendCommand",((data,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec)=>this.executeOperation(box_edit_constants.OPERATION_COMMAND,data,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec))),SafariChannel_defineProperty(this,"destroy",(()=>{this.tearDownSafariExtensionCommunication()})),this.reqIdToPromiseMap=new Map,this.channelName=box_edit_constants.SAFARI_CHANNEL_NAME,this.window=window,this.document=document,this.setupSafariExtensionCommunication()}};function ComServerClient_defineProperty(obj,key,value){return(key=function ComServerClient_toPropertyKey(t){var i=function ComServerClient_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const MIN_FIREFOX_VERSION_FOR_MIXED_CONTENT=55,MIN_EDGE_16_VERSION_FOR_MIXED_CONTENT="16.16299",MIN_EDGE_VERSION_FOR_MIXED_CONTENT="17.17134";let boxToolsLogData;function createHTTPChannel(appName){const{BOX_UNSECURE_LOCAL_BASE_URL,CREATED_STATUS,HTTP_CHANNEL_NAME}=box_edit_constants;return boxToolsLogData.http_channel_status=CREATED_STATUS,new box_edit_HTTPChannel(appName,BOX_UNSECURE_LOCAL_BASE_URL,HTTP_CHANNEL_NAME)}function createSafariChannel(appName){const{CREATED_STATUS}=box_edit_constants;return boxToolsLogData.safari_channel_status=CREATED_STATUS,new box_edit_SafariChannel(appName)}function createSynchronousActiveXChannel(appName){const{CREATED_STATUS}=box_edit_constants;return boxToolsLogData.activex_channel_status=CREATED_STATUS,new box_edit_ActiveXChannel(appName,!0)}function isSupportedMSEdgeVersion(){const{EDGE}=BROWSER_CONSTANTS;return box_edit_BrowserUtils.isMinBrowser(EDGE,MIN_EDGE_VERSION_FOR_MIXED_CONTENT)||box_edit_BrowserUtils.isMinBrowser(EDGE,MIN_EDGE_16_VERSION_FOR_MIXED_CONTENT)&&box_edit_BrowserUtils.getVersion().startsWith("16.")}function isUnsupportedMSEdgeVersion(){return box_edit_BrowserUtils.isEdge()&&!isSupportedMSEdgeVersion()}function isMixedContentAllowedOnLocalhost(){const{CHROME,FIREFOX}=BROWSER_CONSTANTS;return box_edit_BrowserUtils.isMinBrowser(CHROME,53)||box_edit_BrowserUtils.isMinBrowser(FIREFOX,MIN_FIREFOX_VERSION_FOR_MIXED_CONTENT)||isSupportedMSEdgeVersion()}function isSupportedSafariVersion(){return box_edit_BrowserUtils.isMinBrowser(BROWSER_CONSTANTS.SAFARI,10)}function isSupportedIEVersion(){return box_edit_BrowserUtils.isMinBrowser(BROWSER_CONSTANTS.IE,11)}function comServerErrorGenerator(reject){const{BOX_EDIT_NOT_SUPPORTED_ERROR,BOX_EDIT_SAFARI_ERROR,BOX_EDIT_UNINSTALLED_ERROR,BOX_EDIT_UPGRADE_BROWSER_ERROR}=box_edit_constants;let errorMessageID=BOX_EDIT_NOT_SUPPORTED_ERROR;return isMixedContentAllowedOnLocalhost()||isSupportedIEVersion()?errorMessageID=BOX_EDIT_UNINSTALLED_ERROR:box_edit_BrowserUtils.isFirefox()||box_edit_BrowserUtils.isChrome()||function isUnsupportedSafariVersion(){return box_edit_BrowserUtils.isSafari()&&!isSupportedSafariVersion()}()||isUnsupportedMSEdgeVersion()?errorMessageID=BOX_EDIT_UPGRADE_BROWSER_ERROR:isSupportedSafariVersion()&&(errorMessageID=BOX_EDIT_SAFARI_ERROR),boxToolsLogData.error_message=errorMessageID,reject(new Error(errorMessageID))}function validateAndReturnBrowserToComServerTimeout(customTimeoutMS){let timeoutMS=5e3;return"number"==typeof customTimeoutMS&&customTimeoutMS>=0&&(timeoutMS=Math.floor(customTimeoutMS)),timeoutMS}function shortenAndReturnComServerToApplicationTimeout(browserToComServerTimeoutMS){let timeoutSec=+(browserToComServerTimeoutMS/1e3).toFixed(2);return browserToComServerTimeoutMS<2?timeoutSec/=2:timeoutSec-=1,timeoutSec}const box_edit_ComServerClient=class ComServerClient{constructor(appName){ComServerClient_defineProperty(this,"isInitialized",!1),this.channels=[],this.isInitialized=!0,function initBoxToolsLogData(){const browserName=box_edit_BrowserUtils.getName(),browserVersion=box_edit_BrowserUtils.getVersion(),{UNCREATED_STATUS}=box_edit_constants;boxToolsLogData={box_tools_version:null,browser_name:browserName,browser_version:browserVersion,error_message:null,installation_type:null,http_channel_status:UNCREATED_STATUS,https_channel_status:UNCREATED_STATUS,activex_channel_status:UNCREATED_STATUS,safari_channel_status:UNCREATED_STATUS}}(),isMixedContentAllowedOnLocalhost()?this.channels.push(createHTTPChannel(appName)):isSupportedSafariVersion()?this.channels.push(createSafariChannel(appName)):!function isSupportedIEAndBoxToolsPluginAvailable(){return isSupportedIEVersion()&&box_edit_BrowserUtils.isIEAndSpecificBrowserPluginSupported(box_edit_constants.BOX_TOOLS_PLUGIN_NAME)}()?function isFirefoxWithExtensionsCapability(){return box_edit_BrowserUtils.isFirefox()&&!box_edit_BrowserUtils.isMinBrowser(BROWSER_CONSTANTS.FIREFOX,MIN_FIREFOX_VERSION_FOR_MIXED_CONTENT)}()||isUnsupportedMSEdgeVersion()||(this.channels=this.channels.concat([createHTTPChannel(appName),createSafariChannel(appName),createSynchronousActiveXChannel(appName)])):this.channels.push(function createActiveXChannel(appName){const{CREATED_STATUS}=box_edit_constants;return boxToolsLogData.activex_channel_status=CREATED_STATUS,new box_edit_ActiveXChannel(appName,!1)}(appName))}getComServerStatus(customTimeoutMS){const{ACTIVE_STATUS}=box_edit_constants,browserToComServerTimeoutMS=validateAndReturnBrowserToComServerTimeout(customTimeoutMS),comServerToApplicationTimeoutSec=shortenAndReturnComServerToApplicationTimeout(browserToComServerTimeoutMS),shouldRejectPromiseDueToUnSupportedMSEdgeOrVersion=isUnsupportedMSEdgeVersion();return new Promise(((resolve,reject)=>shouldRejectPromiseDueToUnSupportedMSEdgeOrVersion?comServerErrorGenerator.call(null,reject):this.channels.length?promise(this.channels.map((channel=>channel.getComServerStatus(browserToComServerTimeoutMS,comServerToApplicationTimeoutSec).then((res=>(this.activeChannel=channel,res&&(boxToolsLogData.installation_type=res.installation_type,boxToolsLogData.box_tools_version=res.version),boxToolsLogData["".concat(channel.channelName,"_status")]=ACTIVE_STATUS,resolve(res))))))).catch(comServerErrorGenerator.bind(null,reject)):comServerErrorGenerator.call(null,reject)))}sendRequest(requestData,isSynchronous,customTimeoutMS){const browserToComServerTimeoutMS=validateAndReturnBrowserToComServerTimeout(customTimeoutMS),comServerToApplicationTimeoutSec=shortenAndReturnComServerToApplicationTimeout(browserToComServerTimeoutMS);return this.activeChannel?this.activeChannel.sendRequest(requestData,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec):this.getComServerStatus().then((()=>this.activeChannel.sendRequest(requestData,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec)))}sendCommand(data,customTimeoutMS){const browserToComServerTimeoutMS=validateAndReturnBrowserToComServerTimeout(customTimeoutMS),comServerToApplicationTimeoutSec=shortenAndReturnComServerToApplicationTimeout(browserToComServerTimeoutMS);return this.activeChannel?this.activeChannel.sendCommand(data,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec):this.getComServerStatus().then((()=>this.activeChannel.sendCommand(data,browserToComServerTimeoutMS,comServerToApplicationTimeoutSec)))}};let extensionRequestTimeout;let BoxEditInstance=null;class BoxEdit{constructor(){return BoxEditInstance instanceof BoxEdit||(BoxEditInstance=this),this.extensionRequestQueue=new Map,BoxEditInstance}queueGetNativeAppNameFromLocal(extension){if(this.extensionRequestQueue.has(extension)){const queueItem=this.extensionRequestQueue.get(extension);if(!queueItem)throw new Error("Race condition re: queueGetNativeAppNameFromLocal");return queueItem.promise}const extensionRequest={},appNameRequestPromise=new Promise(((resolve,reject)=>{extensionRequest.resolve=resolve,extensionRequest.reject=reject}));return extensionRequest.promise=appNameRequestPromise,this.extensionRequestQueue.set(extension,extensionRequest),appNameRequestPromise}checkBoxEditAvailability(){return this.getBoxEditAvailability()}getBoxEditAvailability(){return this.client=new box_edit_ComServerClient(box_edit_constants.BOX_EDIT_APP_NAME),this.client.getComServerStatus()}async canOpenWithBoxEdit(extensions){const extensionToAppTuples=await Promise.all(extensions.map((async ext=>{try{const appName=await this.getAppForExtension(ext);return[ext,appName]}catch(err){return[ext,""]}}))),resultMap=new Map;return extensionToAppTuples.forEach((tuple=>resultMap.set(...tuple))),Promise.resolve(resultMap)}openFile(fileID,token){const executeDataAsString=function createExecuteData(fileId,token,authCode,tokenScope){return JSON.stringify({auth_code:authCode,auth_token:token,browser_type:box_edit_BrowserUtils.getName(),command_type:"launch_application",file_id:fileId.toString(),token_scope:tokenScope})}(fileID,token.data.token,token.data.auth_code,token.data.token_scope);return this.client.sendCommand(executeDataAsString,5e3)}getAppForExtension(extension){try{if(function isBlacklistedExtension(extension){const{EXTENSION_BLACKLIST}=box_edit_constants;let uppercaseExt=extension.toUpperCase();return"."===uppercaseExt.charAt(0)&&(uppercaseExt=uppercaseExt.substr(1)),uppercaseExt in EXTENSION_BLACKLIST}(extension))throw new Error("blacklisted");const applicationSupportRequest=this.queueGetNativeAppNameFromLocal(extension);return extensionRequestTimeout||(extensionRequestTimeout=setTimeout((()=>{this.processExtensionRequestQueue()}),100)),applicationSupportRequest}catch(err){return Promise.reject()}}processExtensionRequestQueue(){const copyQueue=new Map,extensions=[];this.extensionRequestQueue.forEach(((value,key)=>{copyQueue.set(key,value),extensions.push(key)})),this.extensionRequestQueue.clear(),extensionRequestTimeout=null;const requestData=function createRequestData(extensions){return JSON.stringify({request_type:"get_default_application",extension:extensions})}(extensions);return this.client.sendRequest(requestData).then((data=>{if(data&&data.default_application_name){let defaultApplicationName=data.default_application_name;"[object Object]"===Object.prototype.toString.call(defaultApplicationName)&&(defaultApplicationName=[defaultApplicationName]),defaultApplicationName.forEach((extensionAppObj=>{const extension=Object.keys(extensionAppObj)[0],appName=decodeURIComponent(extensionAppObj[extension]);if(appName){const queueItem=copyQueue.get(extension);queueItem&&(queueItem.resolve(appName),copyQueue.delete(extension))}}))}extensions.forEach((extension=>{const queueItem=copyQueue.get(extension);queueItem&&queueItem.reject()}))}))}}const box_edit_BoxEdit=BoxEdit;class Intelligence extends Base.Z{async ask(prompt,items){if(!prompt)throw new Error("Missing prompt!");if(!items||0===items.length)throw new Error("Missing items!");items.forEach((item=>{if(!item.id||!item.type)throw new Error("Invalid item!")}));const url="".concat(this.getBaseApiUrl(),"/ai/ask");return this.xhr.post({url,id:"file_".concat(items[0].id),data:{mode:"single_item_qa",prompt,items}})}}const api_Intelligence=Intelligence;function APIFactory_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function APIFactory_defineProperty(obj,key,value){return(key=function APIFactory_toPropertyKey(t){var i=function APIFactory_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const api_APIFactory=class APIFactory{constructor(options){this.options=function APIFactory_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?APIFactory_ownKeys(Object(t),!0).forEach((function(r){APIFactory_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):APIFactory_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({},options,{apiHost:options.apiHost||constants.KPx,uploadHost:options.uploadHost||constants._6Q,cache:options.cache||new Cache.Z,language:options.language})}destroy(){let destroyCache=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.fileAPI&&(this.fileAPI.destroy(),delete this.fileAPI),this.weblinkAPI&&(this.weblinkAPI.destroy(),delete this.weblinkAPI),this.plainUploadAPI&&(this.plainUploadAPI.destroy(),delete this.plainUploadAPI),this.chunkedUploadAPI&&(this.chunkedUploadAPI.destroy(),delete this.chunkedUploadAPI),this.folderAPI&&(this.folderAPI.destroy(),delete this.folderAPI),this.searchAPI&&(this.searchAPI.destroy(),delete this.searchAPI),this.recentsAPI&&(this.recentsAPI.destroy(),delete this.recentsAPI),this.versionsAPI&&(this.versionsAPI.destroy(),delete this.versionsAPI),this.fileAccessStatsAPI&&(this.fileAccessStatsAPI.destroy(),delete this.fileAccessStatsAPI),this.fileActivitiesAPI&&(this.fileActivitiesAPI.destroy(),delete this.fileActivitiesAPI),this.tasksNewAPI&&(this.tasksNewAPI.destroy(),delete this.tasksNewAPI),this.taskCollaboratorsAPI&&(this.taskCollaboratorsAPI.destroy(),delete this.taskCollaboratorsAPI),this.taskLinksAPI&&(this.taskLinksAPI.destroy(),delete this.taskLinksAPI),this.commentsAPI&&(this.commentsAPI.destroy(),delete this.commentsAPI),this.threadedCommentsAPI&&(this.threadedCommentsAPI.destroy(),delete this.threadedCommentsAPI),this.markerBasedGroupsAPI&&(this.markerBasedGroupsAPI.destroy(),delete this.markerBasedGroupsAPI),this.markerBasedUsersAPI&&(this.markerBasedUsersAPI.destroy(),delete this.markerBasedUsersAPI),this.groupsAPI&&(this.groupsAPI.destroy(),delete this.groupsAPI),this.usersAPI&&(this.usersAPI.destroy(),delete this.usersAPI),this.metadataAPI&&(this.metadataAPI.destroy(),delete this.metadataAPI),this.fileCollaboratorsAPI&&(this.fileCollaboratorsAPI.destroy(),delete this.fileCollaboratorsAPI),this.fileCollaborationsAPI&&(this.fileCollaborationsAPI.destroy(),delete this.fileCollaborationsAPI),this.folderCollaborationsAPI&&(this.folderCollaborationsAPI.destroy(),delete this.folderCollaborationsAPI),this.collaborationsAPI&&(this.collaborationsAPI.destroy(),delete this.collaborationsAPI),this.appIntegrationsAPI&&(this.appIntegrationsAPI.destroy(),delete this.appIntegrationsAPI),this.metadataQueryAPI&&(this.metadataQueryAPI.destroy(),delete this.metadataQueryAPI),this.openWithAPI&&(this.openWithAPI.destroy(),delete this.openWithAPI),this.annotationsAPI&&(this.annotationsAPI.destroy(),delete this.annotationsAPI),this.intelligenceAPI&&(this.intelligenceAPI.destroy(),delete this.intelligenceAPI),destroyCache&&(this.options.cache=new Cache.Z)}getCache(){return this.options.cache}getAPI(type){let api;switch(type){case constants.mQf:api=this.getFolderAPI();break;case constants.nqi:api=this.getFileAPI();break;case constants.zSe:api=this.getWebLinkAPI();break;default:throw new Error("Unknown Type!")}return api}getFileAPI(){return(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.destroy(),this.fileAPI=new File.Z(this.options),this.fileAPI}getWebLinkAPI(){return this.destroy(),this.weblinkAPI=new WebLink.Z(this.options),this.weblinkAPI}getPlainUploadAPI(){return this.destroy(),this.plainUploadAPI=new uploads_PlainUpload(this.options),this.plainUploadAPI}getChunkedUploadAPI(){return this.destroy(),this.chunkedUploadAPI=new uploads_MultiputUpload(this.options),this.chunkedUploadAPI}getFolderAPI(){return this.destroy(),this.folderAPI=new Folder.Z(this.options),this.folderAPI}getSearchAPI(){return this.destroy(),this.searchAPI=new api_Search(this.options),this.searchAPI}getRecentsAPI(){return this.destroy(),this.recentsAPI=new api_Recents(this.options),this.recentsAPI}getMetadataAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.metadataAPI=new api_Metadata(this.options),this.metadataAPI}getVersionsAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.versionsAPI=new api_Versions(this.options),this.versionsAPI}getCommentsAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.commentsAPI=new api_Comments(this.options),this.commentsAPI}getThreadedCommentsAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.threadedCommentsAPI=new api_ThreadedComments(this.options),this.threadedCommentsAPI}getTasksNewAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.tasksNewAPI=new tasks_TasksNew(this.options),this.tasksNewAPI}getTaskCollaboratorsAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.taskCollaboratorsAPI=new tasks_TaskCollaborators(this.options),this.taskCollaboratorsAPI}getTaskLinksAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.taskLinksAPI=new tasks_TaskLinks(this.options),this.taskLinksAPI}getFileAccessStatsAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.fileAccessStatsAPI=new api_FileAccessStats(this.options),this.fileAccessStatsAPI}getFileActivitiesAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.fileActivitiesAPI=new api_FileActivities(this.options),this.fileActivitiesAPI}getFileCollaboratorsAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.fileCollaboratorsAPI=new api_FileCollaborators(this.options),this.fileCollaboratorsAPI}getFileCollaborationsAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.fileCollaborationsAPI=new api_FileCollaborations(this.options),this.fileCollaborationsAPI}getFolderCollaborationsAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.folderCollaborationsAPI=new api_FolderCollaborations(this.options),this.folderCollaborationsAPI}getCollaborationsAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.collaborationsAPI=new api_Collaborations(this.options),this.collaborationsAPI}getMarkerBasedGroupsAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.markerBasedGroupsAPI=new api_MarkerBasedGroups(this.options),this.markerBasedGroupsAPI}getMarkerBasedUsersAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.markerBasedUsersAPI=new api_MarkerBasedUsers(this.options),this.markerBasedUsersAPI}getGroupsAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.groupsAPI=new api_Groups(this.options),this.groupsAPI}getUsersAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.usersAPI=new api_Users(this.options),this.usersAPI}getFeedAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.feedItemsAPI=new api_Feed(this.options),this.feedItemsAPI}getOpenWithAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.openWithAPI=new api_OpenWith(this.options),this.openWithAPI}getAppIntegrationsAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.appIntegrationsAPI=new api_AppIntegrations(this.options),this.appIntegrationsAPI}getMetadataQueryAPI(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.destroy(),this.metadataQueryAPI=new api_MetadataQuery(this.options),this.metadataQueryAPI}getBoxEditAPI(){return this.boxEditAPI=new box_edit_BoxEdit,this.boxEditAPI}getAnnotationsAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.annotationsAPI=new Annotations(this.options),this.annotationsAPI}getIntelligenceAPI(shouldDestroy){return shouldDestroy&&this.destroy(),this.intelligenceAPI=new api_Intelligence(this.options),this.intelligenceAPI}}},"./src/api/Base.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>api_Base});var noop=__webpack_require__("./node_modules/lodash/noop.js"),noop_default=__webpack_require__.n(noop),axios=__webpack_require__("./node_modules/axios/index.js"),axios_default=__webpack_require__.n(axios),get=__webpack_require__("./node_modules/lodash/get.js"),get_default=__webpack_require__.n(get),includes=__webpack_require__("./node_modules/lodash/includes.js"),includes_default=__webpack_require__.n(includes),lowerCase=__webpack_require__("./node_modules/lodash/lowerCase.js"),lowerCase_default=__webpack_require__.n(lowerCase),TokenService=__webpack_require__("./src/utils/TokenService.js"),constants=__webpack_require__("./src/constants.js");function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _defineProperty(obj,key,value){return(key=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const DEFAULT_UPLOAD_TIMEOUT_MS=12e4,RETRYABLE_HTTP_METHODS=[constants.R3d,constants.tKy,constants.mj2].map(lowerCase_default());const utils_Xhr=class Xhr{constructor(){let{id,clientName,language,token,version,sharedLink,sharedLinkPassword,responseInterceptor,requestInterceptor,retryableStatusCodes=[constants.QUF],shouldRetry:_shouldRetry=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_defineProperty(this,"retryCount",0),_defineProperty(this,"errorInterceptor",(error=>{if(this.shouldRetryRequest(error)){this.retryCount+=1;const delay=this.getExponentialRetryTimeoutInMs(this.retryCount);return new Promise(((resolve,reject)=>{this.retryTimeout=setTimeout((()=>{this.axios(error.config).then(resolve,reject)}),delay)}))}const errorObject=get_default()(error,"response.data")||error;return this.responseInterceptor(errorObject),Promise.reject(error)})),this.clientName=clientName,this.id=id,this.language=language,this.responseInterceptor=responseInterceptor||this.defaultResponseInterceptor,this.retryableStatusCodes=retryableStatusCodes,this.sharedLink=sharedLink,this.sharedLinkPassword=sharedLinkPassword,this.shouldRetry=_shouldRetry,this.token=token,this.version=version,this.axios=axios_default().create(),this.axiosSource=axios_default().CancelToken.source(),this.axios.interceptors.response.use(this.responseInterceptor,this.errorInterceptor),"function"==typeof requestInterceptor&&this.axios.interceptors.request.use(requestInterceptor)}defaultResponseInterceptor(response){return response}shouldRetryRequest(error){if(!this.shouldRetry||this.retryCount>=3)return!1;const{response,request,config}=error,status=get_default()(response,"status"),method=get_default()(config,"method"),isNetworkError=request&&!response,isRateLimitError=status===constants.QUF,isOtherRetryableError=includes_default()(this.retryableStatusCodes,status)&&includes_default()(RETRYABLE_HTTP_METHODS,method);return isNetworkError||isRateLimitError||isOtherRetryableError}getExponentialRetryTimeoutInMs(numRetries){return 2**(numRetries-1)*1e3+Math.ceil(1e3*Math.random())}getParsedUrl(url){const a=document.createElement("a");return a.href=url,{api:url.replace("".concat(a.origin,"/2.0"),""),host:a.host,hostname:a.hostname,pathname:a.pathname,origin:a.origin,protocol:a.protocol,hash:a.hash,port:a.port}}async getHeaders(id){let args=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const headers=function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({Accept:"application/json",[constants.JdJ]:"application/json"},args);this.language&&!headers[constants.VeJ]&&(headers[constants.VeJ]=this.language),this.sharedLink&&(headers.BoxApi="shared_link=".concat(this.sharedLink),this.sharedLinkPassword&&(headers.BoxApi="".concat(headers.BoxApi,"&shared_link_password=").concat(this.sharedLinkPassword))),this.clientName&&(headers[constants.A2e]=this.clientName),this.version&&(headers[constants.OcZ]=this.version);const itemId=id||this.id||"",token=await TokenService.Z.getWriteToken(itemId,this.token);return token&&(headers.Authorization="Bearer ".concat(token)),headers}get(_ref){let{url,id,params={},headers={}}=_ref;return this.getHeaders(id,headers).then((hdrs=>this.axios.get(url,{cancelToken:this.axiosSource.token,params,headers:hdrs,parsedUrl:this.getParsedUrl(url)})))}post(_ref2){let{url,id,data,params,headers={},method=constants.qgD}=_ref2;return this.getHeaders(id,headers).then((hdrs=>this.axios({url,data,params,method,parsedUrl:this.getParsedUrl(url),headers:hdrs})))}put(_ref3){let{url,id,data,params,headers={}}=_ref3;return this.post({id,url,data,params,headers,method:constants.PMc})}delete(_ref4){let{url,id,data={},headers={}}=_ref4;return this.post({id,url,data,headers,method:constants.kUP})}options(_ref5){let{id,url,data,headers={},successHandler,errorHandler}=_ref5;return this.getHeaders(id,headers).then((hdrs=>this.axios({url,data,method:constants.tKy,headers:hdrs}).then(successHandler).catch(errorHandler))).catch(errorHandler)}uploadFile(_ref6){let{id,url,data,headers={},method=constants.qgD,successHandler,errorHandler,progressHandler,withIdleTimeout=!1,idleTimeoutDuration=DEFAULT_UPLOAD_TIMEOUT_MS,idleTimeoutHandler}=_ref6;return this.getHeaders(id,headers).then((hdrs=>{let idleTimeout,progressHandlerToUse=progressHandler;if(withIdleTimeout){const idleTimeoutFunc=()=>{this.abort(),idleTimeoutHandler&&idleTimeoutHandler()};idleTimeout=setTimeout(idleTimeoutFunc,idleTimeoutDuration),progressHandlerToUse=event=>{clearTimeout(idleTimeout),idleTimeout=setTimeout(idleTimeoutFunc,idleTimeoutDuration),progressHandler(event)}}this.axios({url,data,transformRequest:(reqData,reqHeaders)=>{if(delete reqHeaders[constants.kXz],delete reqHeaders[constants.JdJ],headers[constants.JdJ]&&(reqHeaders[constants.JdJ]=headers[constants.JdJ]),reqData&&!(reqData instanceof Blob)&&reqData.attributes){const formData=new FormData;return Object.keys(reqData).forEach((key=>{formData.append(key,reqData[key])})),formData}return reqData},method,headers:hdrs,onUploadProgress:progressHandlerToUse,cancelToken:this.axiosSource.token}).then((response=>{clearTimeout(idleTimeout),successHandler(response)})).catch((error=>{clearTimeout(idleTimeout),errorHandler(error)}))})).catch(errorHandler)}abort(){this.retryTimeout&&clearTimeout(this.retryTimeout),this.axiosSource&&(this.axiosSource.cancel(),this.axiosSource=axios_default().CancelToken.source())}};var Cache=__webpack_require__("./src/utils/Cache.js"),LocalStore=__webpack_require__("./src/utils/LocalStore.js");const uploads_UploadsReachability=class UploadsReachability{constructor(){this.localStore=new LocalStore.Z,this.cachedResults={},this.populateCachedResultsWithValidLocalStoreValues(),this.saveCachedResultsToLocalStore()}getCachedResultsFromLocalStore(){return this.localStore.getItem("bcu-uploads-reachability-cached-results")}saveCachedResultsToLocalStore(){this.localStore.setItem("bcu-uploads-reachability-cached-results",this.cachedResults)}isCachedHostValid(result){return result.expirationTimestampMS>Date.now()}getCachedResult(uploadHost){if(uploadHost in this.cachedResults){const result=this.cachedResults[uploadHost];if(this.isCachedHostValid(result))return result}return null}updateCachedResult(uploadHost,isHostReachable){this.cachedResults[uploadHost]={isReachable:isHostReachable,expirationTimestampMS:Date.now()+864e5},this.saveCachedResultsToLocalStore()}populateCachedResultsWithValidLocalStoreValues(){const localStoreResults=this.getCachedResultsFromLocalStore();localStoreResults&&Object.keys(localStoreResults).forEach((uploadHost=>{const result=localStoreResults[uploadHost];this.isCachedHostValid(result)&&(this.cachedResults[uploadHost]=result)}))}getUnreachableHostsUrls(){const unreachableHosts=[];return this.cachedResults?(Object.keys(this.cachedResults).forEach((uploadHost=>{const value=this.cachedResults[uploadHost];this.isCachedHostValid(value)&&!value.isReachable&&unreachableHosts.push(uploadHost)})),unreachableHosts):unreachableHosts}async isReachable(uploadHost){if(uploadHost==="".concat(constants._6Q,"/")||uploadHost==="".concat(constants.a07,"/"))return!0;const cachedResult=this.getCachedResult(uploadHost);if(cachedResult)return cachedResult.isReachable;const isHostReachable=await this.makeReachabilityRequest(uploadHost);return this.updateCachedResult(uploadHost,isHostReachable),isHostReachable}async makeReachabilityRequest(uploadHost){const url="".concat(uploadHost,"html5?reachability_test=run"),headers={[constants.JdJ]:"application/x-www-form-urlencoded; charset=UTF-8","X-File-Name":"reachability_pseudofile.txt","X-File-Size":"1234"};try{await axios_default().post(url,"reachability_file=test_file_data",{headers})}catch(error){return!1}return!0}};var file=__webpack_require__("./src/utils/file.js"),error=__webpack_require__("./src/utils/error.js");function Base_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function Base_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Base_ownKeys(Object(t),!0).forEach((function(r){Base_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Base_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function Base_defineProperty(obj,key,value){return(key=function Base_toPropertyKey(t){var i=function Base_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const api_Base=class Base{constructor(options){Base_defineProperty(this,"successHandler",(data=>{this.isDestroyed()||"function"!=typeof this.successCallback||this.successCallback(data)})),Base_defineProperty(this,"errorHandler",(error=>{if(!this.isDestroyed()&&"function"==typeof this.errorCallback){const{response}=error;response&&response.data?this.errorCallback(response.data,this.errorCode):this.errorCallback(error,this.errorCode)}})),this.cache=options.cache||new Cache.Z,this.apiHost=options.apiHost||constants.KPx,this.uploadHost=options.uploadHost||constants._6Q,this.options=Base_objectSpread({},options,{apiHost:this.apiHost,uploadHost:this.uploadHost,cache:this.cache}),this.xhr=new utils_Xhr(this.options),this.destroyed=!1,this.consoleLog=options.consoleLog&&window.console&&window.console.log||noop_default(),this.consoleError=options.consoleError&&window.console&&window.console.error||noop_default(),this.uploadsReachability=new uploads_UploadsReachability}destroy(){this.xhr.abort(),this.destroyed=!0}isDestroyed(){return this.destroyed}checkApiCallValidity(permissionToCheck,permissions,id){if(!id||!permissions)throw(0,error.vz)();if(!permissions[permissionToCheck])throw(0,error.pm)()}getBaseApiUrl(){const suffix=this.apiHost.endsWith("/")?"2.0":"/2.0";return"".concat(this.apiHost).concat(suffix)}getBaseUploadUrl(){const suffix=this.uploadHost.endsWith("/")?"api/2.0":"/api/2.0";return"".concat(this.uploadHost).concat(suffix)}getCache(){return this.cache}getUrl(id){throw new Error("Implement me!")}format(entry){throw new Error("Implement me!")}get(_ref){let{id,successCallback,errorCallback,requestData,url}=_ref;const apiUrl=url||this.getUrl(id);return this.makeRequest(constants.R3d,id,apiUrl,successCallback,errorCallback,requestData)}post(_ref2){let{id,url,data,successCallback,errorCallback}=_ref2;return this.makeRequest(constants.qgD,id,url,successCallback,errorCallback,data)}put(_ref3){let{id,url,data,successCallback,errorCallback}=_ref3;return this.makeRequest(constants.PMc,id,url,successCallback,errorCallback,data)}delete(_ref4){let{id,url,data,successCallback,errorCallback}=_ref4;return this.makeRequest(constants.kUP,id,url,successCallback,errorCallback,data)}async makeRequest(method,id,url,successCallback,errorCallback){let requestData=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if(this.isDestroyed())return;this.successCallback=successCallback,this.errorCallback=errorCallback;const xhrMethod=this.xhr[method.toLowerCase()].bind(this.xhr);try{const{data}=await xhrMethod(Base_objectSpread({id:(0,file.mc)(id),url},requestData));this.successHandler(data)}catch(error){this.errorHandler(error)}}}},"./src/api/File.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var query_string__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/query-string/index.js"),lodash_get__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lodash/get.js"),lodash_get__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash_get__WEBPACK_IMPORTED_MODULE_1__),_utils_fields__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/utils/fields.js"),_utils_file__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/utils/file.js"),_utils_error__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/utils/error.js"),_constants__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/constants.js"),_Item__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/api/Item.js"),_utils_function__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/utils/function.js"),_utils_TokenService__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/utils/TokenService.js");function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(obj,key,value){return(key=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class File extends _Item__WEBPACK_IMPORTED_MODULE_6__.Z{getCacheKey(id){return"".concat(_constants__WEBPACK_IMPORTED_MODULE_5__.Hmf).concat(id)}getUrl(id){const suffix=id?"/".concat(id):"";return"".concat(this.getBaseApiUrl(),"/files").concat(suffix)}async getDownloadUrl(fileId,fileOrFileVersion,successCallback,errorCallback){this.errorCode=_constants__WEBPACK_IMPORTED_MODULE_5__.DYJ,this.errorCallback=errorCallback,this.successCallback=successCallback;const downloadAvailable=fileOrFileVersion[_constants__WEBPACK_IMPORTED_MODULE_5__.Q7k],downloadUrl=fileOrFileVersion[_constants__WEBPACK_IMPORTED_MODULE_5__.Nw6],token=await _utils_TokenService__WEBPACK_IMPORTED_MODULE_7__.Z.getReadToken((0,_utils_file__WEBPACK_IMPORTED_MODULE_3__.mc)(fileId),this.options.token);if(!downloadAvailable||!downloadUrl||!token)return void this.errorHandler(new Error("Download is missing required fields or token."));const{query,url:downloadBaseUrl}=query_string__WEBPACK_IMPORTED_MODULE_0__.parseUrl(downloadUrl),downloadUrlParams=_objectSpread({},query,{access_token:token}),downloadUrlQuery=query_string__WEBPACK_IMPORTED_MODULE_0__.stringify(downloadUrlParams);this.successHandler("".concat(downloadBaseUrl,"?").concat(downloadUrlQuery))}isRepresentationsCallComplete(response){const status=lodash_get__WEBPACK_IMPORTED_MODULE_1___default()(response,"data.status.state");return!status||status===_constants__WEBPACK_IMPORTED_MODULE_5__.Ndm||status===_constants__WEBPACK_IMPORTED_MODULE_5__.oFP||status===_constants__WEBPACK_IMPORTED_MODULE_5__.r7g}async generateRepresentation(representation){const infoUrl=lodash_get__WEBPACK_IMPORTED_MODULE_1___default()(representation,"info.url");return infoUrl?(0,_utils_function__WEBPACK_IMPORTED_MODULE_8__.j)(((successCallback,errorCallback)=>this.xhr.get({successCallback,errorCallback,url:infoUrl}).then((response=>this.isRepresentationsCallComplete(response)?successCallback(response.data):errorCallback(response.data))).catch((e=>{errorCallback(e)}))),4,2e3,2):representation}async getThumbnailUrl(item){const entry=lodash_get__WEBPACK_IMPORTED_MODULE_1___default()(item,"representations.entries[0]"),extension=lodash_get__WEBPACK_IMPORTED_MODULE_1___default()(entry,"representation"),template=lodash_get__WEBPACK_IMPORTED_MODULE_1___default()(entry,"content.url_template"),token=await _utils_TokenService__WEBPACK_IMPORTED_MODULE_7__.Z.getReadToken((0,_utils_file__WEBPACK_IMPORTED_MODULE_3__.mc)(item.id),this.options.token);if(!extension||!template||!token)return null;const thumbnailUrl=template.replace("{+asset_path}","jpg"===extension?"":"1.png"),{query,url:thumbnailBaseUrl}=query_string__WEBPACK_IMPORTED_MODULE_0__.parseUrl(thumbnailUrl),thumbnailUrlParams=_objectSpread({},query,{access_token:token}),thumbnailUrlQuery=query_string__WEBPACK_IMPORTED_MODULE_0__.stringify(thumbnailUrlParams);return"".concat(thumbnailBaseUrl,"?").concat(thumbnailUrlQuery)}setFileDescription(file,description,successCallback,errorCallback){const{id,permissions}=file;return id&&permissions?permissions.can_rename?this.xhr.put({id:(0,_utils_file__WEBPACK_IMPORTED_MODULE_3__.mc)(id),url:this.getUrl(id),data:{description}}).then((_ref=>{let{data}=_ref;if(!this.isDestroyed()){const updatedFile=this.merge(this.getCacheKey(id),"description",data.description);successCallback(updatedFile)}})).catch((()=>{if(!this.isDestroyed()){const originalFile=this.merge(this.getCacheKey(id),"description",file.description);errorCallback(originalFile)}})):(errorCallback((0,_utils_error__WEBPACK_IMPORTED_MODULE_4__.pm)()),Promise.reject()):(errorCallback((0,_utils_error__WEBPACK_IMPORTED_MODULE_4__.vz)()),Promise.reject())}async getFile(id,successCallback,errorCallback){let options=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(this.isDestroyed())return;const cache=this.getCache(),key=this.getCacheKey(id),isCached=!options.forceFetch&&cache.has(key),file=isCached?cache.get(key):{id};let missingFields=(0,_utils_fields__WEBPACK_IMPORTED_MODULE_2__.pJ)(file,options.fields);const xhrOptions={id:(0,_utils_file__WEBPACK_IMPORTED_MODULE_3__.mc)(id),url:this.getUrl(id),headers:{"X-Rep-Hints":_constants__WEBPACK_IMPORTED_MODULE_5__.Adp}};if(this.errorCode=_constants__WEBPACK_IMPORTED_MODULE_5__.b_T,this.successCallback=successCallback,this.errorCallback=errorCallback,!isCached||0!==missingFields.length||(successCallback(file),missingFields=options.fields||[],options.refreshCache)){missingFields.length>0&&(xhrOptions.params={fields:missingFields.toString()});try{const{data}=await this.xhr.get(xhrOptions);if(this.isDestroyed())return;const dataWithMissingFields=(0,_utils_fields__WEBPACK_IMPORTED_MODULE_2__.W0)(data,missingFields);cache.has(key)?cache.merge(key,dataWithMissingFields):cache.set(key,dataWithMissingFields),this.successHandler(cache.get(key))}catch(e){this.errorHandler(e)}}}getFileExtension(id,successCallback,errorCallback){this.isDestroyed()||this.getFile(id,successCallback,errorCallback,{fields:[_constants__WEBPACK_IMPORTED_MODULE_5__.Syy]})}}const __WEBPACK_DEFAULT_EXPORT__=File},"./src/api/Folder.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var lodash_noop__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/noop.js"),lodash_noop__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_noop__WEBPACK_IMPORTED_MODULE_0__),_utils_flatten__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/utils/flatten.js"),_utils_fields__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/utils/fields.js"),_utils_error__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/utils/error.js"),_Item__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/api/Item.js"),_File__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/api/File.js"),_WebLink__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/api/WebLink.js"),_constants__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/constants.js");function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(obj,key,value){return(key=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class Folder extends _Item__WEBPACK_IMPORTED_MODULE_4__.Z{constructor(){super(...arguments),_defineProperty(this,"folderSuccessHandler",(_ref=>{let{data}=_ref;if(this.isDestroyed())return;const{item_collection}=data;if(!item_collection)throw(0,_utils_error__WEBPACK_IMPORTED_MODULE_3__.vz)();const{entries,total_count,limit,offset}=item_collection;if(!Array.isArray(entries)||"number"!=typeof total_count||"number"!=typeof limit||"number"!=typeof offset)throw(0,_utils_error__WEBPACK_IMPORTED_MODULE_3__.vz)();const flattened=(0,_utils_flatten__WEBPACK_IMPORTED_MODULE_1__.Z)(entries,new Folder(this.options),new _File__WEBPACK_IMPORTED_MODULE_5__.Z(this.options),new _WebLink__WEBPACK_IMPORTED_MODULE_6__.Z(this.options));this.itemCache=(this.itemCache||[]).concat(flattened),this.getCache().set(this.key,_objectSpread({},data,{item_collection:_objectSpread({},item_collection,{entries:this.itemCache})})),this.finish()})),_defineProperty(this,"folderDetailsSuccessHandler",(_ref2=>{let{data}=_ref2;if(this.isDestroyed())return;const updatedCacheEntry=_objectSpread({},this.getCache().get(this.key),{},data);this.getCache().set(this.key,updatedCacheEntry),this.successCallback(updatedCacheEntry)})),_defineProperty(this,"createSuccessHandler",(_ref3=>{let{data}=_ref3;const{id:childId}=data;if(this.isDestroyed()||!childId)return;const childKey=this.getCacheKey(childId),cache=this.getCache(),parent=cache.get(this.key);if(!parent)return void this.successCallback(data);const{item_collection}=parent;if(!item_collection)throw(0,_utils_error__WEBPACK_IMPORTED_MODULE_3__.vz)();const{total_count,entries}=item_collection;if(!Array.isArray(entries)||"number"!=typeof total_count)throw(0,_utils_error__WEBPACK_IMPORTED_MODULE_3__.vz)();cache.set(childKey,data),item_collection.entries=[childKey].concat(entries),item_collection.total_count=total_count+1,this.successCallback(data)}))}getCacheKey(id){return"".concat(_constants__WEBPACK_IMPORTED_MODULE_7__.Asv).concat(id)}getUrl(id){const suffix=id?"/".concat(id):"";return"".concat(this.getBaseApiUrl(),"/folders").concat(suffix)}isLoaded(){return this.getCache().has(this.key)}finish(){if(this.isDestroyed())return;const cache=this.getCache(),folder=cache.get(this.key),{id,name,permissions,path_collection,item_collection}=folder;if(!item_collection||!path_collection)throw(0,_utils_error__WEBPACK_IMPORTED_MODULE_3__.vz)();const{entries,offset,total_count}=item_collection;if(!Array.isArray(entries)||"number"!=typeof total_count)throw(0,_utils_error__WEBPACK_IMPORTED_MODULE_3__.vz)();const collection={id,name,offset,percentLoaded:100,permissions,boxItem:folder,breadcrumbs:path_collection.entries,items:entries.map((key=>cache.get(key))),sortBy:this.sortBy,sortDirection:this.sortDirection,totalCount:total_count};this.successCallback(collection)}folderRequest(){let{fields,noPagination}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},successHandler=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.folderSuccessHandler;if(this.isDestroyed())return Promise.reject();const requestFields=fields||_utils_fields__WEBPACK_IMPORTED_MODULE_2__.YF;this.errorCode=_constants__WEBPACK_IMPORTED_MODULE_7__.ASZ;let params={fields:requestFields.toString()};return noPagination||(params=_objectSpread({},params,{direction:this.sortDirection.toLowerCase(),limit:this.limit,offset:this.offset,fields:requestFields.toString(),sort:this.sortBy.toLowerCase()})),this.xhr.get({url:this.getUrl(this.id),params,headers:requestFields.includes(_constants__WEBPACK_IMPORTED_MODULE_7__.cGX)?{"X-Rep-Hints":_constants__WEBPACK_IMPORTED_MODULE_7__.APX}:{}}).then(successHandler).catch(this.errorHandler)}getFolderFields(id,successCallback,errorCallback){let options=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.isDestroyed()||(this.id=id,this.key=this.getCacheKey(id),this.successCallback=successCallback,this.errorCallback=errorCallback,this.folderRequest(_objectSpread({},options,{noPagination:!0}),this.folderDetailsSuccessHandler))}getFolder(id,limit,offset,sortBy,sortDirection,successCallback,errorCallback){let options=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{};this.isDestroyed()||(this.id=id,this.key=this.getCacheKey(id),this.limit=limit,this.offset=offset,this.sortBy=sortBy,this.sortDirection=sortDirection,this.successCallback=successCallback,this.errorCallback=errorCallback,options.forceFetch&&this.getCache().unset(this.key),this.isLoaded()?this.finish():this.folderRequest(options))}folderCreateRequest(name){if(this.isDestroyed())return Promise.reject();this.errorCode=_constants__WEBPACK_IMPORTED_MODULE_7__.qhX;const url="".concat(this.getUrl(),"?fields=").concat(_utils_fields__WEBPACK_IMPORTED_MODULE_2__.YF.toString());return this.xhr.post({url,data:{name,parent:{id:this.id}}}).then(this.createSuccessHandler).catch(this.errorHandler)}create(id,name,successCallback){let errorCallback=arguments.length>3&&void 0!==arguments[3]?arguments[3]:lodash_noop__WEBPACK_IMPORTED_MODULE_0___default();this.isDestroyed()||(this.id=id,this.key=this.getCacheKey(id),this.successCallback=successCallback,this.errorCallback=errorCallback,this.folderCreateRequest(name))}}const __WEBPACK_DEFAULT_EXPORT__=Folder},"./src/api/Item.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var lodash_noop__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/noop.js"),lodash_noop__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_noop__WEBPACK_IMPORTED_MODULE_0__),lodash_set__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lodash/set.js"),lodash_set__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash_set__WEBPACK_IMPORTED_MODULE_1__),_utils_error__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/utils/error.js"),_utils_fields__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/utils/fields.js"),_Base__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/api/Base.js"),_constants__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/constants.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}function _defineProperty(obj,key,value){return(key=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}class Item extends _Base__WEBPACK_IMPORTED_MODULE_4__.Z{constructor(){super(...arguments),_defineProperty(this,"deleteSuccessHandler",(()=>{if(this.isDestroyed())return;const parentKey=this.getParentCacheKey(this.parentId),folder=this.getCache().get(parentKey);if(!folder)return void this.postDeleteCleanup();const{item_collection}=folder;if(!item_collection)return void this.postDeleteCleanup();const{entries,total_count}=item_collection;if(!Array.isArray(entries)||"number"!=typeof total_count)throw(0,_utils_error__WEBPACK_IMPORTED_MODULE_2__.vz)();const childKey=this.getCacheKey(this.id),oldCount=entries.length,newEntries=entries.filter((entry=>entry!==childKey)),newCount=newEntries.length,updatedObject=this.merge(parentKey,"item_collection",_extends(item_collection,{entries:newEntries,total_count:total_count-(oldCount-newCount)}));this.successCallback(updatedObject),this.postDeleteCleanup()})),_defineProperty(this,"renameSuccessHandler",(_ref=>{let{data}=_ref;if(!this.isDestroyed()){this.getCache().unsetAll(_constants__WEBPACK_IMPORTED_MODULE_5__.dtD);const updatedObject=this.merge(this.getCacheKey(this.id),"name",data.name);this.successCallback(updatedObject)}})),_defineProperty(this,"shareSuccessHandler",((data,fields)=>{if(!this.isDestroyed()){const dataWithMissingFields=fields?(0,_utils_fields__WEBPACK_IMPORTED_MODULE_3__.W0)(data,fields):data,cache=this.getCache(),key=this.getCacheKey(this.id);cache.has(key)?cache.merge(key,dataWithMissingFields):cache.set(key,dataWithMissingFields),this.successCallback(cache.get(key))}}))}getParentCacheKey(id){return"".concat(_constants__WEBPACK_IMPORTED_MODULE_5__.Asv).concat(id)}getCacheKey(id){return"getCacheKey(".concat(id,") should be overriden")}getUrl(id){return"getUrl(".concat(id,") should be overriden")}merge(cacheKey,key,value){const cache=this.getCache();return cache.merge(cacheKey,lodash_set__WEBPACK_IMPORTED_MODULE_1___default()({},key,value)),cache.get(cacheKey)}postDeleteCleanup(){this.isDestroyed()||(this.getCache().unsetAll(_constants__WEBPACK_IMPORTED_MODULE_5__.dtD),this.successCallback())}deleteItem(item,successCallback){let errorCallback=arguments.length>2&&void 0!==arguments[2]?arguments[2]:lodash_noop__WEBPACK_IMPORTED_MODULE_0___default();if(this.isDestroyed())return Promise.reject();this.errorCode=_constants__WEBPACK_IMPORTED_MODULE_5__.ud_;const{id,permissions,parent,type}=item;if(!(id&&permissions&&parent&&type))return errorCallback((0,_utils_error__WEBPACK_IMPORTED_MODULE_2__.vz)(),this.errorCode),Promise.reject();const{id:parentId}=parent,{can_delete}=permissions;if(!can_delete||!parentId)return errorCallback((0,_utils_error__WEBPACK_IMPORTED_MODULE_2__.pm)(),this.errorCode),Promise.reject();this.id=id,this.parentId=parentId,this.successCallback=successCallback,this.errorCallback=errorCallback;const url="".concat(this.getUrl(id)).concat(type===_constants__WEBPACK_IMPORTED_MODULE_5__.mQf?"?recursive=true":"");return this.xhr.delete({url}).then(this.deleteSuccessHandler).catch((e=>{this.errorHandler(e)}))}rename(item,name,successCallback){let errorCallback=arguments.length>3&&void 0!==arguments[3]?arguments[3]:lodash_noop__WEBPACK_IMPORTED_MODULE_0___default();if(this.isDestroyed())return Promise.reject();this.errorCode=_constants__WEBPACK_IMPORTED_MODULE_5__.SZY;const{id,permissions}=item;if(!id||!permissions)return errorCallback((0,_utils_error__WEBPACK_IMPORTED_MODULE_2__.vz)(),this.errorCode),Promise.reject();const{can_rename}=permissions;return can_rename?(this.id=id,this.successCallback=successCallback,this.errorCallback=errorCallback,this.xhr.put({url:"".concat(this.getUrl(id)),data:{name}}).then(this.renameSuccessHandler).catch((e=>{this.errorHandler(e)}))):(errorCallback((0,_utils_error__WEBPACK_IMPORTED_MODULE_2__.pm)(),this.errorCode),Promise.reject())}validateSharedLinkRequest(itemID,itemPermissions){let canSkipSetShareAccessPermission=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!itemID||!itemPermissions)throw this.errorCode=_constants__WEBPACK_IMPORTED_MODULE_5__.rwK,(0,_utils_error__WEBPACK_IMPORTED_MODULE_2__.vz)();const{can_share,can_set_share_access}=itemPermissions;if(!can_share||!canSkipSetShareAccessPermission&&!can_set_share_access)throw this.errorCode=_constants__WEBPACK_IMPORTED_MODULE_5__.rwK,(0,_utils_error__WEBPACK_IMPORTED_MODULE_2__.pm)()}async share(item,access,successCallback){let errorCallback=arguments.length>3&&void 0!==arguments[3]?arguments[3]:lodash_noop__WEBPACK_IMPORTED_MODULE_0___default(),options=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(this.isDestroyed())return Promise.reject();try{const{id,permissions,shared_link:sharedLink}=item;this.id=id,this.successCallback=successCallback,this.errorCallback=errorCallback;const canSkipSetShareAccessPermission=!sharedLink&&void 0===access;this.validateSharedLinkRequest(id,permissions,canSkipSetShareAccessPermission);const{fields}=options,requestData={url:this.getUrl(this.id),data:{shared_link:access===_constants__WEBPACK_IMPORTED_MODULE_5__.dHG?null:{access}}};fields&&(requestData.params={fields:fields.toString()});const{data}=await this.xhr.put(requestData);return this.shareSuccessHandler(data,fields)}catch(e){return this.errorHandler(e)}}async updateSharedLink(item,sharedLinkParams,successCallback){let errorCallback=arguments.length>3&&void 0!==arguments[3]?arguments[3]:lodash_noop__WEBPACK_IMPORTED_MODULE_0___default(),options=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(this.isDestroyed())return Promise.reject();try{const{id,permissions}=item;this.id=id,this.successCallback=successCallback,this.errorCallback=errorCallback,this.validateSharedLinkRequest(id,permissions);const{fields}=options,requestData={url:this.getUrl(this.id),data:{shared_link:sharedLinkParams}};fields&&(requestData.params={fields:fields.toString()});const{data}=await this.xhr.put(requestData);return this.shareSuccessHandler(data,fields)}catch(e){return this.errorHandler(e)}}}const __WEBPACK_DEFAULT_EXPORT__=Item},"./src/api/WebLink.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _Item__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/api/Item.js"),_constants__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/constants.js"),_utils_fields__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/utils/fields.js");class WebLink extends _Item__WEBPACK_IMPORTED_MODULE_0__.Z{getCacheKey(id){return"".concat(_constants__WEBPACK_IMPORTED_MODULE_1__.Zne).concat(id)}getUrl(id){const suffix=id?"/".concat(id):"";return"".concat(this.getBaseApiUrl(),"/web_links").concat(suffix)}async getWeblink(id,successCallback,errorCallback){let{fields}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(this.isDestroyed())return;const cache=this.getCache(),key=this.getCacheKey(id);if(this.errorCode=_constants__WEBPACK_IMPORTED_MODULE_1__.pPq,this.successCallback=successCallback,this.errorCallback=errorCallback,cache.has(key)){if(0===(0,_utils_fields__WEBPACK_IMPORTED_MODULE_2__.pJ)(cache.get(key),fields).length)return void successCallback(cache.get(key))}const xhrOptions={url:this.getUrl(id)};fields&&(xhrOptions.params={fields:fields.toString()});try{const{data}=await this.xhr.get(xhrOptions);if(this.isDestroyed())return;cache.has(key)?cache.merge(key,data):cache.set(key,data),this.successHandler(cache.get(key))}catch(e){this.errorHandler(e)}}}const __WEBPACK_DEFAULT_EXPORT__=WebLink},"./src/api/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>_APIFactory__WEBPACK_IMPORTED_MODULE_0__.Z});var _APIFactory__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/api/APIFactory.js")},"./src/api/messages.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__=(0,__webpack_require__("./node_modules/react-intl/lib/index.js").vU)({appActivityDeleteErrorMessage:{id:"be.api.appActivityDeleteErrorMessage",defaultMessage:"There was an error deleting this item."},commentCreateErrorMessage:{id:"be.api.commentCreateErrorMessage",defaultMessage:"There was an error creating this comment."},commentCreateConflictMessage:{id:"be.api.commentCreateConflictMessage",defaultMessage:"This comment already exists."},commentDeleteErrorMessage:{id:"be.api.commentDeleteErrorMessage",defaultMessage:"There was an error deleting this comment."},commentUpdateErrorMessage:{id:"be.api.commentUpdateErrorMessage",defaultMessage:"This comment could not be modified."},repliesFetchErrorMessage:{id:"be.api.repliesFetchErrorMessage",defaultMessage:"The replies to this comment could not be loaded."},taskActionErrorTitle:{id:"be.api.taskActionErrorTitle",defaultMessage:"Error"},taskApproveErrorMessage:{id:"be.api.taskApproveErrorMessage",defaultMessage:"An error has occurred while approving this task. Please refresh the page and try again."},taskCompleteErrorMessage:{id:"be.api.taskCompleteErrorMessage",defaultMessage:"An error has occurred while completing this task. Please refresh the page and try again."},taskRejectErrorMessage:{id:"be.api.taskRejectErrorMessage",defaultMessage:"An error has occurred while rejecting this task. Please refresh the page and try again."},taskDeleteErrorMessage:{id:"be.api.taskDeleteErrorMessage",defaultMessage:"There was an error while deleting this task. Please refresh the page and try again."},taskCreateErrorMessage:{id:"be.api.taskCreateErrorMessage",defaultMessage:"An error occurred while creating this task. Please try again."},taskGroupExceedsLimitWarningMessage:{id:"be.api.taskGroupExceedsWarningTitle",defaultMessage:"One or more groups can not receive this task as a group size cannot exceed the limit of {max} assignees per group."}})},"./src/components/tooltip/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ar:()=>_Tooltip__WEBPACK_IMPORTED_MODULE_0__.Ar,DU:()=>_Tooltip__WEBPACK_IMPORTED_MODULE_0__.DU,ZP:()=>_Tooltip__WEBPACK_IMPORTED_MODULE_0__.ZP});var _Tooltip__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/components/tooltip/Tooltip.tsx")},"./src/utils/Cache.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var lodash_merge__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/merge.js"),lodash_merge__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_merge__WEBPACK_IMPORTED_MODULE_0__);const __WEBPACK_DEFAULT_EXPORT__=class Cache{constructor(){this.cache={}}set(key,value){this.cache[key]=value}merge(key,value){if(!this.has(key))throw new Error("Key ".concat(key," not in cache!"));this.set(key,lodash_merge__WEBPACK_IMPORTED_MODULE_0___default()({},this.get(key),value))}unset(key){delete this.cache[key]}unsetAll(prefix){Object.keys(this.cache).forEach((key=>{key.startsWith(prefix)&&delete this.cache[key]}))}has(key){return{}.hasOwnProperty.call(this.cache,key)}get(key){if(this.has(key))return this.cache[key]}}},"./src/utils/LocalStore.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _Cache__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/utils/Cache.js");const __WEBPACK_DEFAULT_EXPORT__=class LocalStore{constructor(){this.memoryStore=new _Cache__WEBPACK_IMPORTED_MODULE_0__.Z;try{this.localStorage=window.localStorage,this.isLocalStorageAvailable=this.canUseLocalStorage()}catch(e){this.isLocalStorageAvailable=!1}}buildKey(key){return"".concat("localStore","/").concat("0","/").concat(key)}canUseLocalStorage(){if(!this.localStorage)return!1;try{return this.localStorage.setItem(this.buildKey("TestKey"),"testValue"),this.localStorage.removeItem(this.buildKey("TestKey")),!0}catch(e){return!1}}setItem(key,value){if(this.isLocalStorageAvailable)try{this.localStorage.setItem(this.buildKey(key),JSON.stringify(value))}catch(e){}else this.memoryStore.set(key,value)}getItem(key){if(!this.isLocalStorageAvailable)return this.memoryStore.get(key);try{const item=this.localStorage.getItem(this.buildKey(key));return item?JSON.parse(item):null}catch(e){return null}}removeItem(key){if(this.isLocalStorageAvailable)try{this.localStorage.removeItem(this.buildKey(key))}catch(e){}else this.memoryStore.unset(key)}}},"./src/utils/TokenService.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/constants.js");const error=new Error("Bad id or auth token. ID should be typed id like file_123 or folder_123! Token should be a string or function.");class TokenService{static async getToken(id,tokenOrTokenFunction){if(null!=tokenOrTokenFunction&&"string"!=typeof tokenOrTokenFunction&&"function"!=typeof tokenOrTokenFunction||!id.startsWith(_constants__WEBPACK_IMPORTED_MODULE_0__.oO3)&&!id.startsWith(_constants__WEBPACK_IMPORTED_MODULE_0__.bOi))throw error;if(!tokenOrTokenFunction||"string"==typeof tokenOrTokenFunction)return tokenOrTokenFunction;const token=await tokenOrTokenFunction(id);if(!token||"string"==typeof token||"object"==typeof token&&(token.read||token.write))return token;throw error}static async getReadToken(id,tokenOrTokenFunction){const token=await TokenService.getToken(id,tokenOrTokenFunction);return token&&"object"==typeof token?token.read:token}static async getReadTokens(id,tokenOrTokenFunction){const ids=Array.isArray(id)?id:[id],promises=ids.map((typedId=>TokenService.getReadToken(typedId,tokenOrTokenFunction))),tokens=await Promise.all(promises),tokenMap={};return tokens.forEach(((token,index)=>{tokenMap[ids[index]]=token})),Promise.resolve(tokenMap)}static async getWriteToken(id,tokenOrTokenFunction){const token=await TokenService.getToken(id,tokenOrTokenFunction);return token&&"object"==typeof token?token.write||token.read:token}static async cacheTokens(ids,tokenOrTokenFunction){if(null!=tokenOrTokenFunction&&"string"!=typeof tokenOrTokenFunction&&"function"!=typeof tokenOrTokenFunction||!ids.every((itemId=>itemId.startsWith(_constants__WEBPACK_IMPORTED_MODULE_0__.oO3)||itemId.startsWith(_constants__WEBPACK_IMPORTED_MODULE_0__.bOi))))throw error;return"function"==typeof tokenOrTokenFunction&&await tokenOrTokenFunction(ids),Promise.resolve()}}const __WEBPACK_DEFAULT_EXPORT__=TokenService},"./src/utils/error.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{hz:()=>getMissingItemTextOrStatus,pG:()=>getBadUserError,pm:()=>getBadPermissionsError,vz:()=>getBadItemError,zg:()=>isUserCorrectableError});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/constants.js");function getBadItemError(){return new Error("Bad box item!")}function getBadPermissionsError(){return new Error("Insufficient Permissions!")}function getBadUserError(){return new Error("Bad box user!")}function getMissingItemTextOrStatus(){return new Error("Missing text or status!")}function isUserCorrectableError(status){return status===_constants__WEBPACK_IMPORTED_MODULE_0__.QUF||status===_constants__WEBPACK_IMPORTED_MODULE_0__.FZP||status===_constants__WEBPACK_IMPORTED_MODULE_0__.WRV||status>=_constants__WEBPACK_IMPORTED_MODULE_0__.olu}},"./src/utils/fields.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{LG:()=>COMMENTS_FIELDS_TO_FETCH,Q0:()=>APP_ACTIVITY_FIELDS_TO_FETCH,W0:()=>fillMissingProperties,YF:()=>FOLDER_FIELDS_TO_FETCH,Zk:()=>FILE_VERSIONS_FIELDS_TO_FETCH,fq:()=>FILE_SHARED_LINK_FIELDS_TO_FETCH,l0:()=>SIDEBAR_FIELDS_TO_FETCH,nk:()=>PREVIEW_FIELDS_TO_FETCH,pJ:()=>findMissingProperties,xs:()=>FEED_FILE_VERSIONS_FIELDS_TO_FETCH,yk:()=>FILE_VERSION_FIELDS_TO_FETCH});var lodash_has__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/has.js"),lodash_has__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_has__WEBPACK_IMPORTED_MODULE_0__),lodash_set__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lodash/set.js"),lodash_set__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash_set__WEBPACK_IMPORTED_MODULE_1__),_constants__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/constants.js");function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(obj,key,value){return(key=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const FOLDER_FIELDS_TO_FETCH=[_constants__WEBPACK_IMPORTED_MODULE_2__.ET9,_constants__WEBPACK_IMPORTED_MODULE_2__.Tjd,_constants__WEBPACK_IMPORTED_MODULE_2__.t98,_constants__WEBPACK_IMPORTED_MODULE_2__.Uy7,_constants__WEBPACK_IMPORTED_MODULE_2__.Y6P,_constants__WEBPACK_IMPORTED_MODULE_2__.Syy,_constants__WEBPACK_IMPORTED_MODULE_2__.vwG,_constants__WEBPACK_IMPORTED_MODULE_2__.CtE,_constants__WEBPACK_IMPORTED_MODULE_2__.GMf,_constants__WEBPACK_IMPORTED_MODULE_2__.iqn,_constants__WEBPACK_IMPORTED_MODULE_2__.CqZ,_constants__WEBPACK_IMPORTED_MODULE_2__.aOl,_constants__WEBPACK_IMPORTED_MODULE_2__.Xd4,_constants__WEBPACK_IMPORTED_MODULE_2__.iCl,_constants__WEBPACK_IMPORTED_MODULE_2__.Nw6,_constants__WEBPACK_IMPORTED_MODULE_2__.Q7k,_constants__WEBPACK_IMPORTED_MODULE_2__.cGX,_constants__WEBPACK_IMPORTED_MODULE_2__.CVy],SIDEBAR_FIELDS_TO_FETCH=[_constants__WEBPACK_IMPORTED_MODULE_2__.ET9,_constants__WEBPACK_IMPORTED_MODULE_2__.Tjd,_constants__WEBPACK_IMPORTED_MODULE_2__.Uy7,_constants__WEBPACK_IMPORTED_MODULE_2__.Syy,_constants__WEBPACK_IMPORTED_MODULE_2__.bE_,_constants__WEBPACK_IMPORTED_MODULE_2__.suI,_constants__WEBPACK_IMPORTED_MODULE_2__.vwG,_constants__WEBPACK_IMPORTED_MODULE_2__.Fph,_constants__WEBPACK_IMPORTED_MODULE_2__.TbB,_constants__WEBPACK_IMPORTED_MODULE_2__.iqn,_constants__WEBPACK_IMPORTED_MODULE_2__.cHD,_constants__WEBPACK_IMPORTED_MODULE_2__.GMf,_constants__WEBPACK_IMPORTED_MODULE_2__.CqZ,_constants__WEBPACK_IMPORTED_MODULE_2__.jr$,_constants__WEBPACK_IMPORTED_MODULE_2__.VGI,_constants__WEBPACK_IMPORTED_MODULE_2__.qah,_constants__WEBPACK_IMPORTED_MODULE_2__.wJU,_constants__WEBPACK_IMPORTED_MODULE_2__.fYp,_constants__WEBPACK_IMPORTED_MODULE_2__.zOC,_constants__WEBPACK_IMPORTED_MODULE_2__.Xd4,_constants__WEBPACK_IMPORTED_MODULE_2__.b14,_constants__WEBPACK_IMPORTED_MODULE_2__.Nw6,_constants__WEBPACK_IMPORTED_MODULE_2__.Q7k,_constants__WEBPACK_IMPORTED_MODULE_2__.EOI],PREVIEW_FIELDS_TO_FETCH=[_constants__WEBPACK_IMPORTED_MODULE_2__.ET9,_constants__WEBPACK_IMPORTED_MODULE_2__.vwG,_constants__WEBPACK_IMPORTED_MODULE_2__.suI,_constants__WEBPACK_IMPORTED_MODULE_2__.sSO,_constants__WEBPACK_IMPORTED_MODULE_2__.bE_,_constants__WEBPACK_IMPORTED_MODULE_2__.Tjd,_constants__WEBPACK_IMPORTED_MODULE_2__.Uy7,_constants__WEBPACK_IMPORTED_MODULE_2__.Syy,_constants__WEBPACK_IMPORTED_MODULE_2__.cGX,_constants__WEBPACK_IMPORTED_MODULE_2__.vtJ,_constants__WEBPACK_IMPORTED_MODULE_2__.Nw6,_constants__WEBPACK_IMPORTED_MODULE_2__.Q7k],FEED_FILE_VERSIONS_FIELDS_TO_FETCH=[_constants__WEBPACK_IMPORTED_MODULE_2__.iqn,_constants__WEBPACK_IMPORTED_MODULE_2__.Syy,_constants__WEBPACK_IMPORTED_MODULE_2__.Q7k,_constants__WEBPACK_IMPORTED_MODULE_2__.GMf,_constants__WEBPACK_IMPORTED_MODULE_2__.CqZ,_constants__WEBPACK_IMPORTED_MODULE_2__.Tjd,_constants__WEBPACK_IMPORTED_MODULE_2__.JE4,_constants__WEBPACK_IMPORTED_MODULE_2__.idh,_constants__WEBPACK_IMPORTED_MODULE_2__.Uy7,_constants__WEBPACK_IMPORTED_MODULE_2__.a8c,_constants__WEBPACK_IMPORTED_MODULE_2__.AOl,_constants__WEBPACK_IMPORTED_MODULE_2__.EOI,_constants__WEBPACK_IMPORTED_MODULE_2__.zOC],FILE_VERSION_FIELDS_TO_FETCH=[_constants__WEBPACK_IMPORTED_MODULE_2__.bE_,_constants__WEBPACK_IMPORTED_MODULE_2__.GMf,_constants__WEBPACK_IMPORTED_MODULE_2__.CqZ,_constants__WEBPACK_IMPORTED_MODULE_2__.b14,_constants__WEBPACK_IMPORTED_MODULE_2__.Uy7,_constants__WEBPACK_IMPORTED_MODULE_2__.nvq,_constants__WEBPACK_IMPORTED_MODULE_2__.EOI,_constants__WEBPACK_IMPORTED_MODULE_2__.zOC],FILE_VERSIONS_FIELDS_TO_FETCH=[_constants__WEBPACK_IMPORTED_MODULE_2__.Nw6,_constants__WEBPACK_IMPORTED_MODULE_2__.iqn,_constants__WEBPACK_IMPORTED_MODULE_2__.Syy,_constants__WEBPACK_IMPORTED_MODULE_2__.Q7k,_constants__WEBPACK_IMPORTED_MODULE_2__.GMf,_constants__WEBPACK_IMPORTED_MODULE_2__.CqZ,_constants__WEBPACK_IMPORTED_MODULE_2__.Tjd,_constants__WEBPACK_IMPORTED_MODULE_2__.vwG,_constants__WEBPACK_IMPORTED_MODULE_2__.nvq,_constants__WEBPACK_IMPORTED_MODULE_2__.JE4,_constants__WEBPACK_IMPORTED_MODULE_2__.idh,_constants__WEBPACK_IMPORTED_MODULE_2__.Nc7,_constants__WEBPACK_IMPORTED_MODULE_2__.Uy7,_constants__WEBPACK_IMPORTED_MODULE_2__.a8c,_constants__WEBPACK_IMPORTED_MODULE_2__.AOl,_constants__WEBPACK_IMPORTED_MODULE_2__.EOI,_constants__WEBPACK_IMPORTED_MODULE_2__.zOC],FILE_SHARED_LINK_FIELDS_TO_FETCH=[_constants__WEBPACK_IMPORTED_MODULE_2__.a$W,_constants__WEBPACK_IMPORTED_MODULE_2__.suI],COMMENTS_FIELDS_TO_FETCH=(_constants__WEBPACK_IMPORTED_MODULE_2__.rF$,_constants__WEBPACK_IMPORTED_MODULE_2__.L_V,_constants__WEBPACK_IMPORTED_MODULE_2__.iqn,_constants__WEBPACK_IMPORTED_MODULE_2__.cHD,_constants__WEBPACK_IMPORTED_MODULE_2__.koP,_constants__WEBPACK_IMPORTED_MODULE_2__.Znr,_constants__WEBPACK_IMPORTED_MODULE_2__.tIt,_constants__WEBPACK_IMPORTED_MODULE_2__.SCQ,[_constants__WEBPACK_IMPORTED_MODULE_2__.s5P,_constants__WEBPACK_IMPORTED_MODULE_2__.Znr,_constants__WEBPACK_IMPORTED_MODULE_2__.iqn,_constants__WEBPACK_IMPORTED_MODULE_2__.cHD,_constants__WEBPACK_IMPORTED_MODULE_2__.GMf,_constants__WEBPACK_IMPORTED_MODULE_2__.vwG]),APP_ACTIVITY_FIELDS_TO_FETCH=(_constants__WEBPACK_IMPORTED_MODULE_2__.cHD,_constants__WEBPACK_IMPORTED_MODULE_2__.CqZ,_constants__WEBPACK_IMPORTED_MODULE_2__.jr$,_constants__WEBPACK_IMPORTED_MODULE_2__.tIt,[_constants__WEBPACK_IMPORTED_MODULE_2__.uBt,_constants__WEBPACK_IMPORTED_MODULE_2__.AVb,_constants__WEBPACK_IMPORTED_MODULE_2__.cHD,_constants__WEBPACK_IMPORTED_MODULE_2__.Hr7,_constants__WEBPACK_IMPORTED_MODULE_2__.y_h]);function findMissingProperties(obj){let properties=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return obj&&"object"==typeof obj&&0!==Object.keys(obj).length?properties.filter((field=>!lodash_has__WEBPACK_IMPORTED_MODULE_0___default()(obj,field))):properties}function fillMissingProperties(){let obj=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},properties=arguments.length>1?arguments[1]:void 0;if(!Array.isArray(properties)||0===properties.length)return obj;const newObj=_objectSpread({},obj);return findMissingProperties(obj,properties).forEach((field=>{lodash_set__WEBPACK_IMPORTED_MODULE_1___default()(newObj,field,null)})),newObj}},"./src/utils/file.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{GS:()=>isBoxNote,_f:()=>getTypedFolderId,mD:()=>getFileExtension,mc:()=>getTypedFileId});var lodash_get__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/get.js"),lodash_get__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_get__WEBPACK_IMPORTED_MODULE_0__),_constants__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/constants.js");const FILE_EXT_REGEX=/\.([0-9a-z]+)$/i;function getTypedFileId(id){return"".concat(_constants__WEBPACK_IMPORTED_MODULE_1__.bOi).concat(id)}function getTypedFolderId(id){return"".concat(_constants__WEBPACK_IMPORTED_MODULE_1__.oO3).concat(id)}function isBoxNote(file){return file.extension===_constants__WEBPACK_IMPORTED_MODULE_1__.mX7}function getFileExtension(filename){if("string"!=typeof filename)return"";const result=FILE_EXT_REGEX.exec(filename);return lodash_get__WEBPACK_IMPORTED_MODULE_0___default()(result,"[1]","")}},"./src/utils/flatten.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>flatten});var _error__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/utils/error.js"),_constants__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/constants.js");function flatten(list,folderAPI,fileAPI,weblinkAPI){const items=[];return list.forEach((item=>{const{id,type}=item;if(!id||!type)throw(0,_error__WEBPACK_IMPORTED_MODULE_0__.vz)();let api;switch(type){case _constants__WEBPACK_IMPORTED_MODULE_1__.mQf:api=folderAPI;break;case _constants__WEBPACK_IMPORTED_MODULE_1__.nqi:api=fileAPI;break;case _constants__WEBPACK_IMPORTED_MODULE_1__.zSe:api=weblinkAPI;break;default:throw new Error("Unknown Type!")}const cache=api.getCache(),key=api.getCacheKey(id);cache.has(key)?cache.merge(key,item):cache.set(key,item),items.push(key)})),items}},"./src/utils/function.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function retryNumOfTimes(func,times){let backoffFactor=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,tries=0,timeout=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new Promise(((resolve,hardReject)=>{function executeAfterTimeout(time){setTimeout((()=>{!function doTry(){tries+=1,new Promise(((tryResolve,tryReject)=>{func(tryResolve,tryReject,hardReject)})).then(resolve).catch((reason=>{if(tries<times)return timeout*=backoffFactor,void executeAfterTimeout(timeout);hardReject(reason)}))}()}),time)}executeAfterTimeout(timeout)}))}__webpack_require__.d(__webpack_exports__,{j:()=>retryNumOfTimes})},"./src/utils/uploads.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$d:()=>isDataTransferItemAPackage,E6:()=>getFileFromDataTransferItem,H9:()=>getFileAPIOptions,Kt:()=>getFileLastModifiedAsISONoMSIfPossible,M1:()=>isDataTransferItemAFolder,PP:()=>getDataTransferItemAPIOptions,WU:()=>getFileId,Y9:()=>isMultiputSupported,hn:()=>getFile,mB:()=>getDataTransferItemId,sJ:()=>getEntryFromDataTransferItem,uM:()=>getBoundedExpBackoffRetryDelay,vr:()=>getDataTransferItem,wQ:()=>getPackageFileFromDataTransferItem,y5:()=>getFileFromEntry});var lodash_get__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/get.js"),lodash_get__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_get__WEBPACK_IMPORTED_MODULE_0__),_Browser__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/utils/Browser.js");const DEFAULT_API_OPTIONS={};function doesFileContainAPIOptions(file){return!(!file.options||!file.file)}function doesDataTransferItemContainAPIOptions(item){return!(!item.options||!item.item)}function getFile(file){return doesFileContainAPIOptions(file)?file.file:file}function getDataTransferItem(item){return doesDataTransferItemContainAPIOptions(item)?item.item:item}function getFileAPIOptions(file){return doesFileContainAPIOptions(file)&&file.options||DEFAULT_API_OPTIONS}function getDataTransferItemAPIOptions(item){return doesDataTransferItemContainAPIOptions(item)&&item.options||DEFAULT_API_OPTIONS}function getFileLastModifiedAsISONoMSIfPossible(file){const lastModified=file.lastModified||file.lastModifiedDate;if(lastModified&&("string"==typeof lastModified||"number"==typeof lastModified||lastModified instanceof Date)){const lastModifiedDate=new Date(lastModified);if(function isValidDateObject(date){return"[object Date]"===Object.prototype.toString.call(date)&&!Number.isNaN(date.getTime())}(lastModifiedDate))return function toISOStringNoMS(date){return date.toISOString().replace(/\.[0-9]{3}/,"")}(lastModifiedDate)}return null}function getBoundedExpBackoffRetryDelay(initialRetryDelay,maxRetryDelay,retryNum){const delay=initialRetryDelay*retryNum**2;return delay>maxRetryDelay?maxRetryDelay:delay}function getEntryFromDataTransferItem(item){return(item.webkitGetAsEntry||item.mozGetAsEntry||item.getAsEntry).call(item)}function isDataTransferItemAFolder(itemData){const entry=getEntryFromDataTransferItem(getDataTransferItem(itemData));return!!entry&&entry.isDirectory}function isDataTransferItemAPackage(itemData){const item=getDataTransferItem(itemData);return isDataTransferItemAFolder(item)&&"application/zip"===item.type&&"file"===item.kind}function getFileFromEntry(entry){return new Promise((resolve=>{entry.file((file=>{resolve(file)}))}))}async function getFileFromDataTransferItem(itemData){const entry=getEntryFromDataTransferItem(getDataTransferItem(itemData));if(!entry)return null;const file=await getFileFromEntry(entry);return doesDataTransferItemContainAPIOptions(itemData)?{file,options:getDataTransferItemAPIOptions(itemData)}:file}function getPackageFileFromDataTransferItem(itemData){const item=getDataTransferItem(itemData);if(!getEntryFromDataTransferItem(item))return null;const itemFile=item.getAsFile();return doesDataTransferItemContainAPIOptions(itemData)?{file:itemFile,options:getDataTransferItemAPIOptions(itemData)}:itemFile}function getFileId(file,rootFolderId){if(!doesFileContainAPIOptions(file))return file.name;const fileWithOptions=file,folderId=lodash_get__WEBPACK_IMPORTED_MODULE_0___default()(fileWithOptions,"options.folderId",rootFolderId),uploadInitTimestamp=lodash_get__WEBPACK_IMPORTED_MODULE_0___default()(fileWithOptions,"options.uploadInitTimestamp",Date.now()),fileName=fileWithOptions.file.webkitRelativePath||fileWithOptions.file.name;return"".concat(fileName,"_").concat(folderId,"_").concat(uploadInitTimestamp)}function getDataTransferItemId(itemData,rootFolderId){const item=getDataTransferItem(itemData),{name}=getEntryFromDataTransferItem(item);if(!doesDataTransferItemContainAPIOptions(itemData))return name;const{folderId=rootFolderId,uploadInitTimestamp=Date.now()}=getDataTransferItemAPIOptions(itemData);return"".concat(name,"_").concat(folderId,"_").concat(uploadInitTimestamp)}function isMultiputSupported(){const cryptoObj=window.crypto||window.msCrypto;return!_Browser__WEBPACK_IMPORTED_MODULE_1__.Z.isMobileSafari()&&("https:"===window.location.protocol&&cryptoObj&&cryptoObj.subtle)}}}]);